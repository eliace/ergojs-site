<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Documentation Source: core/events.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	
	<link type="text/css" rel="stylesheet" href="styles/site.spacelab.css">
	
</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top ">
		<div class="navbar-inner">
			<a class="brand" href="index.html">Documentation</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="namespaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="Ergo.html">Ergo</a>
						</li>
						
						<li>
							<a href="Ergo.core.html">core</a>
						</li>
						
						<li>
							<a href="Ergo.data.html">data</a>
						</li>
						
						<li>
							<a href="Ergo.events.html">events</a>
						</li>
						
						<li>
							<a href="Ergo.html.html">html</a>
						</li>
						
						<li>
							<a href="Ergo.layouts.html">layouts</a>
						</li>
						
						<li>
							<a href="Ergo.widgets.html">widgets</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="Ergo.core.Array.html">Array</a>
						</li>
						
						<li>
							<a href="Ergo.core.Collection.html">Collection</a>
						</li>
						
						<li>
							<a href="Ergo.core.Context.html">Context</a>
						</li>
						
						<li>
							<a href="Ergo.core.DataSource.html">DataSource</a>
						</li>
						
						<li>
							<a href="Ergo.core.Layout.html">Layout</a>
						</li>
						
						<li>
							<a href="Ergo.core.Object.html">Object</a>
						</li>
						
						<li>
							<a href="Ergo.core.StateManager.html">StateManager</a>
						</li>
						
						<li>
							<a href="Ergo.core.Widget.html">Widget</a>
						</li>
						
						<li>
							<a href="Ergo.core.WidgetArray.html">WidgetArray</a>
						</li>
						
						<li>
							<a href="Ergo.data.Collection.html">Collection</a>
						</li>
						
						<li>
							<a href="Ergo.data.Object.html">Object</a>
						</li>
						
						<li>
							<a href="Ergo.events.Dispatcher.html">Dispatcher</a>
						</li>
						
						<li>
							<a href="Ergo.events.Event.html">Event</a>
						</li>
						
						<li>
							<a href="Ergo.html.Button.html">Button</a>
						</li>
						
						<li>
							<a href="Ergo.html.Iframe.html">Iframe</a>
						</li>
						
						<li>
							<a href="Ergo.html.Img.html">Img</a>
						</li>
						
						<li>
							<a href="Ergo.html.Input.html">Input</a>
						</li>
						
						<li>
							<a href="Ergo.html.Select.html">Select</a>
						</li>
						
						<li>
							<a href="Ergo.html.Textarea.html">Textarea</a>
						</li>
						
						<li>
							<a href="Ergo.html.Widget.html">Widget</a>
						</li>
						
						<li>
							<a href="Ergo.widgets.Box.html">Box</a>
						</li>
						
						<li>
							<a href="Ergo.widgets.Button.html">Button</a>
						</li>
						
						<li>
							<a href="Ergo.widgets.Check.html">Check</a>
						</li>
						
						<li>
							<a href="Ergo.widgets.Field.html">Field</a>
						</li>
						
						<li>
							<a href="Ergo.widgets.Icon.html">Icon</a>
						</li>
						
						<li>
							<a href="Ergo.widgets.Inline.html">Inline</a>
						</li>
						
						<li>
							<a href="Ergo.widgets.Link.html">Link</a>
						</li>
						
						<li>
							<a href="Ergo.widgets.List.html">List</a>
						</li>
						
						<li>
							<a href="Ergo.widgets.NestedList.html">NestedList</a>
						</li>
						
						<li>
							<a href="Ergo.widgets.Panel.html">Panel</a>
						</li>
						
						<li>
							<a href="Ergo.widgets.Table.html">Table</a>
						</li>
						
						<li>
							<a href="Ergo.widgets.TableRow.html">TableRow</a>
						</li>
						
						<li>
							<a href="Ergo.widgets.Text.html">Text</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="mixins.list.html" class="dropdown-toggle" data-toggle="dropdown">Mixins<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="Ergo.Observable.html">Observable</a>
						</li>
						
						<li>
							<a href="Ergo.Statable.html">Statable</a>
						</li>
						
						<li>
							<a href="Ergo.WidgetOptions.html">WidgetOptions</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="global.html#apply_all">apply_all</a>
						</li>
						
						<li>
							<a href="global.html#clear">clear</a>
						</li>
						
						<li>
							<a href="global.html#each">each</a>
						</li>
						
						<li>
							<a href="global.html#filter">filter</a>
						</li>
						
						<li>
							<a href="global.html#find">find</a>
						</li>
						
						<li>
							<a href="global.html#find_all">find_all</a>
						</li>
						
						<li>
							<a href="global.html#get">get</a>
						</li>
						
						<li>
							<a href="global.html#has_key">has_key</a>
						</li>
						
						<li>
							<a href="global.html#includes">includes</a>
						</li>
						
						<li>
							<a href="global.html#is_empty">is_empty</a>
						</li>
						
						<li>
							<a href="global.html#key_of">key_of</a>
						</li>
						
						<li>
							<a href="global.html#keys">keys</a>
						</li>
						
						<li>
							<a href="global.html#map">map</a>
						</li>
						
						<li>
							<a href="global.html#remove">remove</a>
						</li>
						
						<li>
							<a href="global.html#remove_at">remove_at</a>
						</li>
						
						<li>
							<a href="global.html#remove_if">remove_if</a>
						</li>
						
						<li>
							<a href="global.html#set">set</a>
						</li>
						
						<li>
							<a href="global.html#size">size(1)</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: core/events.js</h1>
    
    <section>
        <article>
            <pre class="sunlight-highlight-javascript ">
//= require "object"


/**
 * @name Ergo.events
 * @namespace
 */


/**
 * 
 * @deprecated
 * 
 * @class
 * @name Ergo.events.Event
 * @extends Ergo.core.Object
 */
Ergo.declare('Ergo.events.Event', Ergo.core.Object, /** @lends Ergo.events.Event.prototype */{
	
	/**
	 * @param {Object} overrides
	 * @param {Object} baseEvent
	 */
	_initialize: function(overrides, baseEvent) {
		this._super();
//		Ergo.events.Event.superclass._initialize.call(this);
		
		if(overrides) Ergo.override(this, overrides);
		
//		this.is_stopped = false;
		this.baseEvent = baseEvent;
		this.canceled = false;
		this.stopped = false;
	},
	
	
	cancel: function(){
		this.canceled = true;
	},
	
	stop: function() {
		if(this.baseEvent) this.baseEvent.stopPropagation();
		this.stopped = true;
	}
	
	
	
});


// Ergo.declare('Ergo.events.CancelEvent', 'Ergo.events.Event', /** @lends Ergo.events.CancelEvent.prototype */{
// 
	// /**
	 // * @constructs
 	 // * @extends Ergo.events.Event
	 // * @param {Object} overrides
	 // * @param {Object} baseEvent
	 // */
	// _initialize: function(overrides, baseEvent) {
		// this._super(overrides, baseEvent);
// //		Ergo.events.CancelEvent.superclass._initialize.apply(this, arguments);
		// this.isCanceled = false;
	// },
// 	
	// cancel: function(){
		// this.isCanceled = true;
	// }
// 	
// });




/**
 * Диспетчер событий
 * 
 * @class
 * @name Ergo.events.Dispatcher
 * @extends Ergo.core.Object
 */
Ergo.declare('Ergo.events.Observer', 'Ergo.core.Object', /** @lends Ergo.events.Dispatcher.prototype */{
	
	_initialize: function(target) {
		this.events = {}; 
		this.target = target;
	},
	
	/**
	 * Регистрируем событие.
	 * 
	 * reg(type, callback, target)
	 */
	reg: function(type, callback, target) {
		if(!(type in this.events)) this.events[type] = [];//new Ergo.core.Array();
		var h_arr = this.events[type];
		h_arr.push({'callback': callback, 'target': target || this.target});
		return this;
	},
	
	/**
	 * Однократная обработка события
	 */
	once: function(type, callback, target) {
		if(!(type in this.events)) this.events[type] = [];
		var h_arr = this.events[type];
		h_arr.push({'callback': callback, 'target': target || this.target, 'once': true});
		return this;
	},
	
	/**
	 * Убираем регистрацию события.
	 * 
	 * unreg(type)
	 * unreg(callback)
	 * unreg(type, callback)
	 * unreg(target)
	 */
	unreg: function(arg, arg2) {
		
		var events = this.events;
		
		if(arguments.length == 2){
			events[arg] = Ergo.filter( events[arg], function(h) { return h.callback != arg2; } );
		}
		else if( $.isString(arg) ){
			// удаляем все обработчики с данным именем
			delete events[arg];
		}
		else if( $.isFunction(arg) ){
			// удаляем указанный обработчик
//			for(var i = 0; i &lt; events.length; i++) {
			for(var i in events) {
				events[i] = Ergo.filter( events[i], function(h) { return h.callback != arg; } );
			}
		}
		else {
			// удаляем все обработчики для указанного объекта
//			for(var i = 0; i &lt; e.length; i++) {
			for(var i in events) {
				events[i] = Ergo.filter( events[i], function(h) { return h.target != arg; } );
			}
		}
		
		return this;		
	},
	
	unreg_all: function() {
		this.events = {};
	},
	
	/**
	 * Инициируем событие.
	 * 
	 * fire(type, event)
	 * 
	 * type - тип события в формате тип_1.тип_2 ... .тип_N
	 * 
	 */
	fire: function(type, e, baseEvent) {
		
		// "ленивая" генерация базового события
		var _event = {
			baseEvent: baseEvent,
			stop: function() {
				if(this.baseEvent) this.baseEvent.stopPropagation();
				this.stopped = true;
			}
		};
		
		if(arguments.length == 1) { 
//			_event = new Ergo.events.Event();
//			e = new Ergo.events.Event();
		}
		else if( $.isPlainObject(e) ){
			Ergo.override(_event, e);
//			_event.baseEvent = baseEvent;
//			e = new Ergo.events.Event(e, baseEvent);
		}
		
		e = _event;
		
		
		var self = this;
		
		var h_arr = this.events[type];
		if(h_arr) {
			Ergo.each(h_arr, function(h){
				// вызываем обработчик события
				h.callback.call(h.target, e, type);
				// если усьановлен флаг остановки, то прекращаем обработку событий
//				if(e.stopped) return false;
			});
			this.events[type] = Ergo.filter( this.events[type], function(h) { return !h.once; } );
		}

		if(e.after && !e.stopped) 
			e.after.call(this.target, e, type);

//		self.on_fire(type, e, baseEvent);
		
		return this;
	}
	
	
	// bubble: function() {
// 		
	// }
// 	
// 	
	// /**
	 // * Метод, вызываемый после отрабатывания метода fire
	 // * 
	 // */
	// on_fire: function(type, e, base_event) {
// 		
	// }
	
	
});


//Ergo.declare('Ergo.events.Dispatcher', 'Ergo.core.Object', {
//	
//	
//	/**
//	 * @constructs
//	 * @extends Ergo.core.Object
//	 * @param {Object} target
//	 */
//	_initialize: function(target) {
//		Ergo.events.Dispatcher.superclass._initialize.apply(this, arguments);
//		this.tree = new Ergo.ObjectTree({}, function(){ return {handlers:[]}; }, ['handlers']);
//		this.target = target;
//	},
//	
//	/**
//	 * Регистрируем событие.
//	 * 
//	 * reg(type, callback, target)
//	 */
//	reg: function(type, callback, target) {
//		var node = this.tree.ensure(type);
//		node.handlers.push({'callback': callback, 'target': target});
//		return this;
//	},
//	
//	/**
//	 * Убираем регистрацию события.
//	 * 
//	 * unreg(type)
//	 * unreg(callback)
//	 * unreg(type, callback)
//	 * unreg(target)
//	 */
//	unreg: function(arg, arg2) {
//		
//		if(arguments.length == 2){
//			var node = this.tree.get(arg);
//			// с одной стороны это очень "жадный" способ удаления, а с другой - убирает некорректно зарегистрированных слушателей
//			node.handlers = Ergo.filter(node.handlers, Ergo.ne.curry(arg2));
//		}
//		else if( $.isString(arg) ){
//			this.tree.del(arg);
//		}
//		else if( $.isFunction(arg) ){
//			// с одной стороны это очень "жадный" способ удаления, а с другой - убирает некорректно зарегистрированных слушателей
//			this.tree.traverse(function(node){
//				node.handlers = Ergo.filter(node.handlers, Ergo.ne.curry(arg));
//			});
//		}
//		else {
//			this.tree.traverse(function(node){
//				node.handlers = Ergo.filter(node.handlers, function(h) { return (h.target != arg); });
//			});
//		}
//		
//		return this;		
//	},
//	
//	/**
//	 * Инициируем событие.
//	 * 
//	 * fire(type, event)
//	 * 
//	 * type - тип события в формате тип_1.тип_2 ... .тип_N
//	 * 
//	 */
//	fire: function(type, event, baseEvent) {
//		
//		// "ленивая" генерация базового события
//		if(arguments.length == 1) 
//			event = new Ergo.events.Event();
//		else if( $.isPlainObject(event) ){
//			event = new Ergo.events.Event(event, baseEvent);
//		}
//		
//		var self = this;
//		
//		// получаем узел указанного типа
//		var node0 = this.tree.get( type );
//		// обходим всех потомков и вызываем все обработчики событий
//		this.tree.traverse(function(node){
//			Ergo.each(node.handlers, function(h){
//				h.callback.call(h.target || self.target, event);
//			});
//		}, node0);
//		
//		return this;
//	},
//	
//	unreg_all: function(){
//		this.tree = new Ergo.ObjectTree({}, function(){ return {handlers:[]}; }, ['handlers']);		
//	}
//	
//	
//});




//Ergo.event_bus = new Ergo.events.Observer();




/**
 * 
 * @mixin
 * 
 */
Ergo.Observable = function() {
	
	this.events = new Ergo.events.Observer(this);
	
	var o = this.options;
	
	var regexp = /^on\S/;
	for(var i in o){
		if(regexp.test(i)){
			var name = i.charAt(2).toLowerCase() + i.slice(3);
			var chain = ( !$.isArray(o[i]) ) ? [o[i]] : o[i];
			for(var j = 0; j &lt; chain.length; j++) {
				this.events.reg( name, chain[j] );
			}
		}
	}
	
};


</pre>
        </article>
    </section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a>
		on Fri Nov 14 2014 01:28:09 GMT+0400 (MSK) using the <a href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<script src="scripts/sunlight.js"></script>
	<script src="scripts/sunlight.javascript.js"></script>
	<script src="scripts/sunlight-plugin.doclinks.js"></script>
	<script src="scripts/sunlight-plugin.linenumbers.js"></script>
	<script src="scripts/sunlight-plugin.menu.js"></script>
	<script src="scripts/jquery.min.js"></script>
	<script src="scripts/jquery.scrollTo.js"></script>
	<script src="scripts/jquery.localScroll.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>


	<script>  Sunlight.highlightAll({lineNumbers:,  showMenu: true, enableDoclinks :true}); </script>

	<script>
		$( function () {
			$( "#toc" ).toc( {
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : 60
			} );
			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );

		} );
	</script>

	

</body>
</html>
