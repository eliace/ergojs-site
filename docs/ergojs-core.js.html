<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Source: ergojs-core.js</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"default":{"outputSourceFiles":true},"monospaceLinks":false,"cleverLinks":false};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html"></a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="Ergo">
            <span class="title">
                <a href="Ergo.html">Ergo</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.apply_all"><a href="Ergo.html#apply_all">apply_all</a></li>
            
                <li data-name="Ergo.call_all"><a href="Ergo.html#call_all">call_all</a></li>
            
                <li data-name="Ergo.deep_copy"><a href="Ergo.html#deep_copy">deep_copy</a></li>
            
                <li data-name="Ergo.defineClass"><a href="Ergo.html#defineClass">defineClass</a></li>
            
                <li data-name="Ergo.each"><a href="Ergo.html#each">each</a></li>
            
                <li data-name="Ergo.eq"><a href="Ergo.html#eq">eq</a></li>
            
                <li data-name="Ergo.escapeHtml"><a href="Ergo.html#escapeHtml">escapeHtml</a></li>
            
                <li data-name="Ergo.extend"><a href="Ergo.html#extend">extend</a></li>
            
                <li data-name="Ergo.filter"><a href="Ergo.html#filter">filter</a></li>
            
                <li data-name="Ergo.find"><a href="Ergo.html#find">find</a></li>
            
                <li data-name="Ergo.find_all"><a href="Ergo.html#find_all">find_all</a></li>
            
                <li data-name="Ergo.format"><a href="Ergo.html#format">format</a></li>
            
                <li data-name="Ergo.format_obj"><a href="Ergo.html#format_obj">format_obj</a></li>
            
                <li data-name="Ergo.includes"><a href="Ergo.html#includes">includes</a></li>
            
                <li data-name="Ergo.isBoolean"><a href="Ergo.html#isBoolean">isBoolean</a></li>
            
                <li data-name="Ergo.key_of"><a href="Ergo.html#key_of">key_of</a></li>
            
                <li data-name="Ergo.map"><a href="Ergo.html#map">map</a></li>
            
                <li data-name="Ergo.ne"><a href="Ergo.html#ne">ne</a></li>
            
                <li data-name="Ergo.object"><a href="Ergo.html#object">object</a></li>
            
                <li data-name="Ergo.override"><a href="Ergo.html#override">override</a></li>
            
                <li data-name="Ergo.pretty_print"><a href="Ergo.html#pretty_print">pretty_print</a></li>
            
                <li data-name="Ergo.reduce"><a href="Ergo.html#reduce">reduce</a></li>
            
                <li data-name="Ergo.remove"><a href="Ergo.html#remove">remove</a></li>
            
                <li data-name="Ergo.timestamp"><a href="Ergo.html#timestamp">timestamp</a></li>
            
                <li data-name="Ergo.walk_hierarchy"><a href="Ergo.html#walk_hierarchy">walk_hierarchy</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.core">
            <span class="title">
                <a href="Ergo.core.html">Ergo.core</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.data">
            <span class="title">
                <a href="Ergo.data.html">Ergo.data</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.events">
            <span class="title">
                <a href="Ergo.events.html">Ergo.events</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.html">
            <span class="title">
                <a href="Ergo.html.html">Ergo.html</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.layouts">
            <span class="title">
                <a href="Ergo.layouts.html">Ergo.layouts</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.widgets">
            <span class="title">
                <a href="Ergo.widgets.html">Ergo.widgets</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.core.Array">
            <span class="title">
                <a href="Ergo.core.Array.html">Ergo.core.Array</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.core.Array#_includes"><a href="Ergo.core.Array.html#_includes">_includes</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.core.Array#_construct"><a href="Ergo.core.Array.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.core.Array#_destroy"><a href="Ergo.core.Array.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.core.Array#_post_construct"><a href="Ergo.core.Array.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.core.Array#_pre_construct"><a href="Ergo.core.Array.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.core.Array#add"><a href="Ergo.core.Array.html#add">add</a></li>
            
                <li data-name="Ergo.core.Array#first"><a href="Ergo.core.Array.html#first">first</a></li>
            
                <li data-name="Ergo.core.Array#last"><a href="Ergo.core.Array.html#last">last</a></li>
            
                <li data-name="Ergo.core.Array#opt"><a href="Ergo.core.Array.html#opt">opt</a></li>
            
                <li data-name="Ergo.core.Array#remove_at"><a href="Ergo.core.Array.html#remove_at">remove_at</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.core.Collection">
            <span class="title">
                <a href="Ergo.core.Collection.html">Ergo.core.Collection</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.core.Collection#_includes"><a href="Ergo.core.Collection.html#_includes">_includes</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.core.Collection#_construct"><a href="Ergo.core.Collection.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.core.Collection#_destroy"><a href="Ergo.core.Collection.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.core.Collection#_post_construct"><a href="Ergo.core.Collection.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.core.Collection#_pre_construct"><a href="Ergo.core.Collection.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.core.Collection#opt"><a href="Ergo.core.Collection.html#opt">opt</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.core.Context">
            <span class="title">
                <a href="Ergo.core.Context.html">Ergo.core.Context</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.core.Context#_includes"><a href="Ergo.core.Context.html#_includes">_includes</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.core.Context#_construct"><a href="Ergo.core.Context.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.core.Context#_destroy"><a href="Ergo.core.Context.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.core.Context#_post_construct"><a href="Ergo.core.Context.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.core.Context#_pre_construct"><a href="Ergo.core.Context.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.core.Context#opt"><a href="Ergo.core.Context.html#opt">opt</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.core.DataSource">
            <span class="title">
                <a href="Ergo.core.DataSource.html">Ergo.core.DataSource</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.core.DataSource#_includes"><a href="Ergo.core.DataSource.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.core.DataSource#entries"><a href="Ergo.core.DataSource.html#entries">entries</a></li>
            
                <li data-name="Ergo.core.DataSource#source"><a href="Ergo.core.DataSource.html#source">source</a></li>
            
                <li data-name="Ergo.core.DataSource#source"><a href="Ergo.core.DataSource.html#source">source</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.core.DataSource#_construct"><a href="Ergo.core.DataSource.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.core.DataSource#_destroy"><a href="Ergo.core.DataSource.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.core.DataSource#_factory"><a href="Ergo.core.DataSource.html#_factory">_factory</a></li>
            
                <li data-name="Ergo.core.DataSource#_post_construct"><a href="Ergo.core.DataSource.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.core.DataSource#_pre_construct"><a href="Ergo.core.DataSource.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.core.DataSource#add"><a href="Ergo.core.DataSource.html#add">add</a></li>
            
                <li data-name="Ergo.core.DataSource#changed"><a href="Ergo.core.DataSource.html#changed">changed</a></li>
            
                <li data-name="Ergo.core.DataSource#copy"><a href="Ergo.core.DataSource.html#copy">copy</a></li>
            
                <li data-name="Ergo.core.DataSource#del"><a href="Ergo.core.DataSource.html#del">del</a></li>
            
                <li data-name="Ergo.core.DataSource#each"><a href="Ergo.core.DataSource.html#each">each</a></li>
            
                <li data-name="Ergo.core.DataSource#entry"><a href="Ergo.core.DataSource.html#entry">entry</a></li>
            
                <li data-name="Ergo.core.DataSource#get"><a href="Ergo.core.DataSource.html#get">get</a></li>
            
                <li data-name="Ergo.core.DataSource#opt"><a href="Ergo.core.DataSource.html#opt">opt</a></li>
            
                <li data-name="Ergo.core.DataSource#rm"><a href="Ergo.core.DataSource.html#rm">rm</a></li>
            
                <li data-name="Ergo.core.DataSource#set"><a href="Ergo.core.DataSource.html#set">set</a></li>
            
                <li data-name="Ergo.core.DataSource#size"><a href="Ergo.core.DataSource.html#size">size</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.core.Layout">
            <span class="title">
                <a href="Ergo.core.Layout.html">Ergo.core.Layout</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.core.Layout#innerEl"><a href="Ergo.core.Layout.html#innerEl">innerEl</a></li>
            
                <li data-name="Ergo.core.Layout#innerEl"><a href="Ergo.core.Layout.html#innerEl">innerEl</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.core.Layout#_rebuild"><a href="Ergo.core.Layout.html#_rebuild">_rebuild</a></li>
            
                <li data-name="Ergo.core.Layout#clear"><a href="Ergo.core.Layout.html#clear">clear</a></li>
            
                <li data-name="Ergo.core.Layout#remove"><a href="Ergo.core.Layout.html#remove">remove</a></li>
            
                <li data-name="Ergo.core.Layout#update"><a href="Ergo.core.Layout.html#update">update</a></li>
            
                <li data-name="Ergo.core.Layout#wrap"><a href="Ergo.core.Layout.html#wrap">wrap</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.core.Object">
            <span class="title">
                <a href="Ergo.core.Object.html">Ergo.core.Object</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.core.Object#_includes"><a href="Ergo.core.Object.html#_includes">_includes</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.core.Object#_construct"><a href="Ergo.core.Object.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.core.Object#_destroy"><a href="Ergo.core.Object.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.core.Object#_post_construct"><a href="Ergo.core.Object.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.core.Object#_pre_construct"><a href="Ergo.core.Object.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.core.Object#opt"><a href="Ergo.core.Object.html#opt">opt</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.core.Observer">
            <span class="title">
                <a href="Ergo.core.Observer.html">Ergo.core.Observer</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.core.Observer#_includes"><a href="Ergo.core.Observer.html#_includes">_includes</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.core.Observer#_construct"><a href="Ergo.core.Observer.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.core.Observer#_destroy"><a href="Ergo.core.Observer.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.core.Observer#_post_construct"><a href="Ergo.core.Observer.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.core.Observer#_pre_construct"><a href="Ergo.core.Observer.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.core.Observer#opt"><a href="Ergo.core.Observer.html#opt">opt</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.core.StateManager">
            <span class="title">
                <a href="Ergo.core.StateManager.html">Ergo.core.StateManager</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.core.StateManager#_includes"><a href="Ergo.core.StateManager.html#_includes">_includes</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.core.StateManager#_construct"><a href="Ergo.core.StateManager.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.core.StateManager#_destroy"><a href="Ergo.core.StateManager.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.core.StateManager#_post_construct"><a href="Ergo.core.StateManager.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.core.StateManager#_pre_construct"><a href="Ergo.core.StateManager.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.core.StateManager#clear"><a href="Ergo.core.StateManager.html#clear">clear</a></li>
            
                <li data-name="Ergo.core.StateManager#is"><a href="Ergo.core.StateManager.html#is">is</a></li>
            
                <li data-name="Ergo.core.StateManager#only"><a href="Ergo.core.StateManager.html#only">only</a></li>
            
                <li data-name="Ergo.core.StateManager#opt"><a href="Ergo.core.StateManager.html#opt">opt</a></li>
            
                <li data-name="Ergo.core.StateManager#set"><a href="Ergo.core.StateManager.html#set">set</a></li>
            
                <li data-name="Ergo.core.StateManager#toggle"><a href="Ergo.core.StateManager.html#toggle">toggle</a></li>
            
                <li data-name="Ergo.core.StateManager#unset"><a href="Ergo.core.StateManager.html#unset">unset</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.core.Widget">
            <span class="title">
                <a href="Ergo.core.Widget.html">Ergo.core.Widget</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.core.Widget#_includes"><a href="Ergo.core.Widget.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.core.Widget#value"><a href="Ergo.core.Widget.html#value">value</a></li>
            
                <li data-name="Ergo.core.Widget#value"><a href="Ergo.core.Widget.html#value">value</a></li>
            
                <li data-name="Ergo.core.Widget#vdom"><a href="Ergo.core.Widget.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.core.Widget#vdom"><a href="Ergo.core.Widget.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.core.Widget#_construct"><a href="Ergo.core.Widget.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.core.Widget#_destroy"><a href="Ergo.core.Widget.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.core.Widget#_post_construct"><a href="Ergo.core.Widget.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.core.Widget#_pre_construct"><a href="Ergo.core.Widget.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.core.Widget#action"><a href="Ergo.core.Widget.html#action">action</a></li>
            
                <li data-name="Ergo.core.Widget#component"><a href="Ergo.core.Widget.html#component">component</a></li>
            
                <li data-name="Ergo.core.Widget#item"><a href="Ergo.core.Widget.html#item">item</a></li>
            
                <li data-name="Ergo.core.Widget#layoutFactory"><a href="Ergo.core.Widget.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.core.Widget#next"><a href="Ergo.core.Widget.html#next">next</a></li>
            
                <li data-name="Ergo.core.Widget#opt"><a href="Ergo.core.Widget.html#opt">opt</a></li>
            
                <li data-name="Ergo.core.Widget#parents"><a href="Ergo.core.Widget.html#parents">parents</a></li>
            
                <li data-name="Ergo.core.Widget#prev"><a href="Ergo.core.Widget.html#prev">prev</a></li>
            
                <li data-name="Ergo.core.Widget#walk"><a href="Ergo.core.Widget.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.core.WidgetChildren">
            <span class="title">
                <a href="Ergo.core.WidgetChildren.html">Ergo.core.WidgetChildren</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.core.WidgetChildren#_includes"><a href="Ergo.core.WidgetChildren.html#_includes">_includes</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.core.WidgetChildren#_construct"><a href="Ergo.core.WidgetChildren.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.core.WidgetChildren#_destroy"><a href="Ergo.core.WidgetChildren.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.core.WidgetChildren#_post_construct"><a href="Ergo.core.WidgetChildren.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.core.WidgetChildren#_pre_construct"><a href="Ergo.core.WidgetChildren.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.core.WidgetChildren#add"><a href="Ergo.core.WidgetChildren.html#add">add</a></li>
            
                <li data-name="Ergo.core.WidgetChildren#first"><a href="Ergo.core.WidgetChildren.html#first">first</a></li>
            
                <li data-name="Ergo.core.WidgetChildren#last"><a href="Ergo.core.WidgetChildren.html#last">last</a></li>
            
                <li data-name="Ergo.core.WidgetChildren#opt"><a href="Ergo.core.WidgetChildren.html#opt">opt</a></li>
            
                <li data-name="Ergo.core.WidgetChildren#remove_at"><a href="Ergo.core.WidgetChildren.html#remove_at">remove_at</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.core.WidgetComponents">
            <span class="title">
                <a href="Ergo.core.WidgetComponents.html">Ergo.core.WidgetComponents</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.core.WidgetComponents#_includes"><a href="Ergo.core.WidgetComponents.html#_includes">_includes</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.core.WidgetComponents#_construct"><a href="Ergo.core.WidgetComponents.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#_destroy"><a href="Ergo.core.WidgetComponents.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#_post_construct"><a href="Ergo.core.WidgetComponents.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#_pre_construct"><a href="Ergo.core.WidgetComponents.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#add"><a href="Ergo.core.WidgetComponents.html#add">add</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#apply_all"><a href="Ergo.core.WidgetComponents.html#apply_all">apply_all</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#clear"><a href="Ergo.core.WidgetComponents.html#clear">clear</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#each"><a href="Ergo.core.WidgetComponents.html#each">each</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#filter"><a href="Ergo.core.WidgetComponents.html#filter">filter</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#find"><a href="Ergo.core.WidgetComponents.html#find">find</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#find_all"><a href="Ergo.core.WidgetComponents.html#find_all">find_all</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#first"><a href="Ergo.core.WidgetComponents.html#first">first</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#get"><a href="Ergo.core.WidgetComponents.html#get">get</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#has_key"><a href="Ergo.core.WidgetComponents.html#has_key">has_key</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#includes"><a href="Ergo.core.WidgetComponents.html#includes">includes</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#is_empty"><a href="Ergo.core.WidgetComponents.html#is_empty">is_empty</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#key_of"><a href="Ergo.core.WidgetComponents.html#key_of">key_of</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#keys"><a href="Ergo.core.WidgetComponents.html#keys">keys</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#last"><a href="Ergo.core.WidgetComponents.html#last">last</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#map"><a href="Ergo.core.WidgetComponents.html#map">map</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#opt"><a href="Ergo.core.WidgetComponents.html#opt">opt</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#remove"><a href="Ergo.core.WidgetComponents.html#remove">remove</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#remove_at"><a href="Ergo.core.WidgetComponents.html#remove_at">remove_at</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#remove_if"><a href="Ergo.core.WidgetComponents.html#remove_if">remove_if</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#set"><a href="Ergo.core.WidgetComponents.html#set">set</a></li>
            
                <li data-name="Ergo.core.WidgetComponents#size"><a href="Ergo.core.WidgetComponents.html#size">size</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.core.WidgetItems">
            <span class="title">
                <a href="Ergo.core.WidgetItems.html">Ergo.core.WidgetItems</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.core.WidgetItems#_includes"><a href="Ergo.core.WidgetItems.html#_includes">_includes</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.core.WidgetItems#_construct"><a href="Ergo.core.WidgetItems.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.core.WidgetItems#_destroy"><a href="Ergo.core.WidgetItems.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.core.WidgetItems#_post_construct"><a href="Ergo.core.WidgetItems.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.core.WidgetItems#_pre_construct"><a href="Ergo.core.WidgetItems.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.core.WidgetItems#add"><a href="Ergo.core.WidgetItems.html#add">add</a></li>
            
                <li data-name="Ergo.core.WidgetItems#apply_all"><a href="Ergo.core.WidgetItems.html#apply_all">apply_all</a></li>
            
                <li data-name="Ergo.core.WidgetItems#clear"><a href="Ergo.core.WidgetItems.html#clear">clear</a></li>
            
                <li data-name="Ergo.core.WidgetItems#each"><a href="Ergo.core.WidgetItems.html#each">each</a></li>
            
                <li data-name="Ergo.core.WidgetItems#filter"><a href="Ergo.core.WidgetItems.html#filter">filter</a></li>
            
                <li data-name="Ergo.core.WidgetItems#find"><a href="Ergo.core.WidgetItems.html#find">find</a></li>
            
                <li data-name="Ergo.core.WidgetItems#find_all"><a href="Ergo.core.WidgetItems.html#find_all">find_all</a></li>
            
                <li data-name="Ergo.core.WidgetItems#first"><a href="Ergo.core.WidgetItems.html#first">first</a></li>
            
                <li data-name="Ergo.core.WidgetItems#get"><a href="Ergo.core.WidgetItems.html#get">get</a></li>
            
                <li data-name="Ergo.core.WidgetItems#has_key"><a href="Ergo.core.WidgetItems.html#has_key">has_key</a></li>
            
                <li data-name="Ergo.core.WidgetItems#includes"><a href="Ergo.core.WidgetItems.html#includes">includes</a></li>
            
                <li data-name="Ergo.core.WidgetItems#is_empty"><a href="Ergo.core.WidgetItems.html#is_empty">is_empty</a></li>
            
                <li data-name="Ergo.core.WidgetItems#key_of"><a href="Ergo.core.WidgetItems.html#key_of">key_of</a></li>
            
                <li data-name="Ergo.core.WidgetItems#keys"><a href="Ergo.core.WidgetItems.html#keys">keys</a></li>
            
                <li data-name="Ergo.core.WidgetItems#last"><a href="Ergo.core.WidgetItems.html#last">last</a></li>
            
                <li data-name="Ergo.core.WidgetItems#map"><a href="Ergo.core.WidgetItems.html#map">map</a></li>
            
                <li data-name="Ergo.core.WidgetItems#opt"><a href="Ergo.core.WidgetItems.html#opt">opt</a></li>
            
                <li data-name="Ergo.core.WidgetItems#remove"><a href="Ergo.core.WidgetItems.html#remove">remove</a></li>
            
                <li data-name="Ergo.core.WidgetItems#remove_at"><a href="Ergo.core.WidgetItems.html#remove_at">remove_at</a></li>
            
                <li data-name="Ergo.core.WidgetItems#remove_if"><a href="Ergo.core.WidgetItems.html#remove_if">remove_if</a></li>
            
                <li data-name="Ergo.core.WidgetItems#set"><a href="Ergo.core.WidgetItems.html#set">set</a></li>
            
                <li data-name="Ergo.core.WidgetItems#size"><a href="Ergo.core.WidgetItems.html#size">size</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.data.Collection">
            <span class="title">
                <a href="Ergo.data.Collection.html">Ergo.data.Collection</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.data.Collection#_includes"><a href="Ergo.data.Collection.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.data.Collection#entries"><a href="Ergo.data.Collection.html#entries">entries</a></li>
            
                <li data-name="Ergo.data.Collection#model"><a href="Ergo.data.Collection.html#model">model</a></li>
            
                <li data-name="Ergo.data.Collection#options"><a href="Ergo.data.Collection.html#options">options</a></li>
            
                <li data-name="Ergo.data.Collection#source"><a href="Ergo.data.Collection.html#source">source</a></li>
            
                <li data-name="Ergo.data.Collection#source"><a href="Ergo.data.Collection.html#source">source</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.data.Collection#_construct"><a href="Ergo.data.Collection.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.data.Collection#_destroy"><a href="Ergo.data.Collection.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.data.Collection#_factory"><a href="Ergo.data.Collection.html#_factory">_factory</a></li>
            
                <li data-name="Ergo.data.Collection#_post_construct"><a href="Ergo.data.Collection.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.data.Collection#_pre_construct"><a href="Ergo.data.Collection.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.data.Collection#add"><a href="Ergo.data.Collection.html#add">add</a></li>
            
                <li data-name="Ergo.data.Collection#changed"><a href="Ergo.data.Collection.html#changed">changed</a></li>
            
                <li data-name="Ergo.data.Collection#copy"><a href="Ergo.data.Collection.html#copy">copy</a></li>
            
                <li data-name="Ergo.data.Collection#del"><a href="Ergo.data.Collection.html#del">del</a></li>
            
                <li data-name="Ergo.data.Collection#each"><a href="Ergo.data.Collection.html#each">each</a></li>
            
                <li data-name="Ergo.data.Collection#entry"><a href="Ergo.data.Collection.html#entry">entry</a></li>
            
                <li data-name="Ergo.data.Collection#fetch"><a href="Ergo.data.Collection.html#fetch">fetch</a></li>
            
                <li data-name="Ergo.data.Collection#find"><a href="Ergo.data.Collection.html#find">find</a></li>
            
                <li data-name="Ergo.data.Collection#flush"><a href="Ergo.data.Collection.html#flush">flush</a></li>
            
                <li data-name="Ergo.data.Collection#get"><a href="Ergo.data.Collection.html#get">get</a></li>
            
                <li data-name="Ergo.data.Collection#opt"><a href="Ergo.data.Collection.html#opt">opt</a></li>
            
                <li data-name="Ergo.data.Collection#purge"><a href="Ergo.data.Collection.html#purge">purge</a></li>
            
                <li data-name="Ergo.data.Collection#rm"><a href="Ergo.data.Collection.html#rm">rm</a></li>
            
                <li data-name="Ergo.data.Collection#set"><a href="Ergo.data.Collection.html#set">set</a></li>
            
                <li data-name="Ergo.data.Collection#size"><a href="Ergo.data.Collection.html#size">size</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.data.Object">
            <span class="title">
                <a href="Ergo.data.Object.html">Ergo.data.Object</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.data.Object#_includes"><a href="Ergo.data.Object.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.data.Object#entries"><a href="Ergo.data.Object.html#entries">entries</a></li>
            
                <li data-name="Ergo.data.Object#fields"><a href="Ergo.data.Object.html#fields">fields</a></li>
            
                <li data-name="Ergo.data.Object#source"><a href="Ergo.data.Object.html#source">source</a></li>
            
                <li data-name="Ergo.data.Object#source"><a href="Ergo.data.Object.html#source">source</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.data.Object#_construct"><a href="Ergo.data.Object.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.data.Object#_destroy"><a href="Ergo.data.Object.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.data.Object#_factory"><a href="Ergo.data.Object.html#_factory">_factory</a></li>
            
                <li data-name="Ergo.data.Object#_parse"><a href="Ergo.data.Object.html#_parse">_parse</a></li>
            
                <li data-name="Ergo.data.Object#_post_construct"><a href="Ergo.data.Object.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.data.Object#_pre_construct"><a href="Ergo.data.Object.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.data.Object#add"><a href="Ergo.data.Object.html#add">add</a></li>
            
                <li data-name="Ergo.data.Object#changed"><a href="Ergo.data.Object.html#changed">changed</a></li>
            
                <li data-name="Ergo.data.Object#copy"><a href="Ergo.data.Object.html#copy">copy</a></li>
            
                <li data-name="Ergo.data.Object#del"><a href="Ergo.data.Object.html#del">del</a></li>
            
                <li data-name="Ergo.data.Object#each"><a href="Ergo.data.Object.html#each">each</a></li>
            
                <li data-name="Ergo.data.Object#entry"><a href="Ergo.data.Object.html#entry">entry</a></li>
            
                <li data-name="Ergo.data.Object#fetch"><a href="Ergo.data.Object.html#fetch">fetch</a></li>
            
                <li data-name="Ergo.data.Object#get"><a href="Ergo.data.Object.html#get">get</a></li>
            
                <li data-name="Ergo.data.Object#opt"><a href="Ergo.data.Object.html#opt">opt</a></li>
            
                <li data-name="Ergo.data.Object#rm"><a href="Ergo.data.Object.html#rm">rm</a></li>
            
                <li data-name="Ergo.data.Object#set"><a href="Ergo.data.Object.html#set">set</a></li>
            
                <li data-name="Ergo.data.Object#size"><a href="Ergo.data.Object.html#size">size</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.events.Event">
            <span class="title">
                <a href="Ergo.events.Event.html">Ergo.events.Event</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.events.Event#_includes"><a href="Ergo.events.Event.html#_includes">_includes</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.events.Event#_construct"><a href="Ergo.events.Event.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.events.Event#_destroy"><a href="Ergo.events.Event.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.events.Event#_post_construct"><a href="Ergo.events.Event.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.events.Event#_pre_construct"><a href="Ergo.events.Event.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.events.Event#opt"><a href="Ergo.events.Event.html#opt">opt</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.html.Button">
            <span class="title">
                <a href="Ergo.html.Button.html">Ergo.html.Button</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.html.Button#_includes"><a href="Ergo.html.Button.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.html.Button#value"><a href="Ergo.html.Button.html#value">value</a></li>
            
                <li data-name="Ergo.html.Button#value"><a href="Ergo.html.Button.html#value">value</a></li>
            
                <li data-name="Ergo.html.Button#vdom"><a href="Ergo.html.Button.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.html.Button#vdom"><a href="Ergo.html.Button.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.html.Button#_construct"><a href="Ergo.html.Button.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.html.Button#_destroy"><a href="Ergo.html.Button.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.html.Button#_post_construct"><a href="Ergo.html.Button.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.html.Button#_pre_construct"><a href="Ergo.html.Button.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.html.Button#action"><a href="Ergo.html.Button.html#action">action</a></li>
            
                <li data-name="Ergo.html.Button#component"><a href="Ergo.html.Button.html#component">component</a></li>
            
                <li data-name="Ergo.html.Button#item"><a href="Ergo.html.Button.html#item">item</a></li>
            
                <li data-name="Ergo.html.Button#layoutFactory"><a href="Ergo.html.Button.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.html.Button#next"><a href="Ergo.html.Button.html#next">next</a></li>
            
                <li data-name="Ergo.html.Button#opt"><a href="Ergo.html.Button.html#opt">opt</a></li>
            
                <li data-name="Ergo.html.Button#parents"><a href="Ergo.html.Button.html#parents">parents</a></li>
            
                <li data-name="Ergo.html.Button#prev"><a href="Ergo.html.Button.html#prev">prev</a></li>
            
                <li data-name="Ergo.html.Button#walk"><a href="Ergo.html.Button.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.html.Checkbox">
            <span class="title">
                <a href="Ergo.html.Checkbox.html">Ergo.html.Checkbox</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.html.Checkbox#_includes"><a href="Ergo.html.Checkbox.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.html.Checkbox#value"><a href="Ergo.html.Checkbox.html#value">value</a></li>
            
                <li data-name="Ergo.html.Checkbox#value"><a href="Ergo.html.Checkbox.html#value">value</a></li>
            
                <li data-name="Ergo.html.Checkbox#vdom"><a href="Ergo.html.Checkbox.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.html.Checkbox#vdom"><a href="Ergo.html.Checkbox.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.html.Checkbox#_construct"><a href="Ergo.html.Checkbox.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.html.Checkbox#_destroy"><a href="Ergo.html.Checkbox.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.html.Checkbox#_post_construct"><a href="Ergo.html.Checkbox.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.html.Checkbox#_pre_construct"><a href="Ergo.html.Checkbox.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.html.Checkbox#action"><a href="Ergo.html.Checkbox.html#action">action</a></li>
            
                <li data-name="Ergo.html.Checkbox#component"><a href="Ergo.html.Checkbox.html#component">component</a></li>
            
                <li data-name="Ergo.html.Checkbox#item"><a href="Ergo.html.Checkbox.html#item">item</a></li>
            
                <li data-name="Ergo.html.Checkbox#layoutFactory"><a href="Ergo.html.Checkbox.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.html.Checkbox#next"><a href="Ergo.html.Checkbox.html#next">next</a></li>
            
                <li data-name="Ergo.html.Checkbox#opt"><a href="Ergo.html.Checkbox.html#opt">opt</a></li>
            
                <li data-name="Ergo.html.Checkbox#parents"><a href="Ergo.html.Checkbox.html#parents">parents</a></li>
            
                <li data-name="Ergo.html.Checkbox#prev"><a href="Ergo.html.Checkbox.html#prev">prev</a></li>
            
                <li data-name="Ergo.html.Checkbox#walk"><a href="Ergo.html.Checkbox.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.html.Form">
            <span class="title">
                <a href="Ergo.html.Form.html">Ergo.html.Form</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.html.Form#_includes"><a href="Ergo.html.Form.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.html.Form#value"><a href="Ergo.html.Form.html#value">value</a></li>
            
                <li data-name="Ergo.html.Form#value"><a href="Ergo.html.Form.html#value">value</a></li>
            
                <li data-name="Ergo.html.Form#vdom"><a href="Ergo.html.Form.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.html.Form#vdom"><a href="Ergo.html.Form.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.html.Form#_construct"><a href="Ergo.html.Form.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.html.Form#_destroy"><a href="Ergo.html.Form.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.html.Form#_post_construct"><a href="Ergo.html.Form.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.html.Form#_pre_construct"><a href="Ergo.html.Form.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.html.Form#action"><a href="Ergo.html.Form.html#action">action</a></li>
            
                <li data-name="Ergo.html.Form#component"><a href="Ergo.html.Form.html#component">component</a></li>
            
                <li data-name="Ergo.html.Form#item"><a href="Ergo.html.Form.html#item">item</a></li>
            
                <li data-name="Ergo.html.Form#layoutFactory"><a href="Ergo.html.Form.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.html.Form#next"><a href="Ergo.html.Form.html#next">next</a></li>
            
                <li data-name="Ergo.html.Form#opt"><a href="Ergo.html.Form.html#opt">opt</a></li>
            
                <li data-name="Ergo.html.Form#parents"><a href="Ergo.html.Form.html#parents">parents</a></li>
            
                <li data-name="Ergo.html.Form#prev"><a href="Ergo.html.Form.html#prev">prev</a></li>
            
                <li data-name="Ergo.html.Form#walk"><a href="Ergo.html.Form.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.html.Iframe">
            <span class="title">
                <a href="Ergo.html.Iframe.html">Ergo.html.Iframe</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.html.Iframe#_includes"><a href="Ergo.html.Iframe.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.html.Iframe#value"><a href="Ergo.html.Iframe.html#value">value</a></li>
            
                <li data-name="Ergo.html.Iframe#value"><a href="Ergo.html.Iframe.html#value">value</a></li>
            
                <li data-name="Ergo.html.Iframe#vdom"><a href="Ergo.html.Iframe.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.html.Iframe#vdom"><a href="Ergo.html.Iframe.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.html.Iframe#_construct"><a href="Ergo.html.Iframe.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.html.Iframe#_destroy"><a href="Ergo.html.Iframe.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.html.Iframe#_post_construct"><a href="Ergo.html.Iframe.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.html.Iframe#_pre_construct"><a href="Ergo.html.Iframe.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.html.Iframe#action"><a href="Ergo.html.Iframe.html#action">action</a></li>
            
                <li data-name="Ergo.html.Iframe#component"><a href="Ergo.html.Iframe.html#component">component</a></li>
            
                <li data-name="Ergo.html.Iframe#item"><a href="Ergo.html.Iframe.html#item">item</a></li>
            
                <li data-name="Ergo.html.Iframe#layoutFactory"><a href="Ergo.html.Iframe.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.html.Iframe#next"><a href="Ergo.html.Iframe.html#next">next</a></li>
            
                <li data-name="Ergo.html.Iframe#opt"><a href="Ergo.html.Iframe.html#opt">opt</a></li>
            
                <li data-name="Ergo.html.Iframe#parents"><a href="Ergo.html.Iframe.html#parents">parents</a></li>
            
                <li data-name="Ergo.html.Iframe#prev"><a href="Ergo.html.Iframe.html#prev">prev</a></li>
            
                <li data-name="Ergo.html.Iframe#walk"><a href="Ergo.html.Iframe.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.html.Img">
            <span class="title">
                <a href="Ergo.html.Img.html">Ergo.html.Img</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.html.Img#_includes"><a href="Ergo.html.Img.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.html.Img#value"><a href="Ergo.html.Img.html#value">value</a></li>
            
                <li data-name="Ergo.html.Img#value"><a href="Ergo.html.Img.html#value">value</a></li>
            
                <li data-name="Ergo.html.Img#vdom"><a href="Ergo.html.Img.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.html.Img#vdom"><a href="Ergo.html.Img.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.html.Img#_construct"><a href="Ergo.html.Img.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.html.Img#_destroy"><a href="Ergo.html.Img.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.html.Img#_post_construct"><a href="Ergo.html.Img.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.html.Img#_pre_construct"><a href="Ergo.html.Img.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.html.Img#action"><a href="Ergo.html.Img.html#action">action</a></li>
            
                <li data-name="Ergo.html.Img#component"><a href="Ergo.html.Img.html#component">component</a></li>
            
                <li data-name="Ergo.html.Img#item"><a href="Ergo.html.Img.html#item">item</a></li>
            
                <li data-name="Ergo.html.Img#layoutFactory"><a href="Ergo.html.Img.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.html.Img#next"><a href="Ergo.html.Img.html#next">next</a></li>
            
                <li data-name="Ergo.html.Img#opt"><a href="Ergo.html.Img.html#opt">opt</a></li>
            
                <li data-name="Ergo.html.Img#parents"><a href="Ergo.html.Img.html#parents">parents</a></li>
            
                <li data-name="Ergo.html.Img#prev"><a href="Ergo.html.Img.html#prev">prev</a></li>
            
                <li data-name="Ergo.html.Img#walk"><a href="Ergo.html.Img.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.html.Input">
            <span class="title">
                <a href="Ergo.html.Input.html">Ergo.html.Input</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.html.Input#_includes"><a href="Ergo.html.Input.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.html.Input#value"><a href="Ergo.html.Input.html#value">value</a></li>
            
                <li data-name="Ergo.html.Input#value"><a href="Ergo.html.Input.html#value">value</a></li>
            
                <li data-name="Ergo.html.Input#vdom"><a href="Ergo.html.Input.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.html.Input#vdom"><a href="Ergo.html.Input.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.html.Input#_construct"><a href="Ergo.html.Input.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.html.Input#_destroy"><a href="Ergo.html.Input.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.html.Input#_post_construct"><a href="Ergo.html.Input.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.html.Input#_pre_construct"><a href="Ergo.html.Input.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.html.Input#action"><a href="Ergo.html.Input.html#action">action</a></li>
            
                <li data-name="Ergo.html.Input#component"><a href="Ergo.html.Input.html#component">component</a></li>
            
                <li data-name="Ergo.html.Input#item"><a href="Ergo.html.Input.html#item">item</a></li>
            
                <li data-name="Ergo.html.Input#layoutFactory"><a href="Ergo.html.Input.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.html.Input#next"><a href="Ergo.html.Input.html#next">next</a></li>
            
                <li data-name="Ergo.html.Input#opt"><a href="Ergo.html.Input.html#opt">opt</a></li>
            
                <li data-name="Ergo.html.Input#parents"><a href="Ergo.html.Input.html#parents">parents</a></li>
            
                <li data-name="Ergo.html.Input#prev"><a href="Ergo.html.Input.html#prev">prev</a></li>
            
                <li data-name="Ergo.html.Input#walk"><a href="Ergo.html.Input.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.html.Label">
            <span class="title">
                <a href="Ergo.html.Label.html">Ergo.html.Label</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.html.Label#_includes"><a href="Ergo.html.Label.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.html.Label#_includes"><a href="Ergo.html.Label.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.html.Label#value"><a href="Ergo.html.Label.html#value">value</a></li>
            
                <li data-name="Ergo.html.Label#value"><a href="Ergo.html.Label.html#value">value</a></li>
            
                <li data-name="Ergo.html.Label#value"><a href="Ergo.html.Label.html#value">value</a></li>
            
                <li data-name="Ergo.html.Label#value"><a href="Ergo.html.Label.html#value">value</a></li>
            
                <li data-name="Ergo.html.Label#vdom"><a href="Ergo.html.Label.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.html.Label#vdom"><a href="Ergo.html.Label.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.html.Label#vdom"><a href="Ergo.html.Label.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.html.Label#vdom"><a href="Ergo.html.Label.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.html.Label#_construct"><a href="Ergo.html.Label.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.html.Label#_construct"><a href="Ergo.html.Label.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.html.Label#_destroy"><a href="Ergo.html.Label.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.html.Label#_destroy"><a href="Ergo.html.Label.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.html.Label#_post_construct"><a href="Ergo.html.Label.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.html.Label#_post_construct"><a href="Ergo.html.Label.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.html.Label#_pre_construct"><a href="Ergo.html.Label.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.html.Label#_pre_construct"><a href="Ergo.html.Label.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.html.Label#action"><a href="Ergo.html.Label.html#action">action</a></li>
            
                <li data-name="Ergo.html.Label#action"><a href="Ergo.html.Label.html#action">action</a></li>
            
                <li data-name="Ergo.html.Label#component"><a href="Ergo.html.Label.html#component">component</a></li>
            
                <li data-name="Ergo.html.Label#component"><a href="Ergo.html.Label.html#component">component</a></li>
            
                <li data-name="Ergo.html.Label#item"><a href="Ergo.html.Label.html#item">item</a></li>
            
                <li data-name="Ergo.html.Label#item"><a href="Ergo.html.Label.html#item">item</a></li>
            
                <li data-name="Ergo.html.Label#layoutFactory"><a href="Ergo.html.Label.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.html.Label#layoutFactory"><a href="Ergo.html.Label.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.html.Label#next"><a href="Ergo.html.Label.html#next">next</a></li>
            
                <li data-name="Ergo.html.Label#next"><a href="Ergo.html.Label.html#next">next</a></li>
            
                <li data-name="Ergo.html.Label#opt"><a href="Ergo.html.Label.html#opt">opt</a></li>
            
                <li data-name="Ergo.html.Label#opt"><a href="Ergo.html.Label.html#opt">opt</a></li>
            
                <li data-name="Ergo.html.Label#parents"><a href="Ergo.html.Label.html#parents">parents</a></li>
            
                <li data-name="Ergo.html.Label#parents"><a href="Ergo.html.Label.html#parents">parents</a></li>
            
                <li data-name="Ergo.html.Label#prev"><a href="Ergo.html.Label.html#prev">prev</a></li>
            
                <li data-name="Ergo.html.Label#prev"><a href="Ergo.html.Label.html#prev">prev</a></li>
            
                <li data-name="Ergo.html.Label#walk"><a href="Ergo.html.Label.html#walk">walk</a></li>
            
                <li data-name="Ergo.html.Label#walk"><a href="Ergo.html.Label.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.html.Label">
            <span class="title">
                <a href="Ergo.html.Label.html">Ergo.html.Label</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.html.Label#_includes"><a href="Ergo.html.Label.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.html.Label#_includes"><a href="Ergo.html.Label.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.html.Label#value"><a href="Ergo.html.Label.html#value">value</a></li>
            
                <li data-name="Ergo.html.Label#value"><a href="Ergo.html.Label.html#value">value</a></li>
            
                <li data-name="Ergo.html.Label#value"><a href="Ergo.html.Label.html#value">value</a></li>
            
                <li data-name="Ergo.html.Label#value"><a href="Ergo.html.Label.html#value">value</a></li>
            
                <li data-name="Ergo.html.Label#vdom"><a href="Ergo.html.Label.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.html.Label#vdom"><a href="Ergo.html.Label.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.html.Label#vdom"><a href="Ergo.html.Label.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.html.Label#vdom"><a href="Ergo.html.Label.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.html.Label#_construct"><a href="Ergo.html.Label.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.html.Label#_construct"><a href="Ergo.html.Label.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.html.Label#_destroy"><a href="Ergo.html.Label.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.html.Label#_destroy"><a href="Ergo.html.Label.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.html.Label#_post_construct"><a href="Ergo.html.Label.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.html.Label#_post_construct"><a href="Ergo.html.Label.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.html.Label#_pre_construct"><a href="Ergo.html.Label.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.html.Label#_pre_construct"><a href="Ergo.html.Label.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.html.Label#action"><a href="Ergo.html.Label.html#action">action</a></li>
            
                <li data-name="Ergo.html.Label#action"><a href="Ergo.html.Label.html#action">action</a></li>
            
                <li data-name="Ergo.html.Label#component"><a href="Ergo.html.Label.html#component">component</a></li>
            
                <li data-name="Ergo.html.Label#component"><a href="Ergo.html.Label.html#component">component</a></li>
            
                <li data-name="Ergo.html.Label#item"><a href="Ergo.html.Label.html#item">item</a></li>
            
                <li data-name="Ergo.html.Label#item"><a href="Ergo.html.Label.html#item">item</a></li>
            
                <li data-name="Ergo.html.Label#layoutFactory"><a href="Ergo.html.Label.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.html.Label#layoutFactory"><a href="Ergo.html.Label.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.html.Label#next"><a href="Ergo.html.Label.html#next">next</a></li>
            
                <li data-name="Ergo.html.Label#next"><a href="Ergo.html.Label.html#next">next</a></li>
            
                <li data-name="Ergo.html.Label#opt"><a href="Ergo.html.Label.html#opt">opt</a></li>
            
                <li data-name="Ergo.html.Label#opt"><a href="Ergo.html.Label.html#opt">opt</a></li>
            
                <li data-name="Ergo.html.Label#parents"><a href="Ergo.html.Label.html#parents">parents</a></li>
            
                <li data-name="Ergo.html.Label#parents"><a href="Ergo.html.Label.html#parents">parents</a></li>
            
                <li data-name="Ergo.html.Label#prev"><a href="Ergo.html.Label.html#prev">prev</a></li>
            
                <li data-name="Ergo.html.Label#prev"><a href="Ergo.html.Label.html#prev">prev</a></li>
            
                <li data-name="Ergo.html.Label#walk"><a href="Ergo.html.Label.html#walk">walk</a></li>
            
                <li data-name="Ergo.html.Label#walk"><a href="Ergo.html.Label.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.html.Radio">
            <span class="title">
                <a href="Ergo.html.Radio.html">Ergo.html.Radio</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.html.Radio#_includes"><a href="Ergo.html.Radio.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.html.Radio#value"><a href="Ergo.html.Radio.html#value">value</a></li>
            
                <li data-name="Ergo.html.Radio#value"><a href="Ergo.html.Radio.html#value">value</a></li>
            
                <li data-name="Ergo.html.Radio#vdom"><a href="Ergo.html.Radio.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.html.Radio#vdom"><a href="Ergo.html.Radio.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.html.Radio#_construct"><a href="Ergo.html.Radio.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.html.Radio#_destroy"><a href="Ergo.html.Radio.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.html.Radio#_post_construct"><a href="Ergo.html.Radio.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.html.Radio#_pre_construct"><a href="Ergo.html.Radio.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.html.Radio#action"><a href="Ergo.html.Radio.html#action">action</a></li>
            
                <li data-name="Ergo.html.Radio#component"><a href="Ergo.html.Radio.html#component">component</a></li>
            
                <li data-name="Ergo.html.Radio#item"><a href="Ergo.html.Radio.html#item">item</a></li>
            
                <li data-name="Ergo.html.Radio#layoutFactory"><a href="Ergo.html.Radio.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.html.Radio#next"><a href="Ergo.html.Radio.html#next">next</a></li>
            
                <li data-name="Ergo.html.Radio#opt"><a href="Ergo.html.Radio.html#opt">opt</a></li>
            
                <li data-name="Ergo.html.Radio#parents"><a href="Ergo.html.Radio.html#parents">parents</a></li>
            
                <li data-name="Ergo.html.Radio#prev"><a href="Ergo.html.Radio.html#prev">prev</a></li>
            
                <li data-name="Ergo.html.Radio#walk"><a href="Ergo.html.Radio.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.html.Select">
            <span class="title">
                <a href="Ergo.html.Select.html">Ergo.html.Select</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.html.Select#_includes"><a href="Ergo.html.Select.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.html.Select#value"><a href="Ergo.html.Select.html#value">value</a></li>
            
                <li data-name="Ergo.html.Select#value"><a href="Ergo.html.Select.html#value">value</a></li>
            
                <li data-name="Ergo.html.Select#vdom"><a href="Ergo.html.Select.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.html.Select#vdom"><a href="Ergo.html.Select.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.html.Select#_construct"><a href="Ergo.html.Select.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.html.Select#_destroy"><a href="Ergo.html.Select.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.html.Select#_post_construct"><a href="Ergo.html.Select.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.html.Select#_pre_construct"><a href="Ergo.html.Select.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.html.Select#action"><a href="Ergo.html.Select.html#action">action</a></li>
            
                <li data-name="Ergo.html.Select#component"><a href="Ergo.html.Select.html#component">component</a></li>
            
                <li data-name="Ergo.html.Select#item"><a href="Ergo.html.Select.html#item">item</a></li>
            
                <li data-name="Ergo.html.Select#layoutFactory"><a href="Ergo.html.Select.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.html.Select#next"><a href="Ergo.html.Select.html#next">next</a></li>
            
                <li data-name="Ergo.html.Select#opt"><a href="Ergo.html.Select.html#opt">opt</a></li>
            
                <li data-name="Ergo.html.Select#parents"><a href="Ergo.html.Select.html#parents">parents</a></li>
            
                <li data-name="Ergo.html.Select#prev"><a href="Ergo.html.Select.html#prev">prev</a></li>
            
                <li data-name="Ergo.html.Select#walk"><a href="Ergo.html.Select.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.html.Textarea">
            <span class="title">
                <a href="Ergo.html.Textarea.html">Ergo.html.Textarea</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.html.Textarea#_includes"><a href="Ergo.html.Textarea.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.html.Textarea#value"><a href="Ergo.html.Textarea.html#value">value</a></li>
            
                <li data-name="Ergo.html.Textarea#value"><a href="Ergo.html.Textarea.html#value">value</a></li>
            
                <li data-name="Ergo.html.Textarea#vdom"><a href="Ergo.html.Textarea.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.html.Textarea#vdom"><a href="Ergo.html.Textarea.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.html.Textarea#_construct"><a href="Ergo.html.Textarea.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.html.Textarea#_destroy"><a href="Ergo.html.Textarea.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.html.Textarea#_post_construct"><a href="Ergo.html.Textarea.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.html.Textarea#_pre_construct"><a href="Ergo.html.Textarea.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.html.Textarea#action"><a href="Ergo.html.Textarea.html#action">action</a></li>
            
                <li data-name="Ergo.html.Textarea#component"><a href="Ergo.html.Textarea.html#component">component</a></li>
            
                <li data-name="Ergo.html.Textarea#item"><a href="Ergo.html.Textarea.html#item">item</a></li>
            
                <li data-name="Ergo.html.Textarea#layoutFactory"><a href="Ergo.html.Textarea.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.html.Textarea#next"><a href="Ergo.html.Textarea.html#next">next</a></li>
            
                <li data-name="Ergo.html.Textarea#opt"><a href="Ergo.html.Textarea.html#opt">opt</a></li>
            
                <li data-name="Ergo.html.Textarea#parents"><a href="Ergo.html.Textarea.html#parents">parents</a></li>
            
                <li data-name="Ergo.html.Textarea#prev"><a href="Ergo.html.Textarea.html#prev">prev</a></li>
            
                <li data-name="Ergo.html.Textarea#walk"><a href="Ergo.html.Textarea.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.html.TextInput">
            <span class="title">
                <a href="Ergo.html.TextInput.html">Ergo.html.TextInput</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.html.TextInput#_includes"><a href="Ergo.html.TextInput.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.html.TextInput#value"><a href="Ergo.html.TextInput.html#value">value</a></li>
            
                <li data-name="Ergo.html.TextInput#value"><a href="Ergo.html.TextInput.html#value">value</a></li>
            
                <li data-name="Ergo.html.TextInput#vdom"><a href="Ergo.html.TextInput.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.html.TextInput#vdom"><a href="Ergo.html.TextInput.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.html.TextInput#_construct"><a href="Ergo.html.TextInput.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.html.TextInput#_destroy"><a href="Ergo.html.TextInput.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.html.TextInput#_post_construct"><a href="Ergo.html.TextInput.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.html.TextInput#_pre_construct"><a href="Ergo.html.TextInput.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.html.TextInput#action"><a href="Ergo.html.TextInput.html#action">action</a></li>
            
                <li data-name="Ergo.html.TextInput#component"><a href="Ergo.html.TextInput.html#component">component</a></li>
            
                <li data-name="Ergo.html.TextInput#item"><a href="Ergo.html.TextInput.html#item">item</a></li>
            
                <li data-name="Ergo.html.TextInput#layoutFactory"><a href="Ergo.html.TextInput.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.html.TextInput#next"><a href="Ergo.html.TextInput.html#next">next</a></li>
            
                <li data-name="Ergo.html.TextInput#opt"><a href="Ergo.html.TextInput.html#opt">opt</a></li>
            
                <li data-name="Ergo.html.TextInput#parents"><a href="Ergo.html.TextInput.html#parents">parents</a></li>
            
                <li data-name="Ergo.html.TextInput#prev"><a href="Ergo.html.TextInput.html#prev">prev</a></li>
            
                <li data-name="Ergo.html.TextInput#walk"><a href="Ergo.html.TextInput.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.html.Widget">
            <span class="title">
                <a href="Ergo.html.Widget.html">Ergo.html.Widget</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.html.Widget#_includes"><a href="Ergo.html.Widget.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.html.Widget#value"><a href="Ergo.html.Widget.html#value">value</a></li>
            
                <li data-name="Ergo.html.Widget#value"><a href="Ergo.html.Widget.html#value">value</a></li>
            
                <li data-name="Ergo.html.Widget#vdom"><a href="Ergo.html.Widget.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.html.Widget#vdom"><a href="Ergo.html.Widget.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.html.Widget#_construct"><a href="Ergo.html.Widget.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.html.Widget#_destroy"><a href="Ergo.html.Widget.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.html.Widget#_post_construct"><a href="Ergo.html.Widget.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.html.Widget#_pre_construct"><a href="Ergo.html.Widget.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.html.Widget#action"><a href="Ergo.html.Widget.html#action">action</a></li>
            
                <li data-name="Ergo.html.Widget#component"><a href="Ergo.html.Widget.html#component">component</a></li>
            
                <li data-name="Ergo.html.Widget#item"><a href="Ergo.html.Widget.html#item">item</a></li>
            
                <li data-name="Ergo.html.Widget#layoutFactory"><a href="Ergo.html.Widget.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.html.Widget#next"><a href="Ergo.html.Widget.html#next">next</a></li>
            
                <li data-name="Ergo.html.Widget#opt"><a href="Ergo.html.Widget.html#opt">opt</a></li>
            
                <li data-name="Ergo.html.Widget#parents"><a href="Ergo.html.Widget.html#parents">parents</a></li>
            
                <li data-name="Ergo.html.Widget#prev"><a href="Ergo.html.Widget.html#prev">prev</a></li>
            
                <li data-name="Ergo.html.Widget#walk"><a href="Ergo.html.Widget.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.widgets._Text">
            <span class="title">
                <a href="Ergo.widgets._Text.html">Ergo.widgets._Text</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.widgets._Text#_includes"><a href="Ergo.widgets._Text.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.widgets._Text#value"><a href="Ergo.widgets._Text.html#value">value</a></li>
            
                <li data-name="Ergo.widgets._Text#value"><a href="Ergo.widgets._Text.html#value">value</a></li>
            
                <li data-name="Ergo.widgets._Text#vdom"><a href="Ergo.widgets._Text.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.widgets._Text#vdom"><a href="Ergo.widgets._Text.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.widgets._Text#_construct"><a href="Ergo.widgets._Text.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.widgets._Text#_destroy"><a href="Ergo.widgets._Text.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.widgets._Text#_post_construct"><a href="Ergo.widgets._Text.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.widgets._Text#_pre_construct"><a href="Ergo.widgets._Text.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.widgets._Text#action"><a href="Ergo.widgets._Text.html#action">action</a></li>
            
                <li data-name="Ergo.widgets._Text#component"><a href="Ergo.widgets._Text.html#component">component</a></li>
            
                <li data-name="Ergo.widgets._Text#item"><a href="Ergo.widgets._Text.html#item">item</a></li>
            
                <li data-name="Ergo.widgets._Text#layoutFactory"><a href="Ergo.widgets._Text.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.widgets._Text#next"><a href="Ergo.widgets._Text.html#next">next</a></li>
            
                <li data-name="Ergo.widgets._Text#opt"><a href="Ergo.widgets._Text.html#opt">opt</a></li>
            
                <li data-name="Ergo.widgets._Text#parents"><a href="Ergo.widgets._Text.html#parents">parents</a></li>
            
                <li data-name="Ergo.widgets._Text#prev"><a href="Ergo.widgets._Text.html#prev">prev</a></li>
            
                <li data-name="Ergo.widgets._Text#walk"><a href="Ergo.widgets._Text.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.widgets.Box">
            <span class="title">
                <a href="Ergo.widgets.Box.html">Ergo.widgets.Box</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.widgets.Box#_includes"><a href="Ergo.widgets.Box.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.widgets.Box#value"><a href="Ergo.widgets.Box.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.Box#value"><a href="Ergo.widgets.Box.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.Box#vdom"><a href="Ergo.widgets.Box.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.widgets.Box#vdom"><a href="Ergo.widgets.Box.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.widgets.Box#_construct"><a href="Ergo.widgets.Box.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.widgets.Box#_destroy"><a href="Ergo.widgets.Box.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.widgets.Box#_post_construct"><a href="Ergo.widgets.Box.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.widgets.Box#_pre_construct"><a href="Ergo.widgets.Box.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.widgets.Box#action"><a href="Ergo.widgets.Box.html#action">action</a></li>
            
                <li data-name="Ergo.widgets.Box#component"><a href="Ergo.widgets.Box.html#component">component</a></li>
            
                <li data-name="Ergo.widgets.Box#item"><a href="Ergo.widgets.Box.html#item">item</a></li>
            
                <li data-name="Ergo.widgets.Box#layoutFactory"><a href="Ergo.widgets.Box.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.widgets.Box#next"><a href="Ergo.widgets.Box.html#next">next</a></li>
            
                <li data-name="Ergo.widgets.Box#opt"><a href="Ergo.widgets.Box.html#opt">opt</a></li>
            
                <li data-name="Ergo.widgets.Box#parents"><a href="Ergo.widgets.Box.html#parents">parents</a></li>
            
                <li data-name="Ergo.widgets.Box#prev"><a href="Ergo.widgets.Box.html#prev">prev</a></li>
            
                <li data-name="Ergo.widgets.Box#walk"><a href="Ergo.widgets.Box.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.widgets.Button">
            <span class="title">
                <a href="Ergo.widgets.Button.html">Ergo.widgets.Button</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.widgets.Button#_includes"><a href="Ergo.widgets.Button.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.widgets.Button#value"><a href="Ergo.widgets.Button.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.Button#value"><a href="Ergo.widgets.Button.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.Button#vdom"><a href="Ergo.widgets.Button.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.widgets.Button#vdom"><a href="Ergo.widgets.Button.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.widgets.Button#_construct"><a href="Ergo.widgets.Button.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.widgets.Button#_destroy"><a href="Ergo.widgets.Button.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.widgets.Button#_post_construct"><a href="Ergo.widgets.Button.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.widgets.Button#_pre_construct"><a href="Ergo.widgets.Button.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.widgets.Button#action"><a href="Ergo.widgets.Button.html#action">action</a></li>
            
                <li data-name="Ergo.widgets.Button#component"><a href="Ergo.widgets.Button.html#component">component</a></li>
            
                <li data-name="Ergo.widgets.Button#item"><a href="Ergo.widgets.Button.html#item">item</a></li>
            
                <li data-name="Ergo.widgets.Button#layoutFactory"><a href="Ergo.widgets.Button.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.widgets.Button#next"><a href="Ergo.widgets.Button.html#next">next</a></li>
            
                <li data-name="Ergo.widgets.Button#opt"><a href="Ergo.widgets.Button.html#opt">opt</a></li>
            
                <li data-name="Ergo.widgets.Button#parents"><a href="Ergo.widgets.Button.html#parents">parents</a></li>
            
                <li data-name="Ergo.widgets.Button#prev"><a href="Ergo.widgets.Button.html#prev">prev</a></li>
            
                <li data-name="Ergo.widgets.Button#walk"><a href="Ergo.widgets.Button.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.widgets.Icon">
            <span class="title">
                <a href="Ergo.widgets.Icon.html">Ergo.widgets.Icon</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.widgets.Icon#_includes"><a href="Ergo.widgets.Icon.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.widgets.Icon#value"><a href="Ergo.widgets.Icon.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.Icon#value"><a href="Ergo.widgets.Icon.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.Icon#vdom"><a href="Ergo.widgets.Icon.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.widgets.Icon#vdom"><a href="Ergo.widgets.Icon.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.widgets.Icon#_construct"><a href="Ergo.widgets.Icon.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.widgets.Icon#_destroy"><a href="Ergo.widgets.Icon.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.widgets.Icon#_post_construct"><a href="Ergo.widgets.Icon.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.widgets.Icon#_pre_construct"><a href="Ergo.widgets.Icon.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.widgets.Icon#action"><a href="Ergo.widgets.Icon.html#action">action</a></li>
            
                <li data-name="Ergo.widgets.Icon#component"><a href="Ergo.widgets.Icon.html#component">component</a></li>
            
                <li data-name="Ergo.widgets.Icon#item"><a href="Ergo.widgets.Icon.html#item">item</a></li>
            
                <li data-name="Ergo.widgets.Icon#layoutFactory"><a href="Ergo.widgets.Icon.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.widgets.Icon#next"><a href="Ergo.widgets.Icon.html#next">next</a></li>
            
                <li data-name="Ergo.widgets.Icon#opt"><a href="Ergo.widgets.Icon.html#opt">opt</a></li>
            
                <li data-name="Ergo.widgets.Icon#parents"><a href="Ergo.widgets.Icon.html#parents">parents</a></li>
            
                <li data-name="Ergo.widgets.Icon#prev"><a href="Ergo.widgets.Icon.html#prev">prev</a></li>
            
                <li data-name="Ergo.widgets.Icon#walk"><a href="Ergo.widgets.Icon.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.widgets.Link">
            <span class="title">
                <a href="Ergo.widgets.Link.html">Ergo.widgets.Link</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.widgets.Link#_includes"><a href="Ergo.widgets.Link.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.widgets.Link#value"><a href="Ergo.widgets.Link.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.Link#value"><a href="Ergo.widgets.Link.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.Link#vdom"><a href="Ergo.widgets.Link.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.widgets.Link#vdom"><a href="Ergo.widgets.Link.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.widgets.Link#_construct"><a href="Ergo.widgets.Link.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.widgets.Link#_destroy"><a href="Ergo.widgets.Link.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.widgets.Link#_post_construct"><a href="Ergo.widgets.Link.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.widgets.Link#_pre_construct"><a href="Ergo.widgets.Link.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.widgets.Link#action"><a href="Ergo.widgets.Link.html#action">action</a></li>
            
                <li data-name="Ergo.widgets.Link#component"><a href="Ergo.widgets.Link.html#component">component</a></li>
            
                <li data-name="Ergo.widgets.Link#item"><a href="Ergo.widgets.Link.html#item">item</a></li>
            
                <li data-name="Ergo.widgets.Link#layoutFactory"><a href="Ergo.widgets.Link.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.widgets.Link#next"><a href="Ergo.widgets.Link.html#next">next</a></li>
            
                <li data-name="Ergo.widgets.Link#opt"><a href="Ergo.widgets.Link.html#opt">opt</a></li>
            
                <li data-name="Ergo.widgets.Link#parents"><a href="Ergo.widgets.Link.html#parents">parents</a></li>
            
                <li data-name="Ergo.widgets.Link#prev"><a href="Ergo.widgets.Link.html#prev">prev</a></li>
            
                <li data-name="Ergo.widgets.Link#walk"><a href="Ergo.widgets.Link.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.widgets.List">
            <span class="title">
                <a href="Ergo.widgets.List.html">Ergo.widgets.List</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.widgets.List#_includes"><a href="Ergo.widgets.List.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.widgets.List#value"><a href="Ergo.widgets.List.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.List#value"><a href="Ergo.widgets.List.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.List#vdom"><a href="Ergo.widgets.List.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.widgets.List#vdom"><a href="Ergo.widgets.List.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.widgets.List#_construct"><a href="Ergo.widgets.List.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.widgets.List#_destroy"><a href="Ergo.widgets.List.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.widgets.List#_post_construct"><a href="Ergo.widgets.List.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.widgets.List#_pre_construct"><a href="Ergo.widgets.List.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.widgets.List#action"><a href="Ergo.widgets.List.html#action">action</a></li>
            
                <li data-name="Ergo.widgets.List#component"><a href="Ergo.widgets.List.html#component">component</a></li>
            
                <li data-name="Ergo.widgets.List#item"><a href="Ergo.widgets.List.html#item">item</a></li>
            
                <li data-name="Ergo.widgets.List#layoutFactory"><a href="Ergo.widgets.List.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.widgets.List#next"><a href="Ergo.widgets.List.html#next">next</a></li>
            
                <li data-name="Ergo.widgets.List#opt"><a href="Ergo.widgets.List.html#opt">opt</a></li>
            
                <li data-name="Ergo.widgets.List#parents"><a href="Ergo.widgets.List.html#parents">parents</a></li>
            
                <li data-name="Ergo.widgets.List#prev"><a href="Ergo.widgets.List.html#prev">prev</a></li>
            
                <li data-name="Ergo.widgets.List#walk"><a href="Ergo.widgets.List.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.widgets.NestedItem">
            <span class="title">
                <a href="Ergo.widgets.NestedItem.html">Ergo.widgets.NestedItem</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.widgets.NestedItem#_includes"><a href="Ergo.widgets.NestedItem.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.widgets.NestedItem#value"><a href="Ergo.widgets.NestedItem.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.NestedItem#value"><a href="Ergo.widgets.NestedItem.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.NestedItem#vdom"><a href="Ergo.widgets.NestedItem.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.widgets.NestedItem#vdom"><a href="Ergo.widgets.NestedItem.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.widgets.NestedItem#_construct"><a href="Ergo.widgets.NestedItem.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.widgets.NestedItem#_destroy"><a href="Ergo.widgets.NestedItem.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.widgets.NestedItem#_post_construct"><a href="Ergo.widgets.NestedItem.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.widgets.NestedItem#_pre_construct"><a href="Ergo.widgets.NestedItem.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.widgets.NestedItem#action"><a href="Ergo.widgets.NestedItem.html#action">action</a></li>
            
                <li data-name="Ergo.widgets.NestedItem#component"><a href="Ergo.widgets.NestedItem.html#component">component</a></li>
            
                <li data-name="Ergo.widgets.NestedItem#item"><a href="Ergo.widgets.NestedItem.html#item">item</a></li>
            
                <li data-name="Ergo.widgets.NestedItem#layoutFactory"><a href="Ergo.widgets.NestedItem.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.widgets.NestedItem#next"><a href="Ergo.widgets.NestedItem.html#next">next</a></li>
            
                <li data-name="Ergo.widgets.NestedItem#opt"><a href="Ergo.widgets.NestedItem.html#opt">opt</a></li>
            
                <li data-name="Ergo.widgets.NestedItem#parents"><a href="Ergo.widgets.NestedItem.html#parents">parents</a></li>
            
                <li data-name="Ergo.widgets.NestedItem#path"><a href="Ergo.widgets.NestedItem.html#path">path</a></li>
            
                <li data-name="Ergo.widgets.NestedItem#prev"><a href="Ergo.widgets.NestedItem.html#prev">prev</a></li>
            
                <li data-name="Ergo.widgets.NestedItem#walk"><a href="Ergo.widgets.NestedItem.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.widgets.NestedList">
            <span class="title">
                <a href="Ergo.widgets.NestedList.html">Ergo.widgets.NestedList</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.widgets.NestedList#_includes"><a href="Ergo.widgets.NestedList.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.widgets.NestedList#value"><a href="Ergo.widgets.NestedList.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.NestedList#value"><a href="Ergo.widgets.NestedList.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.NestedList#vdom"><a href="Ergo.widgets.NestedList.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.widgets.NestedList#vdom"><a href="Ergo.widgets.NestedList.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.widgets.NestedList#_construct"><a href="Ergo.widgets.NestedList.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.widgets.NestedList#_destroy"><a href="Ergo.widgets.NestedList.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.widgets.NestedList#_post_construct"><a href="Ergo.widgets.NestedList.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.widgets.NestedList#_pre_construct"><a href="Ergo.widgets.NestedList.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.widgets.NestedList#action"><a href="Ergo.widgets.NestedList.html#action">action</a></li>
            
                <li data-name="Ergo.widgets.NestedList#component"><a href="Ergo.widgets.NestedList.html#component">component</a></li>
            
                <li data-name="Ergo.widgets.NestedList#item"><a href="Ergo.widgets.NestedList.html#item">item</a></li>
            
                <li data-name="Ergo.widgets.NestedList#layoutFactory"><a href="Ergo.widgets.NestedList.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.widgets.NestedList#next"><a href="Ergo.widgets.NestedList.html#next">next</a></li>
            
                <li data-name="Ergo.widgets.NestedList#opt"><a href="Ergo.widgets.NestedList.html#opt">opt</a></li>
            
                <li data-name="Ergo.widgets.NestedList#parents"><a href="Ergo.widgets.NestedList.html#parents">parents</a></li>
            
                <li data-name="Ergo.widgets.NestedList#prev"><a href="Ergo.widgets.NestedList.html#prev">prev</a></li>
            
                <li data-name="Ergo.widgets.NestedList#walk"><a href="Ergo.widgets.NestedList.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.widgets.Panel">
            <span class="title">
                <a href="Ergo.widgets.Panel.html">Ergo.widgets.Panel</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.widgets.Panel#_includes"><a href="Ergo.widgets.Panel.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.widgets.Panel#value"><a href="Ergo.widgets.Panel.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.Panel#value"><a href="Ergo.widgets.Panel.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.Panel#vdom"><a href="Ergo.widgets.Panel.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.widgets.Panel#vdom"><a href="Ergo.widgets.Panel.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.widgets.Panel#_construct"><a href="Ergo.widgets.Panel.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.widgets.Panel#_destroy"><a href="Ergo.widgets.Panel.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.widgets.Panel#_post_construct"><a href="Ergo.widgets.Panel.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.widgets.Panel#_pre_construct"><a href="Ergo.widgets.Panel.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.widgets.Panel#action"><a href="Ergo.widgets.Panel.html#action">action</a></li>
            
                <li data-name="Ergo.widgets.Panel#component"><a href="Ergo.widgets.Panel.html#component">component</a></li>
            
                <li data-name="Ergo.widgets.Panel#item"><a href="Ergo.widgets.Panel.html#item">item</a></li>
            
                <li data-name="Ergo.widgets.Panel#layoutFactory"><a href="Ergo.widgets.Panel.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.widgets.Panel#next"><a href="Ergo.widgets.Panel.html#next">next</a></li>
            
                <li data-name="Ergo.widgets.Panel#opt"><a href="Ergo.widgets.Panel.html#opt">opt</a></li>
            
                <li data-name="Ergo.widgets.Panel#parents"><a href="Ergo.widgets.Panel.html#parents">parents</a></li>
            
                <li data-name="Ergo.widgets.Panel#prev"><a href="Ergo.widgets.Panel.html#prev">prev</a></li>
            
                <li data-name="Ergo.widgets.Panel#walk"><a href="Ergo.widgets.Panel.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.widgets.Select">
            <span class="title">
                <a href="Ergo.widgets.Select.html">Ergo.widgets.Select</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.widgets.Select#_includes"><a href="Ergo.widgets.Select.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.widgets.Select#value"><a href="Ergo.widgets.Select.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.Select#value"><a href="Ergo.widgets.Select.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.Select#vdom"><a href="Ergo.widgets.Select.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.widgets.Select#vdom"><a href="Ergo.widgets.Select.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.widgets.Select#_construct"><a href="Ergo.widgets.Select.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.widgets.Select#_destroy"><a href="Ergo.widgets.Select.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.widgets.Select#_post_construct"><a href="Ergo.widgets.Select.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.widgets.Select#_pre_construct"><a href="Ergo.widgets.Select.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.widgets.Select#action"><a href="Ergo.widgets.Select.html#action">action</a></li>
            
                <li data-name="Ergo.widgets.Select#component"><a href="Ergo.widgets.Select.html#component">component</a></li>
            
                <li data-name="Ergo.widgets.Select#item"><a href="Ergo.widgets.Select.html#item">item</a></li>
            
                <li data-name="Ergo.widgets.Select#layoutFactory"><a href="Ergo.widgets.Select.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.widgets.Select#next"><a href="Ergo.widgets.Select.html#next">next</a></li>
            
                <li data-name="Ergo.widgets.Select#opt"><a href="Ergo.widgets.Select.html#opt">opt</a></li>
            
                <li data-name="Ergo.widgets.Select#parents"><a href="Ergo.widgets.Select.html#parents">parents</a></li>
            
                <li data-name="Ergo.widgets.Select#prev"><a href="Ergo.widgets.Select.html#prev">prev</a></li>
            
                <li data-name="Ergo.widgets.Select#walk"><a href="Ergo.widgets.Select.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.widgets.Table">
            <span class="title">
                <a href="Ergo.widgets.Table.html">Ergo.widgets.Table</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.widgets.Table#_includes"><a href="Ergo.widgets.Table.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.widgets.Table#columns"><a href="Ergo.widgets.Table.html#columns">columns</a></li>
            
                <li data-name="Ergo.widgets.Table#value"><a href="Ergo.widgets.Table.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.Table#value"><a href="Ergo.widgets.Table.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.Table#vdom"><a href="Ergo.widgets.Table.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.widgets.Table#vdom"><a href="Ergo.widgets.Table.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.widgets.Table#_construct"><a href="Ergo.widgets.Table.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.widgets.Table#_destroy"><a href="Ergo.widgets.Table.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.widgets.Table#_post_construct"><a href="Ergo.widgets.Table.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.widgets.Table#_pre_construct"><a href="Ergo.widgets.Table.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.widgets.Table#action"><a href="Ergo.widgets.Table.html#action">action</a></li>
            
                <li data-name="Ergo.widgets.Table#component"><a href="Ergo.widgets.Table.html#component">component</a></li>
            
                <li data-name="Ergo.widgets.Table#item"><a href="Ergo.widgets.Table.html#item">item</a></li>
            
                <li data-name="Ergo.widgets.Table#layoutFactory"><a href="Ergo.widgets.Table.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.widgets.Table#next"><a href="Ergo.widgets.Table.html#next">next</a></li>
            
                <li data-name="Ergo.widgets.Table#opt"><a href="Ergo.widgets.Table.html#opt">opt</a></li>
            
                <li data-name="Ergo.widgets.Table#parents"><a href="Ergo.widgets.Table.html#parents">parents</a></li>
            
                <li data-name="Ergo.widgets.Table#prev"><a href="Ergo.widgets.Table.html#prev">prev</a></li>
            
                <li data-name="Ergo.widgets.Table#walk"><a href="Ergo.widgets.Table.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.widgets.TableRow">
            <span class="title">
                <a href="Ergo.widgets.TableRow.html">Ergo.widgets.TableRow</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.widgets.TableRow#_includes"><a href="Ergo.widgets.TableRow.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.widgets.TableRow#value"><a href="Ergo.widgets.TableRow.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.TableRow#value"><a href="Ergo.widgets.TableRow.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.TableRow#vdom"><a href="Ergo.widgets.TableRow.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.widgets.TableRow#vdom"><a href="Ergo.widgets.TableRow.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.widgets.TableRow#_construct"><a href="Ergo.widgets.TableRow.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.widgets.TableRow#_destroy"><a href="Ergo.widgets.TableRow.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.widgets.TableRow#_post_construct"><a href="Ergo.widgets.TableRow.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.widgets.TableRow#_pre_construct"><a href="Ergo.widgets.TableRow.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.widgets.TableRow#action"><a href="Ergo.widgets.TableRow.html#action">action</a></li>
            
                <li data-name="Ergo.widgets.TableRow#component"><a href="Ergo.widgets.TableRow.html#component">component</a></li>
            
                <li data-name="Ergo.widgets.TableRow#item"><a href="Ergo.widgets.TableRow.html#item">item</a></li>
            
                <li data-name="Ergo.widgets.TableRow#layoutFactory"><a href="Ergo.widgets.TableRow.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.widgets.TableRow#next"><a href="Ergo.widgets.TableRow.html#next">next</a></li>
            
                <li data-name="Ergo.widgets.TableRow#opt"><a href="Ergo.widgets.TableRow.html#opt">opt</a></li>
            
                <li data-name="Ergo.widgets.TableRow#parents"><a href="Ergo.widgets.TableRow.html#parents">parents</a></li>
            
                <li data-name="Ergo.widgets.TableRow#prev"><a href="Ergo.widgets.TableRow.html#prev">prev</a></li>
            
                <li data-name="Ergo.widgets.TableRow#walk"><a href="Ergo.widgets.TableRow.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.widgets.Text">
            <span class="title">
                <a href="Ergo.widgets.Text.html">Ergo.widgets.Text</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.widgets.Text#_includes"><a href="Ergo.widgets.Text.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.widgets.Text#value"><a href="Ergo.widgets.Text.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.Text#value"><a href="Ergo.widgets.Text.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.Text#vdom"><a href="Ergo.widgets.Text.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.widgets.Text#vdom"><a href="Ergo.widgets.Text.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.widgets.Text#_construct"><a href="Ergo.widgets.Text.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.widgets.Text#_destroy"><a href="Ergo.widgets.Text.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.widgets.Text#_post_construct"><a href="Ergo.widgets.Text.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.widgets.Text#_pre_construct"><a href="Ergo.widgets.Text.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.widgets.Text#action"><a href="Ergo.widgets.Text.html#action">action</a></li>
            
                <li data-name="Ergo.widgets.Text#component"><a href="Ergo.widgets.Text.html#component">component</a></li>
            
                <li data-name="Ergo.widgets.Text#item"><a href="Ergo.widgets.Text.html#item">item</a></li>
            
                <li data-name="Ergo.widgets.Text#layoutFactory"><a href="Ergo.widgets.Text.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.widgets.Text#next"><a href="Ergo.widgets.Text.html#next">next</a></li>
            
                <li data-name="Ergo.widgets.Text#opt"><a href="Ergo.widgets.Text.html#opt">opt</a></li>
            
                <li data-name="Ergo.widgets.Text#parents"><a href="Ergo.widgets.Text.html#parents">parents</a></li>
            
                <li data-name="Ergo.widgets.Text#prev"><a href="Ergo.widgets.Text.html#prev">prev</a></li>
            
                <li data-name="Ergo.widgets.Text#walk"><a href="Ergo.widgets.Text.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ergo.widgets.Tree">
            <span class="title">
                <a href="Ergo.widgets.Tree.html">Ergo.widgets.Tree</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Ergo.widgets.Tree#_includes"><a href="Ergo.widgets.Tree.html#_includes">_includes</a></li>
            
                <li data-name="Ergo.widgets.Tree#value"><a href="Ergo.widgets.Tree.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.Tree#value"><a href="Ergo.widgets.Tree.html#value">value</a></li>
            
                <li data-name="Ergo.widgets.Tree#vdom"><a href="Ergo.widgets.Tree.html#vdom">vdom</a></li>
            
                <li data-name="Ergo.widgets.Tree#vdom"><a href="Ergo.widgets.Tree.html#vdom">vdom</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Ergo.widgets.Tree#_construct"><a href="Ergo.widgets.Tree.html#_construct">_construct</a></li>
            
                <li data-name="Ergo.widgets.Tree#_destroy"><a href="Ergo.widgets.Tree.html#_destroy">_destroy</a></li>
            
                <li data-name="Ergo.widgets.Tree#_post_construct"><a href="Ergo.widgets.Tree.html#_post_construct">_post_construct</a></li>
            
                <li data-name="Ergo.widgets.Tree#_pre_construct"><a href="Ergo.widgets.Tree.html#_pre_construct">_pre_construct</a></li>
            
                <li data-name="Ergo.widgets.Tree#action"><a href="Ergo.widgets.Tree.html#action">action</a></li>
            
                <li data-name="Ergo.widgets.Tree#component"><a href="Ergo.widgets.Tree.html#component">component</a></li>
            
                <li data-name="Ergo.widgets.Tree#item"><a href="Ergo.widgets.Tree.html#item">item</a></li>
            
                <li data-name="Ergo.widgets.Tree#layoutFactory"><a href="Ergo.widgets.Tree.html#layoutFactory">layoutFactory</a></li>
            
                <li data-name="Ergo.widgets.Tree#next"><a href="Ergo.widgets.Tree.html#next">next</a></li>
            
                <li data-name="Ergo.widgets.Tree#opt"><a href="Ergo.widgets.Tree.html#opt">opt</a></li>
            
                <li data-name="Ergo.widgets.Tree#parents"><a href="Ergo.widgets.Tree.html#parents">parents</a></li>
            
                <li data-name="Ergo.widgets.Tree#prev"><a href="Ergo.widgets.Tree.html#prev">prev</a></li>
            
                <li data-name="Ergo.widgets.Tree#walk"><a href="Ergo.widgets.Tree.html#walk">walk</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="ergojs-core.js.html">Source: ergojs-core.js</h1>
        


    
    <section>
        <article>
            <pre class="prettyprint source "><code>/**
 * @namespace
 *
 */
var Ergo = (function(){

	var E = {};



	/**
	 *       ( )
	 * @param {Object} obj  ,     
	 * @name Ergo.override
	 * @function
	 */
	E.override = function(obj) {
		for(var j = 1; j &lt; arguments.length; j++){
			var overrides = arguments[j] || {};
			for(var i in overrides) {
				var desc = Object.getOwnPropertyDescriptor(overrides, i);
				if( desc &amp;&amp; (desc.set || desc.get) ) {
					var descOrig = Object.getOwnPropertyDescriptor(obj, i);
					if(descOrig) {
						descOrig.set = desc.set || descOrig.set;
						descOrig.get = desc.get || descOrig.get;
					}
					else {
						descOrig = desc;
					}
					Object.defineProperty(obj, i , descOrig);
				}
				else {
					obj[i] = overrides[i];
				}
			}
		}
		return obj;
	};


	// E.merge = function(obj) {
	// 	for(var j = 1; j &lt; arguments.length; j++){
	// 		var overrides = arguments[j] || {};
	// 		for(var i in overrides) {
	// 			var desc = Object.getOwnPropertyDescriptor(overrides, i);
	// 			if( desc &amp;&amp; (desc.set || desc.get) ) {
	// 				//
	// 			}
	// 			else {
	// 				obj[i] = overrides[i];
	// 			}
	// 		}
	// 	}
	// 	return obj;
	// };


	//    /,    
	E.mergeGettersAndSetters = function(obj) {
		for(var j = 1; j &lt; arguments.length; j++){
			var overrides = arguments[j] || {};
			for(var i in overrides) {
				var desc = Object.getOwnPropertyDescriptor(overrides, i);
				if( desc &amp;&amp; (desc.set || desc.get) ) {
					var desc2 = Object.getOwnPropertyDescriptor(obj, i);
					if(desc2) {
						desc2.set = desc2.set || desc.set;
						desc2.get = desc2.get || desc.get;
					}
					else {
						desc2 = desc;
					}
					Object.defineProperty(obj, i , desc2);
				}
			}
		}
		return obj;
	};






	/**
	 *        ()
	 * @param {Object} obj  ,     
	 * @name @Ergo.deep_override
	 * @function
	 *
	 */
	E.deep_override = function(o) {

		for(var j = 1; j &lt; arguments.length; j++) {

			var srcObj = arguments[j];

//			E.each(srcObj, function(p, i){
			for(var i in srcObj) {

				var p = srcObj[i];

				if( p &amp;&amp; p.constructor == Object ){//$.isPlainObject(p) ){
	//				if(!(i in o) || !$.isPlainObject(o[i])) o[i] = {};
					if(!(i in o) || (o[i] &amp;&amp; o[i].constructor != Object)) o[i] = {};
					Ergo.deep_override(o[i], p);
				}
				else if( p &amp;&amp; p.constructor == Array ) {//$.isArray(p) ){
	//				if(!(i in o) || !$.isArray(o[i])) o[i] = [];
					if(!(i in o) || (o[i] &amp;&amp; o[i].constructor != Array)) o[i] = [];
					Ergo.deep_override(o[i], p);
				}
				else {
					o[i] = p;
				}
			}

		}

		return o;
	};




	E.copy = function(srcObj) {
		var o = {};
		for(var i in srcObj) {
			o[i] = srcObj[i];
		}
		return o;
	};



	// var ruleTypes = {
	// 	handlers: function(a, b) {
	// 		for(var i in b) {
	//
	// 		}
	// 	}
	// };


	E.rules = {
		include: 'list',
		set: ['override'],
		get: ['override'],
		events: ['object', {'*': 'list'}],
		as: 'list',
		cls: false,//'list',
		data: false,
		etype: false,
		// cls: 'list',
		// stt: 'list',
		defaultItem: ['object'],
		defaultComponent: ['object'],
		nestedItem: ['object'],
//		'$*': ['object'],
		components: ['object', {'*': ['object']}],
		items: ['array', {'*': ['object']}],
		states: ['object'],//, {'*': 'list'}],
		style: ['override'],//, {'*': 'list'}],
		transitions: ['object'],//, {'*': 'list'}]
	};




	E.mergeOptions = function(o, sources, rules) {

		sources = Array.isArray(sources) ? sources : [sources];

		rules = rules || E.rules;

		for(var i = 0; i &lt; sources.length; i++) {
			for(var j in sources[i]) {
				var name = (j[0] == '~' || j[0] == '!') ? j.substr(1) : j;
				var rule = rules[name] || rules['*'];

				var a = o[name];
				var b = sources[i][j];

				// FIXME
				if( j[0] == '$' ) {
					rule = ['object'];
				}

				//   ,       
				if( rule &amp;&amp; rule.constructor === Array ) {

					if( b == null ) {
						o[name] = b;
					}
					else if(rule[0] == 'override') {
						o[name] = (a == null) ? b : E.deep_override(a, b);
					}
					else if( b.constructor === Object ) {
						a = a || {};
						b = b;
						o[name] = E.mergeOptions(a, b, rule[1]);
					}
					else if( b.constructor === Array ) {
						a = a || [];
						b = [b];
						o[name] = E.mergeOptions(a, b, rule[1]);
					}
					// if( /*o[name] != null &amp;&amp;*/ (b.constructor === Object || b.constructor === Array) ) {
					// 	if( rule[0] == 'object' ) {
					// 		a = a || {};
					// 		b = b;
					// 		o[name] = E.mergeOptions(a, b, rule[1]);
					// 	}
					// 	else if( rule[0] == 'array' ) {
					// 		a = a || [];
					// 		b = [b];
					// 		o[name] = E.mergeOptions(a, b, rule[1]);
					// 	}
					// 	else if( rule[0] == 'override' ) {
					// 		o[name] = (a == null) ? b : E.override(a, b);
					// 	}
					//
					// }
					else {
						o[name] = b;
					}

					// if( b instanceof Object ) {
					//
					// }
					// var a = (rule[0] == 'array') ? (a || []) : (a || {});
					// var b = (rule[0] == 'array') ? [b] : b;
				}
				// else if( rule &amp;&amp; rule.constructor === Array ) {
				// 	o[name] = E.mergeOptions(o[name] || [], sources[i][j], rule[0]);
				// }
				else if( rule ) {

					a = Array.isArray(a) ? a : [a];
					b = Array.isArray(b) ? b : [b];

					if( !o[name] ) {
						o[name] = b;
					}
					else if(j[0] == '!') {
						//  
						o[name] = b;
					}
					else if(j[0] == '~') {
						//  
						for(var n = 0; n &lt; b.length; n++) {
							$ergo.remove(a, b[n]);
						}
						o[name] = a;
					}
					// else if( ruleTypes[rule] ) {
					// 	o[name] = ruleTypes[rule].call(this, a, b);
					// }
					else {
						//  
						o[name] = a.concat(b);
					}

				}
				else if( a &amp;&amp; b &amp;&amp; b.constructor == Object ) {
					$ergo.deep_override(o[name], b);
				}
				else {
					o[name] = b;
				}
			}
		}

		return o;
	}






//	var _clear = false;


/*
	var smart_override_prop = function(o, srcObj, i, context) {


		var p = srcObj[i];


		var prefix = i[0];
//		var j = i;

//		var keep_prefix = !_clear;


		if(prefix == '!' || prefix == '+' || prefix == '-') {
			i = i.substr(1);
		}
		else {

			prefix = false;

			if(i == 'data') prefix = '!'; 										//&lt;--  data  
			if(i == 'mixins') prefix = '+'; 				//&lt;--  mixins 
			if(i == 'cls') prefix = '+';
			if(i == 'as') prefix = '+';
			if(i == 'include') prefix = '+';
			if(i == 'state') prefix = '+';
			if( /^on\S/.test(i) ) prefix = '+';
			if(/\/events$/.test(context)) {
				prefix = '+';
			}

//			if(prefix)
//				keep_prefix = false;


			//       ,    
			if('!'+i in o) {
				prefix = '!';
//				i = '!'+i;
			}
			else if('+'+i in o) {
				prefix = '+';
//				i = '+'+i;
			}
			else if('-'+i in o) {
				prefix = '-';
//				i = '-'+i;
			}

		}






		if(prefix) {//prefix == '!' || prefix == '+' || prefix == '-') {

			var j = prefix + i;

//			var j = i.substr(1);

//			if(_clear) i = j;

			var m = null;


			if(prefix == '+') {

				m = [];

				if(i in o)
					m = o[i];
				if(j in o)
					m = o[j];

				if( !Array.isArray(m) ) m = [m];

				m = m.concat(p);

				o[j] = m;

				// if(keep_prefix) {
					// o[j] = m;
					// if(i in o) delete o[i];
				// }
				// else {
					// o[i] = m;
					// if(j in o) delete o[j];
				// }

				// if(!(i in o)) o[i] = [];
				// if( !$.isArray(o[i]) ) o[i] = [o[i]];
				// p = o[i].concat(p);
				// o[i] = p;

			}
			else if(prefix == '-') {

				m = [];

				if(i in o)
					m = o[i];
				if(j in o)
					m = o[j];

				if( !Array.isArray(m) ) m = [m];

				m = m.concat(p);

				o[j] = m;




				// TODO

				// m = [];
//
				// if(i in o)
					// m = o[i];
				// if(j in o)
					// m = o[j];
//
				// if( !$.isArray(m) ) m = [m];
//
				// if( !$.isArray(p) ) p = [p];
//
				// for(var k = 0; k &lt; p.length; k++)
					// Ergo.remove_from_array(m, p[k]);
//
//
				// if(keep_prefix) {
					// o[j] = m;
					// if(i in o) delete o[i];
				// }
				// else {
					// o[i] = m;
					// if(j in o) delete o[j];
				// }

			}
			else {
				m = p;

				o[j] = m;

//				if(m === undefined) delete o[i];
//				o[i] = p;
			}


			// if(keep_prefix) {
				// o[j] = m;
				// if(i in o) delete o[i];
			// }
			// else {
				// o[i] = m;
				// if(j in o) delete o[j];
			// }

//			if(j in o &amp;&amp; !_clear) delete o[j];
		}
		else{
			//TODO     (deep copy) -
			if( p &amp;&amp; p.constructor == Object ) {//$.isPlainObject(p) ){
	//			if(!(i in o) || !$.isPlainObject(o[i])) o[i] = {};
				if(!(i in o) || (o[i] &amp;&amp; o[i].constructor != Object)) o[i] = {};
				smart_override_obj(o[i], p, context+'/'+i);
			}
			else if( p &amp;&amp; p.constructor == Array ){//$.isArray(p) ){
	//			if(!(i in o) || !$.isArray(o[i])) o[i] = [];
				if(!(i in o) || (o[i] &amp;&amp; o[i].constructor != Array)) o[i] = [];
				smart_override_obj(o[i], p, context+'/'+i);
			}
			else {
				//TODO     

				// //      ,      
				// if(i in o){
					// //     ,  
// //					if(i == 'cls') p = o[i] + ' ' + p;
					// if( /^on\S/.test(i) ) {
						// if( !$.isArray(o[i]) ) o[i] = [o[i]];
						// p = o[i].concat(p);
					// }
					// // if(i == 'state') {
						// // p = o[i] + ' ' + p;
					// // }
				// }

				o[i] = p;
			}
		}

	};



	var smart_override_obj = function(dest, src, context) {

		if(!dest)
			dest = {};


		for(var i in src) {
			smart_override_prop(dest, src, i, context);
		}

	};
*/



	/**
	 * ""       ( )
	 * @param {Object} obj  ,     
	 * @name @Ergo.smart_override
	 * @function
	 *
	 */
/*
	E.smart_override = function(o) {


		//      smart_override,    
		if(o &amp;&amp; o.smart_override) {
			// args     
			var args = Array.prototype.slice.call(arguments);
			args.shift();
			return o.smart_override.apply(o, args);
		}


//		var keep_keys = false;

		if(!o) {
//			_keep_keys = keep_keys = true;
			o = {};
		}

		//   ,   
		for(var j = 1; j &lt; arguments.length; j++){

			var srcObj = arguments[j];

			smart_override_obj(o, srcObj, '');

			// for(var i in srcObj)
				// smart_override_prop(o, srcObj, i);

	//		if( $.isArray(srcObj) ){
	//			for(var i = 0; i &lt; srcObj.length; i++)
	//				Ergo.utils.overrideProp(o, srcObj, i);
	//		}
	//		else {


	//		}
		}

		// if(keep_keys)
			// _keep_keys = false;

		return o;
	};




	E.smart_build = function(o, key) {

		//   +
		for(var i in o) {

			var prefix = i[0];

			if(prefix == '+') {

				var j = i.substr(1);

				var m = (j in o) ? o[j] : [];
				if( !Array.isArray(m) ) m = [m];

				m = m.concat(o[i]);

				o[j] = m;

				delete o[i];
			}


			if(prefix == '-') {

				var j = i.substr(1);

				var m = (j in o) ? o[j] : [];
				if( !Array.isArray(m) ) m = [m];

				for(var n = 0; n &lt; o[i].length; n++) {
					for(var k = 0; k &lt; m.length; k++) {
						if(m[k] == o[i][n]) m.splice(k, 1);
					}
				}

				delete o[i];
			}



			if(prefix == '!') {

				var j = i.substr(1);

				if( o[i] === undefined )
					delete o[j];
				else
					o[j] = o[i];

				delete o[i];
			}

		}

		// //   -
		// for(var i in o) {
		//
		// 	var prefix = i[0];
		//
		// 	if(prefix == '-') {
		//
		// 		var j = i.substr(1);
		//
		// 		var m = (j in o) ? o[j] : [];
		// 		if( !$.isArray(m) ) m = [m];
		//
		// 		for(var n = 0; n &lt; o[i].length; n++) {
		// 			for(var k = 0; k &lt; m.length; k++) {
		// 				if(m[k] == o[i][n]) m.splice(k, 1);
		// 			}
		// 		}
		//
		// 		delete o[i];
		// 	}
		// }
		//
		// //   !
		// for(var i in o) {
		//
		// 	var prefix = i[0];
		//
		// 	if(prefix == '!') {
		//
		// 		var j = i.substr(1);
		//
		// 		if( o[i] === undefined )
		// 			delete o[j];
		// 		else
		// 			o[j] = o[i];
		//
		// 		delete o[i];
		// 	}
		//
		// }



		if( k == 'shortcuts' || k == 'components' || k == 'items')
			return;
//		if(i == 'items')
//			return;

		for(var i in o) {
			if(i == 'defaultItem' || i == 'defaultComponent' || i == 'layout' || i == 'nestedItem')
				continue;
			if(o[i] &amp;&amp; o[i].constructor == Object)
				E.smart_build(o[i], i);
		}

	};
*/


/*
	E.self_smart_override = function() {

		// console.log(this);
		// console.log(arguments);

		_clear = true;

		//   ,   
		for(var j = 0; j &lt; arguments.length; j++){

			var srcObj = arguments[j];

			smart_override_obj(this, srcObj, '');

			// for(var i in srcObj)
				// smart_override_prop(this, srcObj, i);

		}

		_clear = false;

		return this;
	};
*/






//	E.etypes = function() { return _etypes; }

//	E.defineClass = E.declare;




//	E.widget = E.object;




/*
	E.isFunction = function(obj) { return obj instanceof Function; };
	E.isArray = function(obj) {return obj instanceof Array;}
	E.isNumber = function(obj) {return typeof obj == 'number';};
	E.isBoolean = function(obj) {return typeof obj == 'boolean';};
	E.isString = function(obj) {return typeof obj == 'string';};
	E.isObject = function(obj) { return obj.constructor == Object; };
*/


	//   jquery 1.4  ,     Ergo

	/**
	 *    
	 *
	 * @name $.isFunction
	 * @function
	 * @param {Object} obj
	 */
//	E.isFunction = $.isFunction;
	/**
	 *    
	 *
	 * @name $.isArray
	 * @function
	 * @param {Object} obj
	 */
//	E.isArray = $.isArray;
	/**
	 *     
	 *
	 * @name $.isPlainObject
	 * @function
	 * @param {Object} obj
	 */
//	E.isPlainObject = $.isPlainObject;
	/**
	 *    
	 *
	 * @name $.isString
	 * @function
	 * @param {Object} obj
	 */
	E.isString = $.isString = function(obj) {
		return typeof obj == 'string';
	};
	/**
	 *     
	 *
	 * @name Ergo.isBoolean
	 * @function
	 * @param {Object} obj
	 */
	E.isBoolean = $.isBoolean = function(obj) {
		return typeof obj == 'boolean';
	};
	/**
	 *    
	 *
	 * @name $.isNumber
	 * @function
	 * @param {Object} obj
	 */
	// $.isNumber = function(obj) {
		// return typeof obj == 'number';
	// };










	//---------------------------------------------------
	//
	// 
	//
	//---------------------------------------------------


	// E.sort_numbers = function(a, b) {
	// 	return a - b;
	// };





	E.KeyCode = {
		UP: 38,
		DOWN: 40,
		ENTER: 13,
		ESC: 27
	};













	return E;
})();

//var _dino = Ergo;


// alias for Ergo
var ergo = Ergo;


/**
 * @namespace
 */
Ergo.core = {};








/*
 *    Array   
 *
 * @name Array.prototype.remove
 * @function
 * @param {Any} val  
 */

/*
Array.prototype.remove = function(val) {
	var index = -1;
	for(var i = 0; i &lt; this.length; i++) {
		if(this[i] == val) {
			index = i;
			break;
		}
	}
	if(index != -1) this.splice(index, 1);

	return (index != -1);
}
*/

//$ergo = Ergo;


Ergo.globals = {

};





(function(){


	var E = Ergo;



	/**
	 *   
	 *
	 * @name Ergo.extend
	 * @function
	 * @param {Object} p_ctor
	 * @param {Object} ctor
	 * @param {Object} overrides
	 */
	E.extend = function(p_ctor, ctor, overrides) {

		var c = ctor;

		if(typeof c == 'object') {
			overrides = c;
			c = function(){
				if(this.constructor === Object) {
					var a = [this];
					for(var i = 0; i &lt; arguments.length; i++) {
						a.push(arguments[i]);
					}
//					console.log([this].concat(arguments));
					return new (c.bind.apply(c, a))()
				}
				else {
					p_ctor.apply(this, arguments);
				}
			};
		}


		// "" 
		// var F = function(){};
		// F.prototype = p_ctor.prototype;
		// ctor.prototype = new F();
		c.prototype = Object.create(p_ctor.prototype);
		c.prototype.constructor = c;
		c.superclass = p_ctor.prototype;
		c.super_ctor = p_ctor;

		//        
		for(var i in overrides) {
			// ignore getters and setters
			var desc = Object.getOwnPropertyDescriptor(overrides, i);
			if( !(desc &amp;&amp; (desc.get || desc.set)) ) {
				var p = overrides[i];
				if($.isFunction(p)) {
					p.__class__ = c;
					p.__name__ = i;
				}
			}
		}

		E.mergeGettersAndSetters(c.prototype, c.superclass);

		E.override(c.prototype, overrides);


		if(overrides.etype)
			Ergo.alias(overrides.etype, c);
//			_etypes[overrides.etype] = ctor;

		//    extend
		c.extend = function(o) { return E.extend(this, o); };

		return c;
	};


	/**
	 *     
	 *
	 * @name Ergo.walk_hierarchy
	 * @function
	 * @param {Object} ctor ,     
	 * @param {Function} callback ,     
	 */
	E.walk_hierarchy = function(ctor, callback) {
		if(!ctor) return;
		E.walk_hierarchy(ctor.super_ctor, callback);
		callback.call(this, ctor.prototype);
	};


	E.hasGetter = function(obj, i) {

		var desc = Object.getOwnPropertyDescriptor(obj, i);
		if(desc &amp;&amp; desc.get)
			return desc;

		var ctor = obj.constructor;
		while(ctor) {
			var desc = Object.getOwnPropertyDescriptor(ctor.prototype, i);
			if(desc &amp;&amp; desc.get)
				return desc;
			ctor = ctor.super_ctor;
		}
		return false;
	};

	E.hasSetter = function(obj, i) {

		var desc = Object.getOwnPropertyDescriptor(obj, i);
		if(desc &amp;&amp; desc.set)
			return desc;

		var ctor = obj.constructor;
		while(ctor) {
			var desc = Object.getOwnPropertyDescriptor(ctor.prototype, i);
			if(desc &amp;&amp; desc.set)
				return desc;
			ctor = ctor.super_ctor;
		}
		return false;
	};





	var _aliases = {};

	E._aliases = _aliases;


	E.alias = function(alias, obj) {

		// var i = alias.indexOf(':');
		// var ns = 'ergo';
		// if(i > 0) {
			// ns = alias.substr(0, i);
			// alias = alias.substr(i+1);
		// }
//
		// if( !_aliases[ns] ) _aliases[ns] = {};
//
		// ns = _aliases[ns];


		if(arguments.length == 2) {
			_aliases[alias] = obj;
		}
		else
			return _aliases[alias];

	};

	E.aliases = function() {
		return _aliases;
	};



//	var _etypes = {};

	/**
	 *  
	 *
	 * @param {String} class_name   
	 * @param {String|Object} base_class      
	 * @param {Object} overrides      
	 * @param {String} [etype] e- (  ,     )
	 *
	 * @name Ergo.defineClass
	 * @function
	 */
	E.defineClass = function(class_name, bclass, overrides, etype) {

		var base_class;

		if( typeof bclass == 'string' ) {
			var cp_a = bclass.split('.');
			var cp = window;
			for(var i = 0; i &lt; cp_a.length; i++){
				base_class = cp[cp_a[i]];
				if(!base_class) break;
				cp = base_class;
			}

		}
		else {
			base_class = bclass;
		}

//		base_class = (typeof bclass == 'string') ? eval(bclass) : bclass;

		if(base_class === undefined)
			throw 'Unknown base class '+bclass+' for '+class_name;

		var clazz = E.extend(base_class, overrides);

		//     
		var cp_a = class_name.split('.');
		var cp = window;
		for(var i = 0; i &lt; cp_a.length-1; i++){
			var c = cp_a[i];
			if(!cp[c]) cp[c] = {};
			cp = cp[c];
		}

		cp[cp_a[cp_a.length-1]] = clazz;

//		cp[cp_a[cp_a.length-1]] = new Function("base_class", 'return function c() { return base_class.apply(this, arguments); }')(base_class)

		// function() {
		// 	return base_class.apply(this, arguments);
		// };



		//      ,        
		if(!etype)
			etype = overrides.etype;

		//  etype  (  )
		if(etype){
			clazz.prototype.etype = etype;
			Ergo.alias(etype, clazz);
//			_etypes[etype] = clazz;
		}


		if('mixins' in overrides) {
			for(i in overrides.mixins) {
				var mixin = overrides.mixins[i];
				Ergo.deep_override(clazz.prototype, mixin);
			}
		}

		clazz.prototype._class_name = class_name;

		return clazz;
	};


	/**
	 *   Ergo.defineClass
	 */
	E.declare = E.defineClass;

	E.define = E.defineClass;


	/**
	 *      
	 *
	 * @name Ergo.object
	 * @function
	 * @param {Object} options  () 
	 * @param {String} etype  
	 * @return {Ergo.core.Object}
	 */
	E.object = function(ns, options, alias, context) {//defaultType) {

		if(options instanceof Ergo.core.Object) return options;

		var etype = ns+':'+alias;

//		var etype = options.etype || defaultType;

		var ctor = Ergo._aliases[etype];// Ergo.alias(etype);
//		var ctor = _etypes[etype];

		if(!ctor ){
//			Ergo.logger.debug('Class for etype "'+etype+'" not found');
			throw new Error('Class for etype "'+etype+'" not found');
//			return null;
		}

		return new ctor(options, context);

	};





	/**
	 *    
	 *
	 * @name $.isClass
	 * @function
	 * @param {Object} obj
	 *
	 */
	$.isClass = function(obj) {
		return $.isFunction(obj) &amp;&amp; (obj.superclass !== undefined);
	};




})();


//------------------------------------------------------
//
//   
//
//------------------------------------------------------


String.prototype.capitalize = function() {
//	var s = '';
//	for(i = 1; i &lt; this.length; i++) s += this[i];
	return this.charAt(0).toUpperCase() + this.substr(1);
};

// String.prototype.trim = function(){
// 	return this.replace(/^\s+|\s+$/g, '');
// };

/**
 *     Function
 */
Function.prototype.curry = function(arg) {
	var F = this;
	var pre_args = arguments;
//	for(var i = 0; i &lt; arguments.length; i++) pre_args.push(arguments[i]);
	return function(){
		var args = [];
		for(var i = 0; i &lt; pre_args.length; i++) args.push(pre_args[i]);
		for(var i = 0; i &lt; arguments.length; i++) args.push(arguments[i]);
//			args.unshift(arg);
		return F.apply(this, args);
	};
};


Function.prototype.rcurry = function(arg) {
	var F = this;
	var post_args = arguments;
//		for(var i = 0; i &lt; arguments.length; i++) post_args.push(arguments[i]);
	return function(){
		var args = [];
		for(var i = 0; i &lt; arguments.length; i++) args.push(arguments[i]);
		for(var i = 0; i &lt; post_args.length; i++) args.push(post_args[i]);
//			args.push(arg);
		return F.apply(this, args);
	};
};



Function.prototype.debounce = function(wait, immediate) {
	var func = this;
	var timeout;
	return function() {
		var context = this, args = arguments;
		var later = function() {
			timeout = null;
			if (!immediate) func.apply(context, args);
		};
		var callNow = immediate &amp;&amp; !timeout;
		clearTimeout(timeout);
		timeout = setTimeout(later, wait);
		if (callNow) func.apply(context, args);
	};
};




//------------------------------------
//
//     
//
//------------------------------------





(function(){

	var E = Ergo;




	/**
	 *       
	 *
	 *  jquery   $.each,        
	 *
	 * @name Ergo.each
	 * @function
	 * @param {Object|Array} src ,    
	 * @param {Function} callback ,    
	 */
	E.each = function(src, callback){
		if( Array.isArray(src) ){
			// for(var i = 0; i &lt; src.length; i++)
			// 	callback.call(src, src[i], i)
			src.forEach(callback);
		}
		else {
			var obj = src;
			for(var i in obj){
				callback.call(obj, obj[i], i);
//				if( callback.call(obj, obj[i], i) === false ) return false;
			}
		}
	};

	/**
	 *  (     )
	 *
	 *     
	 *
	 * @name Ergo.filter
	 * @function
	 * @param {Object|Array} src ,    
	 * @param {Function} callback ,    
	 * @returns {Object|Array}    ,    src
	 */
	E.filter = function(obj, fn){
		var result;
		if( Array.isArray(obj) ) {
			result = obj.filter(fn);
		}
		else {
			result = {};
			for(var i in obj)
				if( fn.call(obj, obj[i], i) ) result[i] = obj[i];
		}
		return result;
	};



	/*
	 *  .
	 *
	 *     
	 *
	 * @param {Object|Array} src ,    
	 * @param {Function} callback ,    
	 * @returns {Object|Array}    ,    src
	 */
	E.filter_keys = function(src, fn){
		var result = [];
		if(Array.isArray(src)) {
			for(var i = 0; i &lt; src.length; i++)
				if(fn.call(src, src[i], i)) result.push(i);
		}
		else {
			for(var i in src)
				if(fn.call(src, src[i], i)) result.push(i);
		}
		return result;
	};




	/**
	 *  ( )
	 *
	 * @name Ergo.map
	 * @function
	 * @param {Object|Array} src 
	 * @param {Function} callback ,    
	 */
	E.map = function(obj, fn) {
		var a;
		if(Array.isArray(obj)) {
			a = obj.map(fn);
		}
		else {
			a = {};
			for(var i in obj) a[i] = fn.call(obj, obj[i], i);
		}
		return a;
	};


	/**
	 *  ( )
	 *
	 * @name Ergo.reduce
	 * @function
	 * @param {Object|Array} src 
	 * @param {Function} callback ,    
	 * @param {Any} initValue   ( : [])
	 */
	E.reduce = function(obj, fn, init_value) {
		var a = init_value || [];
		if(Array.isArray(obj)) {
			obj.reduce(fn, a);
		}
		else {
			for(var i in obj)
				fn.call(obj, a, obj[i], i, obj);
		}
		return a;
	}


	/**
	 *   ,  
	 *
	 * @name Ergo.find
	 * @function
	 * @param {Object|Array} obj 
	 * @param {Function|Any} criteria 
	 */
	E.find = function(obj, criteria) {
		if(!$.isFunction(criteria)){
			var x = criteria;
			criteria = function(it) { return it == x; };
		}
		if(Array.isArray(obj)) {
			for(var i = 0; i &lt; obj.length; i++)
				if(criteria.call(obj, obj[i], i)) return obj[i];
		}
		else {
			for(var i in obj)
				if(criteria.call(obj, obj[i], i)) return obj[i];
		}

		return null;
	};


	/**
	 *   {@link Ergo.filter}
	 *
	 * @name Ergo.find_all
	 * @function
	 */
	E.find_all = E.filter;



	/**
	 *   ( )   
	 *
	 *     ,    Ergo.eq
	 *
	 * @name Ergo.key_of
	 * @function
	 * @param {Object|Array} obj 
	 * @param {Function|Any} criteria 
	 */
	E.key_of = function(obj, criteria) {

		if(!$.isFunction(criteria))
			criteria = E.eq.curry(criteria);

		if( Array.isArray(obj) ) {
			for(var i = 0; i &lt; obj.length; i++)
				if(criteria.call(obj, obj[i], i)) return i;
		}
		else {
			for(var i in obj)
				if(criteria.call(obj, obj[i], i)) return i;
		}
		return -1;
	};


	E.index_of = E.key_of;


	/**
	 *      
	 *
	 *       
	 *
	 * Ergo.apply_all(items, 'show', [10, 45]);
	 *
	 * @name Ergo.apply_all
	 * @function
	 * @param {Object|Array} obj 
	 * @param {String} m_name  
	 * @param {Array} [args]  
	 *
	 */
	E.apply_all = function(obj, m_name, args) {
		if( Array.isArray(obj) ) {
			for(var i = 0; i &lt; obj.length; i++) {
				if(obj[i][m_name]) obj[i][m_name].apply(obj[i], args || []);
			}
		}
		else {
			for(var i in obj) {
				if(obj[i][m_name]) obj[i][m_name].apply(obj[i], args || []);
			}
		}
	};

	/**
	 *      
	 *
	 *      3 
	 *
 	 * Ergo.call_all(items, 'show', 10, 45);
	 *
	 * @name Ergo.call_all
	 * @function
	 * @param {Object|Array} obj 
	 * @param {String} m_name  
	 *
	 */
	E.call_all = function(obj, m_name) {
		var args = [];
		for(var i = 2; i &lt; arguments.length; i++) args[i-2] = arguments[i];
		for(var i in obj) {
			if(obj[i][m_name]) obj[i][m_name].apply(obj[i], args);
		}
	};



	/**
	 * ,     
	 *
	 * @name Ergo.includes
	 * @function
	 * @param {Array|Object} obj 
	 * @param {Any} val 
	 */
	E.includes = function(obj, val) {
		if( Array.isArray(obj) )
			return obj.indexOf(obj) != -1;
		else {
			for(var i in obj)
				if(obj[i] === val) return true;
			return false;
		}
	};

	E.contains = E.includes;
	E.is_include = E.includes;



	E.size = function(obj) {

		if(Array.isArray(obj)) return obj.length;

		return obj.keys().length;
	};





/**
	 *   
	 */
	E.remove = function(obj, criteria) {

		var f = criteria;

		if( !$.isFunction(criteria) ) {
			f = function(item, i) { return item === criteria; };
		}

		var indices = [];

		for(var i = 0; i &lt; obj.length; i++) {
			if( f.call(obj, obj[i], i) ) {
				indices.push(i);
			}
		}

//		var arr = this;

		var removed = [];

		for(var i = indices.length-1; i >= 0; i--) {
			var idx = indices[i];
			removed.push(obj[idx]);
			obj.splice(idx, 1);
		}

		// indices.reverse().forEach( function(i) {
		// 	removed.push(arr[i]);
		// 	arr.splice(i, 1);
		// } );

		return removed;
	};



	E.uniq = function(obj) {
		var result = [];
		for(var i = 0; i &lt; obj.length; i++) {
			if(result.indexOf(obj[i]) == -1) result.push(obj[i]);
		}
		return result;
	};






	/**
	 *     (  )
	 *
	 * @name Ergo.remove
	 * @function
	 * @param {Object} arr 
	 * @param {Object} val  
	 */

	//TODO      ,       ,    

	// E.remove = function(arr, val) {
	// 	var index = -1;
	// 	for(var i = 0; i &lt; arr.length; i++) {
	// 		if(arr[i] === val) {
	// 			index = i;
	// 			break;
	// 		}
	// 	}
	// 	if(index != -1) arr.splice(index, 1);

	// 	return (index != -1);
	// };





})();





(function(){


	var F = Ergo;




	// "" 
	F.noop = function(){ return false; };
	//  
	F.by_index = function(index, child, i){ return index == i; };
	//    
	F.by_props = function(props, child){
		for(var i in props)
			if(child[i] != props[i]) return false;
		return true;
	};
	//  
	F.by_opts = function(opts, child){
		for(var i in opts)
			if(child.opt(i) != opts[i]) return false;
		return true;
	};
	//  
	F.by_class = function(clazz, child){
		return (child instanceof clazz);
	};



	/**
	 *   
	 *
	 *   ==
	 *
	 * @name Ergo.eq
	 * @function
	 * @param {Object|Array} obj 
	 * @param {Object} item  
	 * @param {Object} i / 
	 */
	F.eq = function(obj, item, i) {
		return obj == item;
	};

	/**
	 *   
	 *
	 *   !=
	 *
	 * @name Ergo.ne
	 * @function
	 * @param {Object|Array} obj 
	 * @param {Object} item  
	 * @param {Object} i / 
	 */
	F.ne = function(obj, item, i) {
		return obj != item;
	};


	// F.ne = function(obj) {
		// return function(it) { return obj != it; };
	// }
//
	// F.eq = function(obj) {
		// return function(it) { return obj == it; };
	// }

	//   
	F.by_widget = function(i) {

		var f = null;

		if( $.isString(i) ) f = F.by_opts.curry({'name': i});
		else if( $.isNumeric(i) ) f = F.by_index.curry(i);//return this.widgets[i]; // 
		else if( $.isPlainObject(i) ) f = F.by_props.curry(i);
		else if( $.isClass(i) ) f = F.by_class.curry(i);
		else if( $.isFunction(i) ) f = i;

		return f;
	};



	// F.sort = {
	// 	natural: function(a, b) {
	// 		if(a &lt; b) return -1;
	// 		if(a > b) return 1;
	// 		return 0;
	// 	}
	// }




})();





(function(){


	var E = Ergo;



	E.dom = {

		remove: function(elem) {
			if(elem.parentNode) {
				elem.parentNode.removeChild(elem);
			}
		},

		clear: function(elem) {
			while (elem.firstChild) elem.removeChild(elem.firstChild);
		},

		insertAfter: function(elem, after) {
			after.parentNode.insertBefore(elem, after.nextSibling);
		},

		insertBefore: function(elem, before) {
			before.parentNode.insertBefore(elem, before);
		},

		prependChild: function(elem, child) {
			if(elem.childNodes[0]) {
				elem.insertBefore(child, elem.childNodes[0]);
			}
			else {
				elem.appendChild(elem);
			}
		},


		addClass: function(el, cls) {
			if( cls &amp;&amp; (el instanceof Element) ) {
				(''+cls).split(' ').forEach(function(c) {

					if(!c) return;

					if(el.classList) {
						el.classList.add(c);
					}
					else {
						// IE9
						var re = new RegExp("(^|\\s)" + c + "(\\s|$)", "g");
						if(!re.test(el.className)) {
							el.className = (el.className + " " + c).replace(/\s+/g, " ").replace(/(^ | $)/g, "")
						}
					}
				});
			}
		},


		numberStyleToPx: function(k, v) {
	    // postfixes
	    var partials = [['padding', 'margin', 'border'], ['top', 'right', 'bottom', 'left']];
	    for(var i = 0; i &lt; partials[0].length; i++) {
				if(partials[0][i] == k) return v+'px';
	      for(var j = 0; j &lt; partials[1].length; j++) {
	        if(partials[0][i]+'-'+partials[1][j] == k) return v+'px';
	      }
	    }
	    // prefixes
	    partials = [['width', 'height'], ['max', 'min']];
	    for(var i = 0; i &lt; partials[0].length; i++) {
				if(partials[0][i] == k) return v+'px';
	      for(var j = 0; j &lt; partials[1].length; j++) {
	        if(partials[1][j]+'-'+partials[0][i] == k) return v+'px';
	      }
	    }
	    return v;
	  }



	};





	E.fixDisorder = function(kv_a, callback) {

		//     
		var indexDeltas = [];

		kv_a.forEach(function(kv, i) {
			indexDeltas[kv[2]] = kv[2] - i;
		});



		var n = 0;

		var indexDisorders = [];

		var moved_a = [];

		while( n &lt; kv_a.length+1 ) {


			// 0 -
			// 1 -
			// 2 -
			// 3 - 
			var maxDisorder = [-1,-1];

			indexDisorders = [];

			for(var i = 0; i &lt; kv_a.length; i++) {
				//   i
				var i_index = i - indexDeltas[i];

				//  ,     
				if( moved_a[i_index] )
					continue;

				// 0  
				// 1   
				// 2   
				var disorder = [-1, -1, -1];

				//
				for(var j = 0; j &lt; kv_a.length; j++) {
					//   j
					var j_index = j - indexDeltas[j];

					//    ,  
					if( (j &lt; i &amp;&amp; j_index > i_index) || (j > i &amp;&amp; j_index &lt; i_index) ) {
						if(disorder[0] == -1) {
							disorder[1] = j;
						}
						disorder[2] = j;
						disorder[0]++;
					}
				}

				//    
				indexDisorders[i] = disorder;

				//   
				if(disorder[0] > maxDisorder[0]) {
					maxDisorder[0] = disorder[0];
					maxDisorder[1] = disorder[1];
					maxDisorder[2] = disorder[2];
					maxDisorder[3] = i;
				}

			}

			//      -  
			if(maxDisorder[0] == -1) {
				break;
			}


			n++;



			// var k = 0;
			//
			// for(var i = 0; i &lt; measure_a.length; i++) {
			// 	if(max_measure[0] == measure_a[i][0])
			// 		k++;
			// }

//				console.log( 'max measure, count', max_measure, k);

			//  
			var _i = maxDisorder[3];
			var _j = (maxDisorder[2] > maxDisorder[3]) ? maxDisorder[2] : maxDisorder[1];


			//   
			callback(_i, _j, kv_a[_i], kv_a[_j]);

			//   
			moved_a[_i-indexDeltas[_i]] = true;

			//    
			var i_delta = indexDeltas[_i];

			if(_j &lt; _i) {
				for(var i = _i; i > _j; i--) {
					indexDeltas[i] = indexDeltas[i-1]+1;
				}
			}
			if(_j > _i) {
				for(var i = _i; i &lt; _j; i++) {
					indexDeltas[i] = indexDeltas[i+1]-1;
				}
			}

			indexDeltas[_j] = i_delta + (_j - _i);

		}


	}





	E.print = JSON.stringify;


	E.indent_s = '\t';

	/**
	 *     
	 *
	 * @name Ergo.pretty_print
	 * @function
	 * @param {Any} obj  /
	 * @param {Integer} indent 
	 * @param {Integer} i_symb  
	 * @returns {String}
	 */
	E.pretty_print = function(obj, indent) {

		if(obj == undefined) return undefined;

		indent = indent || 0;
		var tabs = '';
		for(var i = 0; i &lt; indent; i++) tabs += E.indent_s;

		if(obj.pretty_print) return obj.pretty_print(indent);

		if($.isString(obj))
			return '"'+obj.replace(/\n/g, '\\n')+'"';
		else if($.isBoolean(obj))
			return ''+obj;
		else if($.isNumeric(obj) || $.isBoolean(obj))
			return obj;
		else if($.isArray(obj)){
			var items = [];
			E.each(obj, function(item){
				items.push(E.pretty_print(item, indent));
			});
			return '[' + items.join(', ') + ']';
		}
		else if($.isFunction(obj)){
			return 'function() { ... }';
		}
		else if($.isPlainObject(obj) || !indent){
			var items = [];
			E.each(obj, function(item, key){
				if(key[0] == '!' || key[0] == '-' || key[0] == '+') key = "'"+key+"'";
				items.push(tabs + E.indent_s + key + ': ' + E.pretty_print(item, indent+1));
			});
			return '{\n' + items.join(',\n') + '\n' + tabs + '}';
		}
		else
			return obj;

	};


	/**
	 *      html
	 *
	 * @name Ergo.escapeHtml
	 * @function
	 * @param {String} s 
	 * @returns {String}  
	 */
	E.escapeHtml = function(s) {
		return s.replace(/&amp;/g, "&amp;amp;").replace(/&lt;/g, "&amp;lt;").replace(/>/g, "&amp;gt;");
	};




	/**
	 *
	 *
	 * @name Ergo.timestamp
	 * @function
	 */
	E.timestamp = function() {
		return new Date().getTime();
	};

	E.ms = E.timestamp;






	/**
	 *   .
	 *
	 * @example
	 * Ergo.format("%s items from %s selected", 1, 10);
	 *
	 * @name Ergo.format
	 * @function
	 * @param {String} format_str  
	 * @return {String}
	 */
	E.format = function(format_str) {
		var values = [];
		for(var i = 1; i &lt; arguments.length; i++) values.push(arguments[i]);
		return format_str.replace(/(%s)/g, function(str) {
			var replace_val = '';
			if(str == '%s') replace_val = ''+values.shift();
			return replace_val;
		});
	};

	/**
	 *   
	 *
	 * @example
	 *
	 * var record = {
	 * 	first_name: 'Alice',
	 * 	last_name: 'Green',
	 * 	email_count: 3
	 * }
	 *
	 * Ergo.format_obj("#{first_name} #{last_name} has #{email_count} e-mails", record);
	 *
	 * Output: Alice Green has 3 e-mails
	 *
	 * @name Ergo.format_obj
	 * @function
	 * @param {Object} format_str  
	 * @param {Object} obj 
	 */
	E.format_obj = function(format_str, obj) {
		if(obj === null || obj === undefined) return '';
		return format_str.replace(/#{\s*(.+?)\s*}/g, function(str, key) {
			var o = obj;

			var fmt_a = [];
			if( key.indexOf('|') > 0 ) {
				var a = key.split('|');
				key = a[0];
				for(var i = 1; i &lt; a.length; i++) {
					fmt = Ergo.alias('formats:'+a[i]);
					if(!fmt)
						console.warn('Format ['+a[i]+'] is not registered');
					fmt_a.push(fmt);
				}
			}

			if(key &amp;&amp; key != '*') {
				var arr = key.split('.');
				for(var i = 0; i &lt; arr.length; i++) {
					if(o == null) return o;
					o = o[arr[i]];
				}
			}


			for(var i = 0; i &lt; fmt_a.length; i++)
				o = fmt_a[i](o);

			return o === undefined ? '' : o;
		});
	};



	E.unformat_obj = function(format_str, obj) {

		var n=0;

		var tmpl = ufmt.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&amp;");

		var keys = []

		tmpl = tmpl.replace(/#\\{\s*(.+?)\s*\\}/g, function(str, key) {
		  keys.push(key);
		  return '(.+?)'
		});

		var m = s.match(tmpl);

		if( keys[0] == '*') {
			return m[1];
		}
		else {
			var v = {}
			keys.forEach(function(key, i) {
			  v[key] = m[i+1]
			})
			return v;
		}

	};



	/**
	 *   .
	 *
	 *      
	 *
	 * @name Ergo.deep_copy
	 * @function
	 * @param {Any} src  
	 */
	E.deep_copy = function(src) {
		var copy = null;

//		var is_po = $.isPlainObject(src);
//		if(is_po || $.isArray(src)){
		var is_po = (src &amp;&amp; src.constructor == Object);
		if( src &amp;&amp; (is_po || src.constructor == Array)) {
			copy = is_po ? {} : [];
			for(var i in src)
				copy[i] = E.deep_copy(src[i]);
//			E.each(src, function(item, i){
//				copy[i] = E.deep_copy(item);
//			});
		}
		else{
			copy = src;
		}

		return copy;
	};




	E.loadpath = {};


	/*
	 *     Ajax
	 *
	 *        
	 *
	 */
	E.require = function() {

		for(var i = 0; i &lt; arguments.length; i++) {

			var class_name = arguments[i];

			//TODO   ,   
			try{
				if( eval('typeof '+class_name) == 'function') continue;
			}
			catch(e) {
			}

			for(var j in E.loadpath) {
				if(class_name.search(j) != -1) {
					class_name = class_name.replace(j, E.loadpath[j]);
					break;
				}
			}

			var url = class_name.replace(/\./g, '/') + '.js';

			$.ajax({
			  url: url,
			  dataType: "script",
			  success: function(){
			  	//TODO    , ,   
			  },
			  error: function(jqXHR, textStatus, errorThrown){
			  	console.log(errorThrown);
			  },
			  async: false
			});

		}


	};




	//TODO   
	E.glass_pane = function() {

		return $('&lt;div class="e-glass-pane" autoheight="ignore"/>')
			.on('mousedown', function(e){
				e.preventDefault();
				return false;
			});

	};





	E.debounce = function debounce(func, wait, immediate) {
		var timeout;
		return function() {
			var context = this, args = arguments;
			var later = function() {
				timeout = null;
				if (!immediate) func.apply(context, args);
			};
			var callNow = immediate &amp;&amp; !timeout;
			clearTimeout(timeout);
			timeout = setTimeout(later, wait);
			if (callNow) func.apply(context, args);
		};
	};



	E.measure = function(callback) {
		var t0 = E.ms();
		callback();
		var t1 = E.ms();
		return (t1-t0)
	};









	//FIXME            
	/*Browser detection patch*/
	E.browser = {};
	E.browser.mozilla = /mozilla/.test(navigator.userAgent.toLowerCase()) &amp;&amp; !/webkit/.test(navigator.userAgent.toLowerCase());
	E.browser.webkit = /webkit/.test(navigator.userAgent.toLowerCase());
	E.browser.opera = /opera/.test(navigator.userAgent.toLowerCase());
	E.browser.msie = /msie/.test(navigator.userAgent.toLowerCase());



})();





/**
 * 
 *
 * :
 * 	`set`  
 * 	`get`  
 * 	`include`  
 *
 *
 * @class
 *
 */
Ergo.core.Object = function() {
	// possible optimization
	var a = new Array(arguments.length);
	for(var i = 0; i &lt; arguments.length; i++)
		a[i] = arguments[i];

	// if( this.constructor === Object ) {
	// 	return new (Function.prototype.bind.apply(objectConstructor, arguments));
	// }
	// else {
	this._initialize.apply(this, a);
};

Ergo.core.Object.extend = function(o) {
	return Ergo.extend(this, o);
};




Ergo.override(Ergo.core.Object.prototype, /** @lends Ergo.core.Object.prototype */{

	defaults: {
		// options
	},


	props: {
		get: {},
		set: {}
	},

// 	rules: {
// 		include: 'list',
// 		set: false,
// 		get: false,
// //		override: false,
// 		events: ['object', {'*': 'list'}]
// 	},

	/**
	 *  .
	 *
	 *      :
	 * 	1. 
	 * 	2. 
	 * 	3. 
	 *
	 *
	 *      
	 *
	 * @private
	 *
	 */
	_initialize: function(opts) {//}, scope) {

		var o = {
		};

		var p = {
		};

		var r = {

		}

		//
		if(!this.constructor.NO_REBUILD_SKELETON) {
			var prevDefaults = null;
			Ergo.walk_hierarchy(this.constructor, function(clazz){
				if(clazz.defaults == prevDefaults) return;
				if('defaults' in clazz) $ergo.mergeOptions(o, clazz.defaults);
				prevDefaults = clazz.defaults;
			});

			// var prevRules = null;
			// Ergo.walk_hierarchy(this.constructor, function(clazz){
			// 	if(clazz.rules == prevRules) return;
			// 	if('rules' in clazz) $ergo.deep_override(r, clazz.rules);
			// 	prevRules = clazz.rules;
			// });

			var prevProps = null;
			Ergo.walk_hierarchy(this.constructor, function(clazz){
				if(clazz.props == prevProps) return;
				if('props' in clazz) $ergo.deep_override(p, clazz.props);
				prevProps = clazz.props;
			});

			this.constructor.NO_REBUILD_SKELETON = true;
			this.constructor.prototype.defaults = Ergo.deep_copy(o);
			this.constructor.prototype.props = Ergo.deep_copy(p);
//			this.constructor.prototype.rules = Ergo.deep_copy(r);
//			Ergo.smart_build(this.constructor.prototype.defaults);

		}
		else {
			Ergo.deep_override(o, this.defaults);
		}


//		this._scope = scope;


		this.options = $ergo.mergeOptions(o, opts) //Array.isArray(opts) ? Ergo.smart_override.apply(this, [o].concat(opts)) : Ergo.smart_override(o, opts);


		//  
//		Ergo.smart_build(this.options);


		if('include' in this.options) {
			this._includes = Ergo.uniq( o.include.join(' ').split(' ') );

//			var rebuild = false;

			for(var i = 0; i &lt; this._includes.length; i++) {
				var inc = Ergo._aliases['includes:'+this._includes[i]];
				if(!inc)
					throw new Error('Include [includes:'+this._includes[i]+'] not found');
				if(inc.defaults) {
					this.options = $ergo.mergeOptions({}, [inc.defaults, this.options]);  //FIXME
//					rebuild = true;
				}
				if(inc.overrides) {
					Ergo.override(this, inc.overrides);
				}
			}

			// if(rebuild) {
			// 	Ergo.smart_build(this.options);
			// }
		}


//		this._constructing = true;

		//     -    
		this._pre_construct(this.options);

		// //FIXME    ( PRE_CONSTRUCT    )
		// if(o.mixins &amp;&amp; o.mixins.length)
		// 	Ergo.smart_build(this.options);

//		this.options = Ergo.smart_override(this.options, opts);

		//     -    
		this._construct(this.options);

		//   -    
		this._post_construct(this.options);

//		if(this.$init)
//			this.$init(o);

//		delete this._constructing;

	},



	//--------------------------------------------------------------------------
	// 
	//--------------------------------------------------------------------------

	/**
	 *  
	 *
	 */
	// get events() {
	// 	if(!this.__events) {
	// 		this.__events = new Ergo.core.Observer(this.options.events, this);
	// 	}
	// 	return this.__events;
	// },




	//--------------------------------------------------------------------------
	// 
	//--------------------------------------------------------------------------


	/**
	 *   "" 
	 *
	 *          
	 *
	 *      
	 *
	 * @protected
	 * @param {Object} o 
	 */
	_pre_construct: function(o) {

		//   
		if('include' in o) {
//			this._includes = o.include.join(' ').split(' ').uniq();

			for(var i = 0; i &lt; this._includes.length; i++) {
				var inc = Ergo._aliases['includes:'+this._includes[i]];
				if(inc._pre_construct)
					inc._pre_construct.call(this, o);
			}
		}

		// //  
		// if('override' in o) {
		// 	$ergo.override(this, o.override);
		// }

		//    (       overrides)
		var props = null;

		if('set' in o) {
			props = {};
			for(var i in o.set) {
				props[i] = { set: o.set[i] }
			}
		}

		if('get' in o) {
			props = props || {};
			for(var i in o.get) {
				props[i] = props[i] || {};
				props[i].get = o.get[i];
			}
		}

		if(props) {
			Object.defineProperties(this, props);
		}


	},


	/**
	 *   "" 
	 *
	 *  ,    
	 *
	 *     
	 *
	 * @protected
	 * @param {Object} o 
	 *
	 */
	_construct: function(o) {

// 		if('plugins' in o) {
// 			for(var i = 0; i &lt; o.plugins.length; i++) {
// 				var plugin = o.plugins[i];
// //				if($.isString(plugin)) plugin = o.plugins[i] = Ergo.alias('plugins:'+plugin);
// 				if(plugin.construct)
// 					plugin.construct.call(this, o);
// 			}
// 		}


		if(this._includes) {
//			var mods = o.mods.join(' ').split(' ').uniq();
			for(var i = 0; i &lt; this._includes.length; i++) {
				var inc = Ergo._aliases['includes:'+this._includes[i]];
				if(inc._construct)
					inc._construct.call(this, o);
			}
		}


	},


	/**
	 *   "" 
	 *
	 *       
	 *
	 *      (  _opt)
	 *
	 * @protected
	 * @param {Object} o 
	 */
	_post_construct: function(o) {

// 		if('plugins' in o) {
// 			for(var i = 0; i &lt; o.plugins.length; i++) {
// 				var plugin = o.plugins[i];
// //				if($.isString(plugin)) plugin = o.plugins[i] = Ergo.alias('plugins:'+plugin);
// 				if(plugin.post_construct)
// 					plugin.post_construct.call(this, o);
// 			}
// 		}



		if(this._includes) {
//			var mods = o.mods.join(' ').split(' ').uniq();
			for(var i = 0; i &lt; this._includes.length; i++) {
				var inc = Ergo._aliases['includes:'+this._includes[i]];
				if(inc._post_construct)
					inc._post_construct.call(this, o);
			}
		}



		for(var i in o) {
			if( !(i in Ergo.rules) ) {
				this.prop(i, o[i]);
			}
		}

//		this._opt(o);

	},


	/**
	 *   
	 *
	 * @protected
	 */
	_destroy: function() {
		//
	},




	/**
	 *   (options) .
	 *
	 *       this.options
	 *
	 *  /   :
	 * 	 :
	 * 		1. -  this.options.set
	 * 		2. -  set_&lt; >
	 *
	 * 	 :
	 * 		1. -  this.options.get
	 * 		2. -  get_&lt; >
	 *
	 * opt(i) -   i
	 * opt(i, v) -   i
	 * opt(o) -   ,    Hash
	 *
	 * @param {Object} o 
	 */
	opt: function(o) {
		var opts = o;

		if(arguments.length == 2){
			opts = {};
			opts[arguments[0]] = arguments[1];
		}
		else if(typeof o == 'string'){

			// //  
			// if( (o in this.options.get) ) {
			// 	return this.options.get[o].bind(this)();
			// }
			// else if( (o in this.props.get) ) {
			// 	return this.props.get[o].bind(this)();
			// }
			// else if( (o in this) &amp;&amp; $ergo.hasGetter(this, o) ) {
			// 	return this[o];
			// }
			var p = this.prop(o);

			//   
			return (p !== undefined) ? p : this.options[o];
		}

//		Ergo.smart_override(this.options, opts);
		Ergo.override(this.options, opts);

		for(var i in opts) {
			if( !(i in Ergo.rules) ) {
				this.prop(i, opts[i]);
			}
		}

//		this._opt(opts);

		return this;
	},



	prop: function(i, v) {

		if(arguments.length == 1) {

			if( this.options.get &amp;&amp; (i in this.options.get) ) {
				return this.options.get[i].bind(this)();
			}
			else if( (i in this.props.get) ) {
				return this.props.get[i].bind(this)();
			}
			else if( (i in this) &amp;&amp; $ergo.hasGetter(this, i) ) {
				return this[i];
			}
//			else {
//				console.warn('Property ['+i+'] not found');
//			}

			return;
		}
		else if(arguments.length == 2) {

			if( this.options.set &amp;&amp; (i in this.options.set) ) {
				this.options.set[i].bind(this)(v);
			}
			else if( (i in this.props.set) ) {
				this.props.set[i].bind(this)(v);
			}
			else if( (i in this) &amp;&amp; $ergo.hasSetter(this, i) ) {
				this[i] = v;
			}

			return this;
		}

	},


	/**
	 * ,    .
	 *
	 * @private
	 * @param {Object} o 
	 */
	// _opt: function(o) {
	//
	// 	for(var i in o) {
	// 		if( !(i in Ergo.rules) ) {
	//
	// 			if( (i in this.options.set) ) {
	// 				return this.options.set[i].bind(this)(o[i]);
	// 			}
	// 			else if( (i in this.props.set) ) {
	// 				return this.props.set[i].bind(this)();
	// 			}
	// 			else if( (i in this) &amp;&amp; $ergo.hasSetter(this, i) ) {
	// 				this[i] = o[i];
	// 			}
	//
	// 		}
	// 	}
	//
	// },


	// $unknown_opt: function(i) {
//
	// },


	/**
	 *   
	 *
	 * @function
	 * @name Object.is
	 * @param {Any} ex 
	 */
	is: function(ex) {
		return (this._includes) ? Ergo.includes(this._includes, ex) : false;
//		var o = this.options;
//		if($.isString(ex)) ex = Ergo.alias('mixins:'+ex);
//		return ('mixins' in o) ? Ergo.includes(o.mixins, ex) : false;
	},


	/**
	 *       
	 *
	 *    " "
	 *
	 * @private
	 */
	_super: function(){
		var caller = arguments.callee.caller;
		return caller.__class__.superclass[caller.__name__].apply(this, arguments);
	},






});





// /**
//  *       ErgoJS
//  *
//  * @deprecated
//  */
// Ergo.declare_mixin = function(mixin_name, obj, alias) {
//
// 	//     
// 	var cp_a = mixin_name.split('.');
// 	var cp = window;
// 	for(var i = 0; i &lt; cp_a.length-1; i++){
// 		var c = cp_a[i];
// 		if(!cp[c]) cp[c] = {};
// 		cp = cp[c];
// 	}
//
// 	cp[cp_a[cp_a.length-1]] = obj;
//
//
// 	//     
// 	// var cp_a = mixin_name.split('.');
// 	// var cp = 'window';
// 	// for(var i = 0; i &lt; cp_a.length; i++){
// 		// cp += '.'+cp_a[i];
// 		// eval( 'if(!'+cp+') '+cp+' = {};' );
// 	// }
// 	// eval(cp + ' = obj;');
//
// 	if(alias)
// 		Ergo.alias(alias, obj);
//
// 	return obj;
// }
// ;
//
// Ergo.defineMixin = Ergo.declare_mixin;





/**
 * @name Ergo.events
 * @namespace
 */


/**
 *
 * @deprecated
 *
 * @class
 * @name Ergo.events.Event
 * @extends Ergo.core.Object
 */
// Ergo.defineClass('Ergo.core.Event', 'Ergo.core.Object', /** @lends Ergo.events.Event.prototype */{
//
// 	_initialize: function(baseEvent) {
// 		this.base = baseEvent;
// 		this._queue = [];
// 	},


Ergo.core.Event = function(baseEvent) {
	this.base = baseEvent;
	this._queue = [];
}

Ergo.override(Ergo.core.Event.prototype, {

	stop: function(stopHtmlEvent) {
//		if(this.base) this.base.stopPropagation(); //FIXME
		var e = this.base;
		while(e &amp;&amp; stopHtmlEvent !== false) {
			if(e.stopPropagation) {
				e.stopPropagation();
				break;
			}
			e = e.base;
		}
		this.stopped = true;
		// if(immediate)
		// 	this.stopedImmediate = true;
	},
	interrupt: function(interruptHtmlEvent) {
		var e = this.base;
		while(e &amp;&amp; interruptHtmlEvent !== false) {
			if(e.stopImmediatePropagation) {
				e.stopImmediatePropagation();
				break;
			}
			e = e.base;
		}
//		if(this.base) this.base.stopImmediatePropagation(); //FIXME
		this.stopped = true;
		this.stopedImmediate = true;
	},
	yield: function(callback) {

		while(this._queue.length) {
			var h = this._queue.pop();
			h.callback.call(h.target, this);
			if(this.stopedImmediate) break;
		}

		// if( !this._yielded ) {
		// 	this._yielded = [];
		// }
		// this._yielded.push(callback);
	},
	cancel: function() {
		this.canceled = true;
	}

});


// Ergo.declare('Ergo.events.Event', Ergo.core.Object, /** @lends Ergo.events.Event.prototype */{
//
// 	/**
// 	 * @param {Object} overrides
// 	 * @param {Object} baseEvent
// 	 */
// 	_initialize: function(overrides, baseEvent) {
// 		this._super();
// //		Ergo.events.Event.superclass._initialize.call(this);
//
// 		if(overrides) Ergo.override(this, overrides);
//
// //		this.is_stopped = false;
// 		this.baseEvent = baseEvent;
// 		this.canceled = false;
// 		this.stopped = false;
// 	},
//
//
// 	cancel: function(){
// 		this.canceled = true;
// 	},
//
// 	stop: function() {
// 		if(this.baseEvent) this.baseEvent.stopPropagation();
// 		this.stopped = true;
// 	}
//
//
//
// });


// Ergo.declare('Ergo.events.CancelEvent', 'Ergo.events.Event', /** @lends Ergo.events.CancelEvent.prototype */{
//
	// /**
	 // * @constructs
 	 // * @extends Ergo.events.Event
	 // * @param {Object} overrides
	 // * @param {Object} baseEvent
	 // */
	// _initialize: function(overrides, baseEvent) {
		// this._super(overrides, baseEvent);
// //		Ergo.events.CancelEvent.superclass._initialize.apply(this, arguments);
		// this.isCanceled = false;
	// },
//
	// cancel: function(){
		// this.isCanceled = true;
	// }
//
// });




/**
 *  
 *
 * @class
 * @name Ergo.core.Observer
 * @extends Ergo.core.Object
 */
// Ergo.declare('Ergo.core.Observer', 'Ergo.core.Object', /** @lends Ergo.core.Observer.prototype */{
//
// 	_initialize: function(target) {
// 		this.events = {};
// 		this.target = target;
// 	},


Ergo.core.Observer = function(target) {
	this.events = {};
	this.target = target;
}

Ergo.override(Ergo.core.Observer.prototype, {



	/**
	 *  .
	 *
	 * on(type, callback, target)
	 */
	on: function(type, callback, target) {
		if(!(type in this.events)) this.events[type] = [];//new Ergo.core.Array();
		var h_arr = this.events[type];
		h_arr.push({'callback': callback, 'target': target || this.target});
		return this;
	},

	/**
	 *   
	 */
	once: function(type, callback, target) {
		if(!(type in this.events)) this.events[type] = [];
		var h_arr = this.events[type];
		h_arr.push({'callback': callback, 'target': target || this.target, 'once': true});
		return this;
	},

	/**
	 *   .
	 *
	 * off(type)
	 * off(callback)
	 * off(type, callback)
	 * off(target)
	 * off();
	 */
	off: function(arg, arg2) {

		var events = this.events;

		if(arguments.length == 0) {
			this.events = {};
		}
		else if(arguments.length == 2){
			events[arg] = events[arg].filter( function(h) { return h.callback != arg2; } );
		}
		else if( $.isString(arg) ){
			//      
			delete events[arg];
		}
		else if( $.isFunction(arg) ){
			//   
//			for(var i = 0; i &lt; events.length; i++) {
			for(var i in events) {
				events[i] = events[i].filter( function(h) { return h.callback != arg; } );
			}
		}
		else {
			//      
//			for(var i = 0; i &lt; e.length; i++) {
			for(var i in events) {
				events[i] = events[i].filter( function(h) { return h.target != arg; } );
			}
		}

		return this;
	},

	// unreg_all: function() {
	// 	this.events = {};
	// },

	/**
	 *  .
	 *
	 * fire(type, event)
	 *
	 * type -     _1._2 ... ._N
	 *
	 */
	fire: function(type, _event, baseEvent) {

		// ""   
		// var _event = {
		// 	base: baseEvent,
		// 	stop: function(immediate) {
		// 		if(this.base) this.base.stopPropagation(); //FIXME
		// 		this.stopped = true;
		// 		if(immediate)
		// 			this.stopedImmediate = true;
		// 	},
		// 	interrupt: function() {
		// 		if(this.base) this.base.stopImmediatePropagation(); //FIXME
		// 		this.stopped = true;
		// 		this.stopedImmediate = true;
		// 	},
		// 	yield: function() {
		// 		this._yielded = true;
		// 	}
		// };
		var e = new Ergo.core.Event(baseEvent);

		if(arguments.length == 1) {
//			_event = new Ergo.events.Event();
//			e = new Ergo.events.Event();
		}
		else if( _event.constructor === Object ){
			Ergo.override(e, _event);
//			_event.baseEvent = baseEvent;
//			e = new Ergo.events.Event(e, baseEvent);
		}
		else {
			e = _event;
		}



//		var self = this;
		var h_arr = this.events[type];
		if(h_arr &amp;&amp; h_arr.length) {

//			var yielded = [];

			e._queue = h_arr.slice();

			while(e._queue.length) {
				var h = e._queue.pop();
				h.callback.call(h.target, e, type);
				if(e.stopedImmediate) break;
			}

			// for(var i = h_arr.length-1; i >= 0; i--) {
			// 	var h = h_arr[i];
			// 	// if(e._yielded) {
			// 	// 	yielded.push(h);
			// 	// }
			// 	// else {
			// 	h.callback.call(h.target, e, type);
			// 	if(e.stopedImmediate) break;
			// 	// }
			// }
			//
			//
			// if(e._yielded) {
			// 	e._yielded.reverse().forEach(function(callback) {
			// 		callback(e);
			// 	});
			// }

			// for(var i = yielded.length-1; i >= 0; i--) {
			// 	var h = yielded[i];
			// 	h.callback.call(h.target, e, type);
			// }

// 			h_arr.forEach( function(h){
// 				//   
// 				h.callback.call(h.target, e, type);
// 				//    ,    
// //				if(e.stopped) return false;
// 			});
			// ?

			//  ,   `once`
			if(this.events[type])
				this.events[type] = this.events[type].filter( function(h) { return !h.once; } );
		}

		if(e.after &amp;&amp; !e.stopped)
			e.after.call(this.target, e, type);

//		self.on_fire(type, e, baseEvent);

		return e;
	}


	// bubble: function() {
//
	// }
//
//
	// /**
	 // * ,     fire
	 // *
	 // */
	// on_fire: function(type, e, base_event) {
//
	// }


});





Ergo.alias('mixins:observable', {


	get events() {
		if(!this.__evt) {
			this.__evt = new Ergo.core.Observer(this);
			this._bindEvents();

			var o = this.options;

			var regexp = /^on\S/;
			for(var i in o){
				if( i[0] == 'o' &amp;&amp; i[1] == 'n' &amp;&amp; regexp.test(i)){
					var name = i.charAt(2).toLowerCase() + i.slice(3);
					var chain = ( !Array.isArray(o[i]) ) ? [o[i]] : o[i];
					for(var j = 0; j &lt; chain.length; j++) {
						var callback = chain[j];
						if( $.isString(callback) ) {
							var a = callback.split(':');
							callback = (a.length == 1) ? this[callback].bind(this, null) : this[a[0]]/*.rcurry(a[1])*/.bind(this, a[1]);
						}
						this.__evt.on( name, callback );
					}
				}
			}

		}
		return this.__evt;
	},


	// _bindShortcutEvents: function() {
	//
	//
	// },


	_bindEvents: function(targetProperty) {

		var o = this.options;

		var target = targetProperty ? this[targetProperty] : this;

		if(!target)
			throw new Error('Target property "'+targetProperty+'" not found');

		if('events' in o) {

			for(var i in o.events){

				var name_a = i.split(':');

				var eventName = i;

				if(name_a[0] == targetProperty &amp;&amp; name_a.length > 1) {
					eventName = name_a[1];
				}
				else if(name_a.length > 1 || targetProperty) {
					//  
					this[targetProperty || name_a[0]];
					continue;
				}


				var callback_a = o.events[i];
				callback_a = Array.isArray(callback_a) ? callback_a : [callback_a]; //FIXME
				for(var j in callback_a) {
					var callback = callback_a[j];

					if( typeof callback == 'string' ) {
						var a = callback.split(':');
						callback = (a.length == 1) ? this[callback].bind(this, null) : this[a[0]]/*.rcurry(a[1])*/.bind(this, a[1]);
					}

					target.events.on(eventName, callback, this);
				}
			}
		}

	},



	on: function() {
		this.events.on.apply(this.events, arguments);
	},

	off: function() {
		this.events.off.apply(this.events, arguments);
	},

	fire: function() {
		this.events.fire.apply(this.events, arguments);
	}

	// off: function(type, callback) {
	// 	var name_a = type.split(':');
	// 	var obj = this;
	// 	if(name_a.length > 1) {
	// 		obj = this[name_a[0]];
	// 		type = name_a[1];
	// 	}
	// 	obj.events.on(type, callback, this);
	// }



});






/**
 *
 * @mixin observable
 *
 */
Ergo.alias('includes:observable', {

	_construct: function(o) {

		this.events = new Ergo.core.Observer(this);

	},




	_post_construct: function(o) {


		if('events' in o){
			for(var i in o.events){

				var name_a = i.split(':');

				//   
				if( name_a.length > 1 ) continue;

				var callback_a = o.events[i];
				callback_a = Array.isArray(callback_a) ? callback_a : [callback_a]; //FIXME
				for(var j in callback_a) {
					var callback = callback_a[j];

					if( $.isString(callback) ) {
						var a = callback.split(':');
						callback = (a.length == 1) ? this[callback] : this[a[0]].rcurry(a[1]).bind(this);
					}

					// if( name_a.length == 2 &amp;&amp; this[name_a[0]] &amp;&amp; this[name_a[0]].events ) {
					// 	console.log(i);
					// 	this[name_a[0]].events.on( name_a[1], callback, this );
					// }
					// else {
					this.events.on(i, callback, this);
					// }

					// if(i.indexOf('ctx:') == 0) {
					// 	// Context
					// 	(this._context || Ergo.context).events.on(i.substr(4), callback, this);
					// }
					// else if(i.indexOf('jquery:') == 0) {
					// 	// jQuery
					// 	self.el.on(i.substr(7), callback.rcurry('jquery').bind(this));
					// }
					// else {
					// 	// Widget
					// 	this.events.on(i, callback, this);
					// }
				}
			}
		}


		var regexp = /^on\S/;
		for(var i in o){
			if( i[0] == 'o' &amp;&amp; i[1] == 'n' &amp;&amp; regexp.test(i)){
				var name = i.charAt(2).toLowerCase() + i.slice(3);
				var chain = ( !Array.isArray(o[i]) ) ? [o[i]] : o[i];
				for(var j = 0; j &lt; chain.length; j++) {
					var callback = chain[j];
					if( $.isString(callback) ) {
						var a = callback.split(':');
						callback = (a.length == 1) ? this[callback] : this[a[0]].rcurry(a[1]).bind(this);
					}
					this.events.on( name, callback );
				}
			}
		}


	}


});






/**
 *  
 *
 * :
 * 	`lazy` ""   (     )
 *
 * :
 * 	`changed`   
 * 	`diff`
 * 	`dirty`
 *
 * @class
 * @name Ergo.core.DataSource
 * @extends Ergo.core.Object
 *
 */
Ergo.defineClass('Ergo.core.DataSource', 'Ergo.core.Object', /** @lends Ergo.core.DataSource.prototype */{

	defaults: {
//		plugins: [Ergo.Observable],
//		include: 'observable',
		lazy: true
	},


	_initialize: function(src, id, o) {

		/**
		 *      
		 *
		 * @field id
		 */

		/**
		 *  
		 *
		 * @field {Any|Ergo.core.DataSource}
		 */
		this.source = src;

		if(arguments.length == 2) {
			if($.isPlainObject(id)) o = id;
			else this._id = id;
		}
		else if(arguments.length == 3) {
			this._id = id;
		}

		if('_id' in this) {
			// if(typeof id == 'string')
			// 	this._id = this._id.split('+');
			if(Array.isArray(id))
				this._id = id;
			else
				this._id = [this._id];
		}


//		this._super(o || {});
		Ergo.core.DataSource.superclass._initialize.call(this, o || {});

		var self = this;
		var o = this.options;
		var val = this.get();

		/**
		 *  
		 *
		 * @field
		 */
		this.entries = Array.isArray(val) ? new Ergo.core.Array() : new Ergo.core.Collection();

//		this.events = new Ergo.events.Observer(this);

		if(!o.lazy) {
			Ergo.each(val, function(v, i){	self.entry(i); } );
		}

//		console.log('-- data --');

	},


	_destroy: function() {

		this.del();

		//    
		this.events.off();
		//    
		this.entries.apply_all('_destroy');

	},



	/**
	 *      
	 *
	 * @param {String|Any} i 
	 * @return {Ergo.core.DataSource}  
	 */
	entry: function(i) {

//		console.log('-- data entry --');

		var ds = this;

		// multikey
		if( this._id &amp;&amp; this._id.length > 1 ) {
			this._id.forEach(function(id) {
				if(id == i) {
					ds = ds.source;
				}
			});
		}

		//   - ,     
		if( typeof i == 'string' ) {
			var a = i.split('.');
			var i = a.pop();
			//      
			for(var j = 0; j &lt; a.length; j++) ds = ds.entry(a[j]);
		}

		var e = ds.entries.get(i);

		if(!e) {
			e = ds._factory(i);
			ds.entries.set(i, e);
		}

		return e;

		// //   ,    ,  -  
		// if(!ds.entries.has_key(i)) {
		// 	ds.entries.set(i, ds._factory(i));
		// }
		//
		// return ds.entries.get(i);
	},


	/**
	 *   
	 *
	 *     Ergo.core.DataSource
	 *
	 * @param {Any} i 
	 * @returns {Ergo.core.DataSource}
	 *
	 */
	_factory: function(i) {
		return new Ergo.core.DataSource(this, i);
	},



	_parse: null,

	_compose: null,



	/**
	 *    
	 *
	 *     ,      .
	 *   ,    .
	 *
	 * @param {Any} [v] 
	 * @private
	 */
	_val: function(v) {
//		if('_cached' in this) return this._cached;
//		var v = undefined;

		if(arguments.length == 0) {
			v = (this.source instanceof Ergo.core.DataSource) ? this.source._val() : this.source;


			if('_id' in this) {

				if(v) {
					// single key
					if(this._id.length == 1) {
						v = v[this._id[0]];
					}
					// multi key
					else {
						var mv = {};
						for(var i = 0; i &lt; this._id.length; i++)
							mv[this._id[i]] = v[this._id[i]];
						v = mv;
						// var mv = [];
						// for(var i = 0; i &lt; this._id.length; i++)
						// 	mv.push( v[this._id[i]] );
						// v = mv;
					}
				}
				else {
					v = undefined;
				}

			}

			// if(this.options.unformat)
			// 	v = this.options.unformat.call(this, v);


		}
		else {

			// if(this.options.format)
			// 	v = this.options.format.call(this, v);

			if (this.source instanceof Ergo.core.DataSource) {
				if('_id' in this) {
					var src = this.source._val();
					// single key
					if(this._id.length == 1) {
						src[this._id[0]] = v
					}
					// multi key
					else {
						for(var i = 0; i &lt; this._id.length; i++) {
							var key = this._id[i];
							if(key in v)
								src[key] = v[key];
						}
						// for(var i in v){//var i = 0; i &lt; this._id.length; i++) {
						// 	src[this._id[i]] = v[i];
						// }
					}
				}
				else {
					this.source._val(v);
				}
	  	}
			else {
				if('_id' in this) {
					var src = this.source;
					// single key
					if(this._id.length == 1) {
						src[this._id[0]] = v
					}
					// multi key
					else {
						for(var i = 0; i &lt; this._id.length; i++) {
							var key = this._id[i];
							if(key in v)
								src[key] = v[key];
						}
						// for(var i in v) {//var i = 0; i &lt; this._id.length; i++) {
						// 	src[this._id[i]] = v[i];
						// }
					}
				}
				else {
					this.source = v;
				}
			}
		}
//		this._cached = v;
		return v;
	},


	/**
	 *     
	 *
	 *       ,      
	 *
	 * @param {Number|String} [i] 
	 * @returns {Any}
	 */
	get: function(i) {
		if(i === undefined){
			return this._val();
		}
		else {
			return this.entry(i).get();
		}
	},

	/**
	 *   
	 *
	 * @param {Number|String} i 
	 * @returns {Any}
	 */
	copy: function(i) {
		return Ergo.deep_copy(this.get(i));
	},



	/**
	 *   
	 *
	 *   ,      
	 *
	 * @param {String|Number} [i] 
	 * @param {Any} val  
	 *
	 */
	set: function(i, newValue) {
		if(arguments.length == 1) {
			newValue = i;

			var oldValue = this.get();





			// var filtered = [];
			// this.entries.each(function(e) {
			// 	//FIXME    
			// 	if(newValue &amp;&amp; newValue[e.id] === undefined)
			// 		filtered.push(e);
			// });

			// for(var i = 0; i &lt; filtered.length; i++) {
			// 	filtered[i]._destroy();
			// }


			this.entries
				.filter(function(e){
					//FIXME    
					return (newValue &amp;&amp; newValue[e._id.join('+')] === undefined);
				})
				.each(function(e){
					e._destroy();
				});


			if(this.entries.is_empty())
				this.entries = Array.isArray(newValue) ? new Ergo.core.Array() : new Ergo.core.Collection();

			//   
//			this.entries.filter(function(e) { return true; }).each(function(e){	e._destroy(); });
			//   
			//    ,     Object  Array  
//			this.entries = $.isArray(newValue) ? new Ergo.core.Array() : new Ergo.core.Collection();


			// var entries_to__destroy = [];
//
			// this.entries.each(function(e){
// //				//FIXME    
// //				if(newValue[e.id] === undefined) entries_to__destroy.push(e);
				// entries_to__destroy.push(e);
			// });
//
			// for(var i = 0; i &lt; entries_to__destroy.length; i++)
				// entries_to__destroy[i]._destroy();


			//   
//			this.entries.apply_all('_destroy');



			this._val(newValue);





			// var ds = this.source;
			// while(ds) {
			// 	ds.events.fire('entry:changed', {entry: this});
			// 	ds = ds.source;
			// }

			if(this.source instanceof Ergo.core.DataSource) {
//				this.source.events.fire('entry:changed', {entry: this, changed: [this]});
				if(!this.source._no_diff) {
					this.source.events.fire('diff', {updated: [this]});
//					this.mark_dirty();
				}
			}

			this.events.fire('changed', {'oldValue': oldValue, 'newValue': newValue});

//			console.log('set', oldValue, newValue);

			if(this.source instanceof Ergo.core.DataSource) {
//				this.source.events.fire('entry:changed', {entry: this, changed: [this]});
				if(!this.source._no_diff) {
//					this.source.events.fire('diff', {updated: [this]});
					this.mark_dirty();
				}
			}


			// var self = this;
			//
			// // FIXME
			// if(this.source instanceof Ergo.core.DataSource) {
			// 	this.source.entries.each(function(e) {
			// 		e._id.forEach(function(id) {
			// 			if(id == self._id[0])
			// 				e.events.fire('changed', {'oldValue': oldValue, 'newValue': newValue});
			// 		})
			// 	});
			// }


//			this._changed = true;
			return this;
		}
		else {
			return this.entry(i).set(newValue);
		}

	},



	/**
	 *   
	 *
	 *
	 * @param {Any} value   
	 * @param {String|Number} [index]   ,     
	 * @returns {Ergo.core.DataSource}
	 */
	add: function(value, index) {

		var values = this.get();

		var isLast = false;

		if(Array.isArray(values)) {

			if(index == null){
				values.push(value);
				index = values.length-1;
				isLast = true;
			}
			else {

				//    
				for(var i = values.length-1; i >= index; i--){
					var e = this.entries.get(i);
					// this.events.fire('onIndexChanged', {'oldIndex': j, 'newIndex': (j-1)});
					if(e)
						e._id[0] = i+1;

					this.entries.set(i+1, e);
				}

				//    
				values.splice(index, 0, value);

				this.entries.set(index, this._factory(index));

			}

		}
		else {
//			throw new Error('Method "add" does not support object src');
			values[index] = value;
		}


		var e = this.entry(index);


//		this.events.fire('entry:added', {'index': isLast ? undefined : index, entry: e});//, 'isLast': isLast});
		if(!this._no_diff) {
			this.events.fire('diff', {created: [e]});
			this.mark_dirty(true);
		}

//		e.events.fire('changed', {created: [e]}); // ?


		return e;
	},


	/**
	 *  .
	 *
	 *     ,       
	 *
	 * @param {String|Number} [i] 
	 *
	 */
	del: function(i) {
		if(arguments.length == 1) {
			this.entry(i).del();
		}
		else {

//			this.events.fire('changed', {/*'oldValue': deleted_value, 'newValue': undefined,*/ deleted: [this]});

			var src = this.source;
			var value = src;

			if( src instanceof Ergo.core.DataSource ) {
				value = src._val();
			}

			var deleted_value = this._val(); //value ? value[this._id[0]] : undefined;

			if(Array.isArray(value)) {

				value.splice(this._id[0], 1);

				if( src instanceof Ergo.core.DataSource ) {
					for(var j = this._id[0]; j &lt; value.length; j++) {
						var e = src.entries.get(j+1);
						if(e)
							e._id[0] = j
					}
				}

			}
			else {
				if(value) {
					for(var j = 0; j &lt; this._id.length; j++)
						delete value[this._id[j]];
				}
			}



			if( this.source instanceof Ergo.core.DataSource ) {
				src.entries.remove(this);
				if(!this.source._no_diff) {
//				src.events.fire('entry:deleted', {'entry': this, 'value': deleted_value});
					this.source.events.fire('diff', {deleted: [this]});
					this.source.mark_dirty(true);
				}
			}


		}
	},




	/**
	 *  .
	 *
	 * @param {Any} [v] 
	 *
	 */
	rm: function(v) {

		var val = this._val();

		var k = null;
		var criteria = JSON.stringify(v);
		Ergo.find(val, function(obj, i) {
			if( JSON.stringify(obj) === criteria ) {
				k = i;
				return true; //  
			}
		});

		if( k != null) {
			this.del(k);
		}

	},





	/**
	 *        
	 *
	 * @param {Function} callback
	 *
	 */
	each: function(callback, filter, sorter) {

		var ds = this;

		var values = ds.get();
//		var keys = this.keys(this.options.filter);

		var filter = filter || ds.options.filter;
		var sorter = sorter || ds.options.sorter;


		if( filter || sorter ) {

			var kv_a = [];

			// Filtering source and mapping it to KV-array
			Ergo.each(values, function(v, i) {
				if(!filter || filter(v, i)) {
					kv_a.push( [i, v] );
	//				callback.call(self, self.entry(i), i, v);
				}
			});



			if(sorter) {
				// Sorting KV-array
				kv_a.sort( sorter );
			}


			for(var i = 0; i &lt; kv_a.length; i++) {
				var kv = kv_a[i];
				callback.call(ds, ds.entry(kv[0]), kv[0], kv[1]);
			}

		}
		else {

			Ergo.each(values, function(v, i) {
				callback.call(ds, ds.entry(i), i, v);
			});

		}


		// var keys = [];
		// if($.isArray(values)) {
			// for(var i = 0; i &lt; values.length; i++) keys.push(i);
		// }
		// else {
			// for(var i in values) keys.push(i);
		// }

		//TODO       (, )
		// if(this.options.filter){
			// keys = this.options.filter.call(this, values, keys);
		// }

		// for(var i = 0; i &lt; keys.length; i++){
			// var k = keys[i];
			// callback.call(this, this.entry(k), k, values[k]);
		// }
	},



	sync: function(newData) {

		var self = this;

		var valueUid = (this.options.valueUid || this._valueUid);
		var valueEql = (this.options.valueEql || this._valueEql);

		var oldData = this._val();

		var diff = {
			created: [],
			deleted: [],
			updated: []
		}

//		console.log('sync', oldData, newData);

		this._no_diff = true;

		// for arrays

		if( Array.isArray(oldData) &amp;&amp; Array.isArray(newData) ) {

			var value_m = {};

			for(var i = 0; i &lt; newData.length; i++) {
				//TODO      
				var v = newData[i];
				var k = valueUid.call(this, v, i);
				// if(this.options.idKey) {
				// 	value_m[newData[i][this.options.idKey]] = {value: newData[i], index: i};
				// }
				// else {
				value_m[k] = {value: newData[i], index: i};
	//			}
			}

	//		console.log('sync', JSON.stringify(value_m));

			for(var i = 0; i &lt; oldData.length; i++) {
				var v = oldData[i];
				var k = valueUid.call(this, v, i);
	//			var k = (this.options.idKey) ? v[this.options.idKey] : i;
				if( k in value_m ) {
					delete value_m[k];
				}
				else {
					// DELETE
					diff.deleted.push( this.entry(i) );
				}
			}

			for(var i = diff.deleted.length-1; i >= 0; i-- ) {
				diff.deleted[i].del();
			}


			Object.keys(value_m)
				.map(function(k) { return value_m[k] })
				.sort(function(a,b) { return a.index-b.index; })
				.forEach(function(val) {

					var v = val.value;
					var i = val.index;

					// CREATE
					diff.created.push( self.add(v, i) );

				});


			this._val( newData );


			for(var i = 0; i &lt; newData.length; i++) {
				if( !valueEql(oldData[i], newData[i]) ) {
	//			if( JSON.stringify(oldData[i]) !== JSON.stringify(newData[i]) ) {
					diff.updated.push( this.entry(i) );
				}
			}


		}
		// for objects
		else {

			var value_m = {};

			//   uid-  
			for(var i in newData) {
				var v = newData[i];
				var k = valueUid.call(this, v, i);
				value_m[k] = {value: newData[i], index: i};
			}

			//   uid-  
			for(var i in oldData) {

				var v = oldData[i];
				var k = valueUid.call(this, v, i);

				if( k in value_m ) {
					delete value_m[k];
				}
				else {
					// DELETE
					diff.deleted.push( this.entry(i) );
				}
			}

			//   
			for(var i = diff.deleted.length-1; i >= 0; i-- ) {
				diff.deleted[i].del();
			}

			//    
			Object.keys(value_m)
				.map(function(k) { return value_m[k] })
				.forEach(function(val) {

					var v = val.value;
					var i = val.index;

					// CREATE
					diff.created.push( self.set(i, v) );

				});


			//  
			this._val( newData );

			//     
			for(var i in newData) {
				if( !valueEql(oldData[i], newData[i]) ) {
					diff.updated.push( this.entry(i) );
				}
			}

		}


		// if(diff.updated.length != 0) {
		// }


		this._no_diff = false;


//		console.log('sync diff', diff, oldData, newData);

		this.events.fire('diff', diff);

		// for(var i = diff.created.length-1; i >= 0; i-- ) {
		// 	diff.created[i].events.fire('changed');
		// }
		for(var i = diff.updated.length-1; i >= 0; i-- ) {
			diff.updated[i].events.fire('changed');
		}

		this.mark_dirty(true);

	},


	_valueEql: function(a, b) {
		return JSON.stringify(a) === JSON.stringify(b);
	},

	_valueUid: function(v, i) {
		return i;
	},


	// diff: function(difference, filter, sorter) {
	//
	// 	var ds = this;
	//
	// 	// DELETED
	// 	for(var i = 0; i &lt; difference.deleted.length; i++) {
	// 		var d = difference.created[i];
	// 		this.events.fire('entry:deleted', {entry: d.entry});
	// 	}
	//
	// 	// CREATED
	// 	for(var i = 0; i &lt; difference.created.length; i++) {
	// 		var d = difference.created[i];
	// 		if(!filter || filter.call(this, d.value, d.id)) {
	// 			var index = d.id;
	// 			if(sorter) {
	// 				// FIXME    
	// 			}
	// 		}
	// 	}
	//
	//
	//
	//
	// },

/*
	keys: function(criteria) {
		var keys = [];
		var values = this.get();

		Ergo.each(function(v, i){
			if(criteria || criteria.call(this, v, i)) keys.push(i);
		});

		return keys;

		// if($.isArray(values)) {
			// for(var i = 0; i &lt; values.length; i++) keys.push(i);
		// }
		// else {
			// for(var i in values) keys.push(i);
		// }
		// return keys
	},
*/


	mark_dirty: function(do_event, e) {
		this._changed = true;

		if(this.source &amp;&amp; this.source instanceof Ergo.core.DataSource) {// &amp;&amp; !this.source._changed)


			var self = this;

			this.source.entries.each(function(src_entry) {
				if(src_entry != self &amp;&amp; src_entry._id.length > 1) {
					src_entry._id.forEach(function(id) {
						// FIXME
						if(id == self._id[0]) {
							src_entry.events.fire('dirty', e || {});
						}
					})
				}
			})

			this.source.mark_dirty(true, {updated: [this]});
		}

		if(do_event)
			this.events.fire('dirty', e || {});

	},



	walk: function(callback) {
		//TODO
	},

	/**
	 * ,           /
	 *
	 * @returns {Boolean}
	 */
	changed: function() {
		if(this._changed) return true;
		var found = this.entries.find(function(e){ return e.changed(); });
		return found != null;
	},

	/*
	 *    ,       
	 */
	clean: function() {
		this._changed = false;
		this.entries.apply_all('clean');
	},


	/**
	 *     
	 *
	 * @returns {Number}
	 */
	size: function() {
		return Ergo.size(this._val());
	}



});




Ergo.override(Ergo.core.DataSource.prototype, Ergo.alias('mixins:observable'));



/**
 *    
 *
 * @namespace Ergo.data
 */
Ergo.data = {};


Ergo.$data = Ergo.object;






/**
 *  
 *
 *
 * @class
 * @name Ergo.core.StateManager
 * @extends Ergo.core.Object
 */
Ergo.defineClass('Ergo.core.StateManager', 'Ergo.core.Object', /** @lends Ergo.core.StateManager.prototype */{


	_initialize: function(widget) {
		this._widget = widget;
		this._current = {};
		this._states = {};
		this._transitions = [];
		this._exclusives = {};
//		thi._substates = {};
	},


	transition: function(from, to, value) {

		var t = this._transitions;
//		var s = name.replace(/\s/g, '');
//		if(!t[from]) t[from] = {};
//		t[from][to] = value;
		t.push({
			from: from,
			to: to,
			action: value
		});

	},


	exclusive: function(name, g) {

//		var excl_template = new RegExp('^'+name+'.*$');
		var excl_template = new RegExp('^'+name+'$');

		var group = this._exclusives[g];
		if(!group) group = [];
		this._exclusives[g] = group;

		group.push(excl_template);
	},

	exclusive_group: function(g, exclusives) {
		for(var i = 0; i &lt; exclusives.length; i++)
			this.exclusive(exclusives[i], g);
	},



	state: function(name, value) {

		//   
		if(value &amp;&amp; value.constructor === Object) {
			var group = this._exclusives[name] || [];
			for(var i in value) {
				this.state(i, value[i]);
				group.push(new RegExp('^'+i+'$'));
			}
			this._exclusives[name] = group;
		}
		else {

			//FIXME   
			var i = name.indexOf(':');
			if( i == 0 ) {
				var g = name.substr(1);
				this.exclusive_group(g, value);
			}
			else {
				if( i > 0 ) {
					var g = name.substr(i+1);
					name = name.substr(0, i);

					this.exclusive(name, g);
				}

				this._states[name] = value;
			}
		}
	},



	/**
	 *  
	 *
	 * @param {String} to  
	 * @param {Object} data ,   
	 * @returns {$.Deferred}
	 */
	set: function(to, data) {

		if(!to || (typeof to !== 'string')) {
			console.warn('State key ['+$ergo.print(to)+'] must be of type string');
			return false;
		}

		var to_a = to.split('.');

		var parent = null;

		//   , 
		if(to_a.length > 1) {

			to = to_a.pop();

			//  
			for(var i = 0; i &lt; to_a.length; i++) {
				var stt = to_a[i];
				if(!this._current[stt]) {
					this._state_on(stt, data);
					this._current[stt] = {
						from: null, //FIXME
						data: data,
						parent: parent
					}
				}
				parent = stt;
			}

			//   
			for(var i in this._current) {
				var stt = this._current[i];
				if(stt.parent == parent) {
					this.unset(i);
					break;
				}
			}

		}

		//    ,    
		if(to &amp;&amp; (to in this._current))
			return false;//$.when({});




		var self = this;
		var transitions = this._transitions;
		var states = this._states;//this._widget.options.states;

		var from = [];

		// 1.
		var def = null;
		var deferreds = [];

		for(var i = 0; i &lt; transitions.length; i++) {
			var t = transitions[i];
			if(t.to == to &amp;&amp; t.from in this._current) {
				var result = t.action.call(this._widget);
				//    Deferred-,     
//				if(result &amp;&amp; result.done)
				deferreds.push(result);
//					deferred = deferred ? $.when(deferred, result) : $.when(result);

				from.push(t.from);
			}
			else if(t.to == to &amp;&amp; t.from == '*'){
				def = t;
			}
		}
		// for(var i in this._current) {
			// if(i in transitions &amp;&amp; to in transitions[i]) {
				// transitions[i][to].call(this._widget);
				// from.push(i);
			// }
		// }

		for(var g in this._exclusives) {
			if( this._is_exclusive(to, g) ) {

				for(var i in this._current)
					if(this._is_exclusive(i, g)) {
						this._state_off(i);
						delete self._current[i];
					}
//						this.unset(i);

			}
		}





		if(from.length == 0 &amp;&amp; def) {
			var result = def.action.call(this._widget);

//			if(result &amp;&amp; result.done)
			deferreds.push(result);
//				deferred = $.when(result);
		}





		// if(deferreds.length == 0)
			// deferreds.push({});



		//FIXME ,  Deferred  
		// if(deferred == null) {
			// deferred = $.Deferred();
			// deferred.resolve();
		// }


		var changeState = function() {
			// 2.         
			for(var i = 0; i &lt; from.length; i++) {
				delete self._current[from[i]];
			}

			// 3.   
			self._state_on(to, data);
			self._current[to] = {
				from: from,
				data: data,
				parent: parent
			};

			// 4.  ,   
//			self._widget.events.fire('stateChanged', {from: from, to: to, data: data});

			return true;
		}



		return (deferreds.length == 0) ? changeState.call(this) : $.when.apply($, deferreds).done(changeState);

//		return deferred;
	},



	_state_on: function(s, data) {

		var self = this;
		var states = this._states;//this._widget.options.states;

		if(s in states) {
			var val = states[s];

			//    ,      
			if($.isString(val)) {
				this._widget.vdom.addClass(val);
			}
//				this._widget.el.classList.add(val);
			//    ,      ON,     OFF
			else if( Array.isArray(val) ) {
				this._widget.vdom.addClass(val);
				this._widget.vdom.removeClass(val[1]);
				// this._widget.el.classList.add(val[0]);
				// this._widget.el.classList.remove(val[1]);

				// if(val.length > 0) {
				// 	$.when( val[0].call(this._widget, true, data) ).done(function(add_cls) {
				// 		if(add_cls !== false)
				// 			self._widget.el.addClass(add_cls || s);
				// 	});
				// }
			}
			else if(val.constructor == Object) {
				console.warn('State group ['+s+'] can not be used as state');
			}
			//    ,    
			else {
				$.when( val.call(this._widget, true, data) ).done(function(add_cls) {
					if(add_cls !== false)
						self._widget.vdom.addClass(add_cls || s);
				});
			}
		}
		else {
			this._widget.vdom.addClass(s);
		}

		this._widget.events.fire('stateChanged', {state: s, op: 'on', data: data});
	},





	_state_off: function(s) {

		var self = this;
		var states = this._states;//this._widget.options.states;

		if(s in states) {
			var val = states[s];

			//    ,      
			if($.isString(val))
				this._widget.vdom.removeClass(val);
			//    ,      ON,     OFF
			else if( Array.isArray(val) ) {
				this._widget.vdom.addClass(val[1]);
				this._widget.vdom.removeClass(val[0]);

				// if(val.length > 1) {
				// 	$.when( val[1].call(this._widget, false) ).done(function(rm_cls) {
				// 		if(rm_cls !== false)
				// 			self._widget.el.removeClass(rm_cls || s);
				// 	});
				// }
			}
			//    ,    
			else {
				$.when( val.call(this._widget, false) ).done(function(rm_cls) {
					if(rm_cls !== false)
						self._widget.vdom.removeClass(rm_cls || s);
				});

//				var rm_cls = val.call(this._widget, false);
//				if(rm_cls !== false)
//					this._widget.el.removeClass(s);
			}
		}
		else {
			this._widget.vdom.removeClass(s);
		}

		this._widget.events.fire('stateChanged', {state: s, op: 'off'});

	},



	_is_exclusive: function(s, g) {

		var group = this._exclusives[g];

		for(var i = 0; i &lt; group.length; i++) {
			if(s.match(group[i])) return true;
		}

		return false;
	},


	/**
	 *  
	 *
	 * @param {String} from  
	 * @returns {$.Deferred}
	 */
	unset: function(from) {

		//    ,    
		if(from &amp;&amp; !(from in this._current)) {
			return false;//$.when({});
		}



		var self = this;
		var transitions = this._transitions;
		var states = this._states; //this._widget.options.states;

		var to = [];

		// 1. 
		var def = null;
		var deferreds = [];

		for(var i = 0; i &lt; transitions.length; i++) {
			var t = transitions[i];
			if(t.from == from &amp;&amp; t.to) {
				var result = t.action.call(this._widget);
				//    Deferred-,     
//				if(result &amp;&amp; result.done)
//					deferred = $.when(result);
				deferreds.push(result);

				to.push(t.to);
			}
			else if(t.from == from &amp;&amp; t.to == '*') {
				def = t;
			}
		}
		// for(var i in transitions[from]) {
			// transitions[from][i].call(this._widget);
			// to.push(i);
		// }




		for(var g in this._exclusives) {
			if( this._is_exclusive(from, g) &amp;&amp; this._exclusives[g].length == 2 ) {

				var group = this._exclusives[g];

				var regexp = from.match(group[0]) ? group[1] : group[0];

				for(var i in this._states)
					if( i.match(regexp) ) {
						this._state_on(i);
						self._current[i] = {
							from: from
//							data: data
						}
					}
			}
		}





		if(to.length == 0 &amp;&amp; def) {
			var result = def.action.call(this._widget);

			deferreds.push(result);
			// //FIXME
			// if(result &amp;&amp; result.done)
				// deferred = $.when(result);

		}



		// 2.
		for(var i = 0; i &lt; to.length; i++) {
			self._current[to[i]] = {from: [from]/*, data: data*/};
			if(to[i] in states) self._state_on(to[i]); //states[to[i]].call(self._widget);
		}

		// 3.
		self._state_off(from);

		delete self._current[from];


		// 3.
//		this.state_off(from);



		//FIXME ,  Deferred  
		// if(deferred == null) {
			// deferred = $.Deferred();
			// deferred.resolve();
		// }



		// deferred.done(function() {
//
		// });



//		return deferred;
		return (deferreds.length == 0) ? true : $.when.apply($, deferreds);
	},



	/**
	 *  
	 *
	 *  ,    true  ,   false
	 *
	 * @param {String} name  
	 * @param {boolean} sw  
	 */
	toggle: function(name, sw) {

		if(arguments.length == 1) sw = !this.is(name);

		return sw ? this.set(name) : this.unset(name);

//		return this;
	},



	/**
	 *      ,   
	 *
	 * @deprecated
	 *
	 * @param {String} name  
	 * @param {Array|String|RegExp} unset_template 
	 */
	only: function(name, unset_template) {

		var states_to_unset = [];

		if(unset_template) {

			if( $.isArray(unset_template) )
				states_to_unset = unset_template;
			else {
				if($.isString(unset_template))
					unset_template = new RegExp('^'+unset_template+'.*$');

				for(var i in this._current)
					if(i.match(unset_template)) states_to_unset.push(i);
			}
		}
		else {
			for(var i in this._current)
				if(i != name) states_to_unset.push(i);
		}

		//  ,   
		for(var i = 0; i &lt; states_to_unset.length; i++)
			this.unset(states_to_unset[i]);

		//     ,   
		if(!this.is(name))
			this.set(name);

		return this;
	},



	/**
	 *   
	 *
	 */
	clear: function() {
		this._current = {};
		return this;
	},


	/**
	 * ,   
	 *
	 * @param {String} name  
	 */
	is: function(name) {
		return (name in this._current);
	}



});






Ergo.alias('mixins:statable', {

	get states() {
		if( !this.__stt ) {
			this.__stt = new Ergo.core.StateManager(this);
			this._bindStates();
		}
		return this.__stt;
	},



	set stt(v) {
		var self = this;
		if(Array.isArray(v)) {
			v = v.join(' ');
		}
		v.split(' ').forEach(function(s) {
			self.states.set(s);
		});
	},



	_bindStates: function() {
		var o = this.options;

		if('states' in o){
			for(var i in o.states)
				this.states.state(i, o.states[i]);
			// //     hover ?
			// if('hover' in o.states) {
			// 	this.el.hover(function(){ self.states.set('hover'); }, function(){ self.states.unset('hover'); });
			// }
		}

		if('transitions' in o) {
			for(var i in o.transitions) {
				var t = o.transitions[i];
				if($.isPlainObject(t)) {
					//TODO
				}
				else {
					var a = i.split('>');
					if(a.length == 1) a.push('');
					this.states.transition(a[0].trim() || '*', a[1].trim() || '*', t);
				}
			}
		}

	}


});





/**
 * ,  StateManager  
 *
 * @mixin statable
 */

Ergo.alias('includes:statable', {

	_construct: function(o) {

		this.states = new Ergo.core.StateManager(this);

	//	var o = this.options;
		var self = this;

		if('states' in o){
			for(var i in o.states)
				this.states.state(i, o.states[i]);
			//     hover
			if('hover' in o.states) {
				this.el.hover(function(){ self.states.set('hover'); }, function(){ self.states.unset('hover'); });
			}
		}

		if('transitions' in o) {
			for(var i in o.transitions) {
				var t = o.transitions[i];
				if($.isPlainObject(t)) {
					//TODO
				}
				else {
					var a = i.split('>');
					if(a.length == 1) a.push('');
					this.states.transition(a[0].trim() || '*', a[1].trim() || '*', t);
				}
			}
		}

	},


	overrides: {

		set stt(v) {
			var self = this;
			v.split(' ').forEach(function(s) {
				self.states.set(s);
			});
		}


	}


});





Ergo.core.VDOM = function() {
	var a = new Array(arguments.length);
	for(var i = 0; i &lt; arguments.length; i++)
		a[i] = arguments[i];

	this._initialize.apply(this, arguments);

}


Ergo.override(Ergo.core.VDOM.prototype, {


	_initialize: function(tag, widget, options) {

    var vdom = this;

    this._widget = widget;
    this.options = options || {};


//    var o = this._widget.options;

    //  DOM-
    if( tag ) {
      this.el = (tag.constructor === String) ? document.createElement(tag) : tag;
    }
    else {
      this.el = document.createTextNode('');
    }


    //      




    //  
    this.events = {

      listeners: {},

      on: function(name, callback) {
        this.listeners[name] = callback.bind(vdom._widget);
        vdom.el.addEventListener(name, this.listeners[name]);
        // widget.events.on('dom#'+name, callback);
        // if(!this.listeners[name]) {
        //   this.listeners[name] = function(e) { this.events.fire('dom#'+name, {}, e); }.bind(widget);
        //   vdom.el.addEventListener(name, this.listeners[name]);
        // }
      },

      off: function(name) {
        vdom.el.removeEventListener(name);
        delete this.listeners[name];
        // _widget.events.off('dom#'+name);
        // for(var i in this._listeners) {
        //   vdom.el.removeEventListener(name);
        // }
      }
    }


    //FIXME   
    this.el._vdom = this;

	},




	setStyle: function(k, v) {
		if(arguments.length == 2) {
			v = (typeof v === 'number') ? $ergo.dom.numberStyleToPx(k, v) : v;
			this.el.style[k] = v;
		}
		else if(arguments.length == 1 &amp;&amp; k) {
			if( k.constructor === Object ) {
				for(var i in k) {
					var v = k[i];
					v = (typeof v === 'number') ? $ergo.dom.numberStyleToPx(i, v) : v;
					this.el.style[i] = v;
				}
			}
			else if( k.constructor === String ) {
				return this.el.style[k];
			}
		}
	},



	setClass: function(cls) {
		if( cls &amp;&amp; this.el instanceof Element ) {
			this.el.className = cls;//.join(' ');
		}
	},

	addClass: function(cls) {
		if( cls &amp;&amp; this.el instanceof Element ) {
      var vdom = this;
			(''+cls).split(' ').forEach(function(c) {

				if(!c) return;

				if(vdom.el.classList) {
					vdom.el.classList.add(c);
				}
				else {
					// IE9
					var re = new RegExp("(^|\\s)" + c + "(\\s|$)", "g");
					if(!re.test(vdom.el.className)) {
						vdom.el.className = (vdom.el.className + " " + c).replace(/\s+/g, " ").replace(/(^ | $)/g, "")
					}
				}
			});
		}
	},

	removeClass: function(cls) {
		if( cls &amp;&amp; this.el instanceof Element ) {
      var vdom = this;
			(''+cls).split(' ').forEach(function(c) {

				if(!c) return;

				if(vdom.el.classList) {
					vdom.el.classList.remove(c);
				}
				else {
					// IE9
					var re = new RegExp("(^|\\s)" + c + "(\\s|$)", "g");
					vdom.el.className = vdom.el.className.replace(re, "$1").replace(/\s+/g, " ").replace(/(^ | $)/g, "");
				}
			});
		}
	},

	detach: function() {
		if(this.el.parentNode) {
			this.el.parentNode.removeChild(this.el);
		}
	},


	each: function(callback) {
		Array.prototype.forEach.call(this.el.childNodes, callback);
	}



});














/**
 * @class
 * @name Ergo.core.Layout
 * @param {Object} opts
 */

// Ergo.core.Layout = function() {
// 	var a = new Array(arguments.length);
// 	for(var i = 0; i &lt; arguments.length; i++)
// 		a[i] = arguments[i];
//
// 	this._initialize.apply(this, arguments);
//
// }
//
// Ergo.override(Ergo.core.Layout.prototype, {

Ergo.declare('Ergo.core.Layout', 'Ergo.core.VDOM', /** @lends Ergo.core.Layout.prototype */ {

	defaults: {
//		updateMode: 'auto'
	},


	_initialize: function() {
		Ergo.core.Layout.superclass._initialize.apply(this, arguments);

		var o = this.options;


		this.outerEl = this.el;
    this.innerEl = this.el;


//		this.options = o || {};
		if('name' in this.defaults) {
			this.options.name = this.defaults.name;
		}

		if('name' in o) this.el.setAttribute('layout', o.name);
		if('cls' in o) this.addClass(o.cls.join(' '));

		//  
    if(this.html) {
      this.el.innerHTML = this.html;
      while(this.innerEl.childNodes.length) {
        this.innerEl = this.innerEl.childNodes[0];
      }
    }



	},




	// get inner() {
	// 	return (this.innerEl == this.el) ? this : new Ergo.core.VDOM(this.innerEl);
	// },
	//
	// get outer() {
	// 	return (this.outerEl == this.el) ? this : new Ergo.core.VDOM(this.outerEl);
	// },






	detach: function() {
		if(this.outerEl.parentNode) {
			this.outerEl.parentNode.removeChild(this.outerEl);
		}
	},


/*
	_initialize: function(o){
//		this._super(o);
		Ergo.core.Layout.superclass._initialize.call(this, o);

		this.events = new Ergo.events.Observer(this);

//		var o = this.options = {};
//
//		Ergo.hierarchy(this.constructor, function(clazz){
//			if('defaults' in clazz) Ergo.smart_override(o, clazz.defaults);
//		});
//		Ergo.smart_override(o, this.defaults, opts);

	},
*/

	/**
	 *    
	 * @param {Object} c 
	 */
// 	attach: function(c) {
//
// 		var o = this.options;
//
// //		this._widget = c;
//
// 		if('name' in o) this.el.setAttribute('layout', o.name);
// 		if('cls' in o) this.addClass(o.cls.join(' '));
//
// 		// this.dom = this._widget.dom;
// 		// this.el = this._widget.dom.el;
//
// 		// if(o.html){
// 		// 	var html = $(o.html);
// 		// 	this.el = (o.htmlSelector) ? $(o.htmlSelector, html) : html;
// 		// 	this._widget.el.append(html);
// 		// }
//
// 		// this._widget.events.on('diff', function(e) {
// 		// 	//  
// 		// 	this._rebuild(e.updated);
// 		// }.bind(this));
//
// 	},

	/**
	 *     
	 */
// 	detach: function() {
// //		if('containerCls' in this.options) this.container.el.removeClass(this.options.containerCls);
// 		if('name' in this.options) this.el.removeAttribute('layout');
// 		if('cls' in o) this.el.removeClass(o.cls.join(' '));
// 		delete this._widget;
// 	},



	/**
	 *  .
	 *
	 * @param {Ergo.core.Widget} item 
	 * @return {jQuery} jQuery-,     
	 *
	 */
	wrap: function(item) {
		return item.vdom.el;
	},


	/**
	 * jQuery-,    
	 *
	 */
	select: function(item) {
		return this.innerEl;
//		var o = this.options;
//		return (o.elementSelector) ? o.elementSelector.call(this, item) : this.el;
	},






	/**
	 *   -  
	 *
	 * @param {Ergo.core.Widget} item 
	 * @param {int} index   (   )
	 * @param {int} weight  
	 */
/*
	add: function(item, pos, weight, group) {

//		var selector = item.options.layoutSelector;

//		var el = this.el;

		var o = this.options;


		//FIXME  
		//    ,     0
		var weight = item.options.weight || 0;
//		item._weight = weight;

		// 
//		var index = item._index;


		//  ,    -
		var el = (o.selector) ? o.selector.call(this, item) : this.select(item);

		//   (  )  -
		var item_el = (o.wrapper) ? o.wrapper.call(this, item) : this.wrap(item);



		if(item.options.wrapper) {

			if(item_el == item.__vdom.el) {
				item_el = document.createElement('div');
				item_el.appendChild(item.__vdom.el);
//				item_el = $('&lt;div/>').append(item.dom.el);
			}

			item._wrapper = $.ergo( Ergo.deep_override({etype: 'widgets:widget', tag: item_el, autoRender: false}, item.options.wrapper) );
			item._wrapper._weight = weight;

		}


		if(item_el != item.__vdom.el) {
			item.__vdom.outerEl = item_el;
		}

		//  
		if(item._key &amp;&amp; item.options.autoClass) {
			$ergo.dom.addClass(item_el, item._key);
		}
//			item_el.addClass(item._key);



//		item_el.data('weight', weight);



//		item_el._group = item.options.group;


//		var elements = el.contents();
		var elements = el.childNodes;// new Ergo.core.Array(el[0].childNodes);

		//   
		// if(item.options.group) {
		// 	elements = Array.prototype.filter.call(elements, function(elem) {
		// 		return ( elem._ergo &amp;&amp; elem._ergo.options.group == item.options.group )
		// 	});
		//
		// 	// var filtered = [];
		// 	// for(var j = 0; j &lt; elements.length; j++) {
		// 	// 	var elem = elements[j];
		// 	// 	if( elem._ergo &amp;&amp; elem._ergo.options.group == item.options.group ) filtered.push(elem);
		// 	// }
		// 	// elements = filtered;
		//
		//
		// 	// elements = Ergo.filter(elements, function(i, elem){
		// 		// return (elem._ergo) ? (elem._ergo.options.group == item.options.group) : false;
		// 	// });
		// }


		if(group) {

			var beforeEl = null;
			var afterEl = null;

			for(var i = 0; i &lt; group.length; i++) {
				var g = group[i];
				var groupElements = [];

//				var lastEl = elements[elements.length-1];

				for(var j = 0; j &lt; elements.length; j++) {
					var siblingEl = elements[j];
					var siblingGroup = siblingEl._group[i];
					//    (+)
					if(siblingGroup[0] == g[0] &amp;&amp; siblingGroup[1] == g[1]) {
						groupElements.push(elements[j]);
					}
					//   (+)
					else if(siblingGroup[0] &lt; g[0] || siblingGroup[1] &lt; g[1]) {
						beforeEl = siblingEl;
					}
					//   (+)
					else if(siblingGroup[0] > g[0] &amp;&amp; siblingGroup[1] > g[1]) {
						afterEl = siblingEl;
					}
				}

				elements = groupElements;
			}
		}






		//    ,         
		if(pos == null) {

			pos = 0;

			//          
			var after_el = null;

			//  
			var last = elements[elements.length-1];

//			index = 0;

			if(elements.length == 0) {
				el.appendChild( item_el );
			}
			else if(last._weight &lt;= weight) {
				$ergo.dom.insertAfter(item_el, last);
				pos = last._pos+1;
//				last.after(item_el);
			}
			// else if(last[0]._weight == weight) {
			// 	last.after(item_el);
			// 	index = last[0]._index+1;
			// }
			else {

				for(var j = 0; j &lt; elements.length; j++) {
					var elem = elements[j];
					var w = elem._weight;// $(elem).data('weight');
					if(w > weight) {
						after_el = elem;
						break;
					}
					else if(w == weight) {
						pos = elem._pos+1;
					}
					// else if(w == weight) {
					// 	index = elem._index+1;
					// }
				}
				// elements.each(function(i, elem){
					// var w = elem._weight;// $(elem).data('weight');
					// if(w > weight) {
						// after_el = $(elem);
						// return false;
					// }
				// });


				if(after_el)
					$ergo.dom.insertBefore(item_el, after_el);
//					after_el.before( item_el );
				else if(elements.length)
					$ergo.dom.insertAfter(item_el, last);
//					last.after( item_el );
				else
					el.appendChild( item_el );
//					el.append( item_el );
			}




//			item_el[0]._index = index;

			// var after_el = null;
			// el.children().each(function(i, elem){
				// var w = $(elem).ergo();
				// if(w &amp;&amp; w._weight > weight) {
					// after_el = $(elem);
					// return false;
				// }
			// });
//
			// if(after_el)
				// after_el.before( item_el );
			// else
				// el.append( item_el );
		}
		// else if(index === 0) {
			// var before_a = [];
			// for(var i = elements.length-1; i >= 0; i--) {
				// var w = $(elements[i]).ergo();
				// if(w &amp;&amp; w._weight &lt; weight) before_a.push($(elements[i]));
			// }
//
			// if(before_a.length > 0)
				// before_a[before_a.length-1].after( item_el );
			// else if(elements.length)
				// elements.first().before( item_el );
			// else
				// el.prepend( item_el );
		// }
		else {

//			console.log(index);

//			var elements = el[0].childNodes;// new Ergo.core.Array(el[0].childNodes);


			//  
			var last = elements[elements.length-1];

			// if(elements.length > 0)
				// console.log('last ', last[0]);
//			console.log('--1--');
//			console.log(elements.length);
//			console.log(elements[elements.length-1]);
//			if(elements.length != 0)
//			console.log(last[0], last[0]._weight, last[0]._index);
//			console.log('--2--');

//			console.log(index);

			if(elements.length == 0) {
				el.appendChild( item_el );
//				el.append( item_el );
//				console.log('---1---');
			}
			else if(last._weight == weight &amp;&amp; last._pos &lt; pos){
				$ergo.dom.insertAfter(item_el, last);
//				last.after(item_el);
//				console.log('---2---');
			}
			else {

//				console.log('---3---', index, last[0]._index);

//				console.log(index, 'layout');

				var arr = [];
				var before_el = null;
				var after_el = null;
	//			this.container.children.each(function(it){
				for(var k = 0; k &lt; elements.length; k++) {
//				elements.each(function(k, child){
					var child = elements[k];

					// it = $(child).ergo();
					// if(!it || it == item) return; //    ,   
					// if(it._weight == weight) arr.push(it);//.el);
					// else if(it._weight &lt;= weight) before_el = it.el;
					// else if(!after_el ) after_el = it.el;

					if(child._weight == weight) arr.push( child );//.el);
					else if(child._weight &lt;= weight) before_el = child;

					else if(!after_el ) after_el = child;
				}//);




				// for(var i = 0; i &lt; arr.length; i++) {
				// 	if( arr[i]._index >= index  ) {
				// 		if(!after_el) after_el = arr[i].el;
				// 	}
				// 	else {
				// 		before_el = arr[i].el;
				// 	}
				// }


				for(var i = 0; i &lt; arr.length; i++) {
					if( arr[i]._pos >= pos  ) {
						if(!after_el) after_el = arr[i];
					}
					else {
						before_el = arr[i];
					}
				}



				if(before_el) {
					$ergo.dom.insertAfter( item_el, before_el );
				}
//					before_el.after( item_el );
				else if(after_el)
					$ergo.dom.insertBefore( item_el, after_el );
//					after_el.before( item_el );
				else if(elements.length)
					$ergo.dom.insertAfter( item_el, last );
//					last.after( item_el );
				else {
					el.appendChild( item_el );
//					el.append( item_el ); //FIXME    
				}



				// }
				// else {
					// arr[index].before(item_el);
				// }
			}



		}
		// else if(index == 0)
			// el.prepend( item.el );
		// else if($.isNumber(index))
			// el.children().eq(index-1).before(item.el);
		// else
			// index.el.before(item.el);

		// VDOM?

		item_el._pos = pos;

		item_el._weight = weight;

		item_el._group = group;


		var sibling = item_el.nextSibling;
		while(sibling &amp;&amp; sibling._weight === item_el._weight) {
			sibling._pos++;
			sibling = sibling.nextSibling;
		}



		item._rendered = true;

		this._widget.events.fire('item#rendered', {item: item});

		// deprecated
//		if('itemCls' in this.options) item.el.addClass(this.options.itemCls);
//		if('itemStyle' in this.options) item.el.css(this.options.itemStyle);
	},
*/

	_groupElements: function(group) {

		var beforeEl = null;
		var afterEl = null;

		var elements = this.innerEl.childNodes;


		for(var i = 0; i &lt; group.length; i++) {
			var g = group[i];
			var groupElements = [];

//				var lastEl = elements[elements.length-1];

			for(var j = 0; j &lt; elements.length; j++) {
				var siblingEl = elements[j];
				var siblingGroup = siblingEl._group[i];
				//    (+)
				if(siblingGroup[0] == g[0] &amp;&amp; siblingGroup[1] == g[1]) {
					groupElements.push(elements[j]);
				}
				//   (+)
				else if(siblingGroup[0] &lt; g[0] || siblingGroup[1] &lt; g[1]) {
					beforeEl = siblingEl;
				}
				//   (+)
				else if(siblingGroup[0] > g[0] &amp;&amp; siblingGroup[1] > g[1]) {
					afterEl = siblingEl;
				}
			}

			elements = groupElements;
		}

		return elements;
	},



	at: function(pos, weight, group) {

		var w = weight || 0;

		var elements = this.innerEl.childNodes;

		if(group) {
			elements = this._groupElements(group);
		}

		for(var i = 0; i &lt; elements.length; i++) {
			if( elements[i]._pos == pos &amp;&amp; elements[i]._weight == w ) {
				return elements[i];
			}
		}

		return null;
	},



	addBefore: function(item, otherItem, w, group) {

		var o = this.options;

		var itemEl = item.vdom.outerEl;

		var pos = 0;
		var weight = w || 0;


		//  ,    -
		var targetEl = (o.selector) ? o.selector.call(this, item) : this.select(item);

		//   (  )  -
		var itemEl = (o.wrapper) ? o.wrapper.call(this, item) : this.wrap(item);



		if(item.options.wrapper) {

			if(itemEl == item.__vdom.el) {
				itemEl = document.createElement('div');
				itemEl.appendChild(item.__vdom.el);
//				item_el = $('&lt;div/>').append(item.dom.el);
			}

			item._wrapper = $.ergo( Ergo.deep_override({etype: 'widgets:widget', tag: itemEl, autoRender: false}, item.options.wrapper) );
			item._wrapper._weight = weight;

		}


		if(itemEl != item.__vdom.el) {
			item.__vdom.outerEl = itemEl;
		}

		//  
		if(item._key &amp;&amp; item.options.autoClass) {
			$ergo.dom.addClass(item_el, item._key);
		}




		var elements = targetEl.childNodes;


		if(!otherItem &amp;&amp; group) {

			elements = this._groupElements(group);

		}

		var lastEl = elements[elements.length-1];
		var firstEl = elements[0];



		//    
		if(otherItem) {

			var otherEl = otherItem.vdom.outerEl;

			$ergo.dom.insertBefore(itemEl, otherEl);

			pos = otherEl._pos;

			//        
			var _el = itemEl.nextSibling;
			while(_el &amp;&amp; _el._weight == weight) {
				_el._pos++;
				_el = _el.nextSibling;
			}

		}
		//    DOM  
		else if(elements.length == 0) {
			targetEl.appendChild(itemEl);
		}
		//      
		else if(firstEl._weight > weight) {
			$ergo.dom.insertBefore(itemEl, firstEl);
		}
		//     
		else {
			//          
			var beforeEl = null;
			var afterEl = null;
			for(var i = 0; i &lt; elements.length; i++) {
				var _el = elements[i];
				if(_el._weight != null &amp;&amp; _el._weight &lt; weight) {
					beforeEl = _el;
				}
				else {
					afterEl = _el;
					break;
				}
			}

			if(beforeEl) {
				$ergo.dom.insertAfter(itemEl, beforeEl);
				pos = beforeEl._pos;
			}
			else if(afterEl) {
				$ergo.dom.insertBefore(itemEl, afterEl);
			}


		}


		itemEl._pos = pos;
		itemEl._weight = weight;
		itemEl._group = group;

		item._rendered = true;

		this._widget.events.fire('item#rendered', {item: item});


	},




	addAfter: function(item, otherItem, w, group) {

		var o = this.options;

		var itemEl = item.vdom.outerEl;

		var pos = 0;
		var weight = w || 0;


		//  ,    -
		var targetEl = (o.selector) ? o.selector.call(this, item) : this.select(item);

		//   (  )  -
		var itemEl = (o.wrapper) ? o.wrapper.call(this, item) : this.wrap(item);



		if(item.options.wrapper) {

			if(itemEl == item.__vdom.el) {
				itemEl = document.createElement('div');
				itemEl.appendChild(item.__vdom.el);
//				item_el = $('&lt;div/>').append(item.dom.el);
			}

			item._wrapper = $.ergo( Ergo.deep_override({etype: 'widgets:widget', tag: itemEl, autoRender: false}, item.options.wrapper) );
			item._wrapper._weight = weight;

		}


		if(itemEl != item.__vdom.el) {
			item.__vdom.outerEl = itemEl;
		}

		// FIXME
		if(otherItem &amp;&amp; otherItem.__vdom.targetKey != item.__vdom.targetKey) {
			otherItem = null;
		}

		//  
		if(item._key &amp;&amp; item.options.autoClass) {
			$ergo.dom.addClass(item_el, item._key);
		}




		var elements = targetEl.childNodes;


		if(!otherItem &amp;&amp; group) {

			elements = this._groupElements(group);

		}

		var lastEl = elements[elements.length-1];



		//  
		if(otherItem &amp;&amp; otherItem.vdom.outerEl == lastEl) {
//			console.log('element insert after (fast)');
			targetEl.appendChild(itemEl);
			pos = lastEl._pos+1;
		}
		//    
		else if(otherItem) {
//			console.log('element insert after');

			var otherEl = otherItem.vdom.outerEl;

			$ergo.dom.insertAfter(itemEl, otherEl);

			pos = otherEl._pos+1;

			//        
			var _el = itemEl.nextSibling;
			while(_el &amp;&amp; _el._weight == weight) {
				_el._pos++;
				_el = _el.nextSibling;
			}

		}
		//    DOM  
		else if(elements.length == 0) {
			targetEl.appendChild(itemEl);
		}
		//      
		else if(lastEl._weight &lt;= weight) {
			targetEl.appendChild(itemEl);
			pos = lastEl._pos+1;
		}
		//     
		else {
//			console.log('element lookup');

			//          
			var beforeEl = null;
			var afterEl = null;
			for(var i = 0; i &lt; elements.length; i++) {
				var _el = elements[i];
				if( (_el._weight || 0) &lt;= weight) {
					beforeEl = _el;
				}
				else {
					afterEl = _el;
					break;
				}
			}

			if(beforeEl) {
				$ergo.dom.insertAfter(itemEl, beforeEl);
				pos = beforeEl._pos;
			}
			else if(afterEl) {
				$ergo.dom.insertBefore(itemEl, afterEl);
			}


		}


		itemEl._pos = pos;
		itemEl._weight = weight;
		itemEl._group = group;

		item._rendered = true;

		this._widget.events.fire('item#rendered', {item: item});
	},





	/**
	 *  -  
	 * @param {Object} item
	 */
	remove: function(item) {

		var item_el = item.vdom.outerEl;// (item._wrapper_el || item.dom.el);


		var sibling = item_el.nextSibling;
		while(sibling &amp;&amp; sibling._weight === item_el._weight) {
			sibling._pos--;
			sibling = sibling.nextSibling;
		}


		if(item._wrapper_el) {
			item._wrapper_el.remove(); //?

			if(item._wrapper)
				item._wrapper._destroy();
		}
		else {
			item.vdom.detach(); //TODO  :   DOM-  
		}

		item._rendered = false;

		if('itemCls' in this.options) item.vdom.el.removeClass(this.options.itemCls);

		this._widget.events.fire('item#unrendered', {item: item});

	},


	/**
	 *      (    )
	 */
	clear: function() {
		$ergo.dom.clear(this.el);
//		this.el.empty(); //WARN      DOM- 
	},


	/**
	 *   (,  )
	 */
	update: function() {


		// AUTO WIDTH
		if(this._widget.options.autoWidth){

			var _el = this._widget.el;

			//     -    
			if(!_el.not(':hidden')) return;


			//  
			var dw = 0;
			if(_el.is(':button')) dw = _el.outerWidth(true) - _el.outerWidth();
			else dw = _el.outerWidth(true) - _el.width();
			//  
//			_el.hide();
			_el.addClass('hidden');

			//  ,    
			var w = 0;
			_el.parents().each(function(i, el){
				if(!w) w = $(el).width();
				if(w) return false;
			});

			if(_el.attr('autowidth') != 'ignore-siblings') {
				//        
				_el.siblings().not(':hidden').each(function(i, sibling){
					var sibling = $(sibling);
					if(sibling.attr('autoWidth') != 'ignore')
						w -= sibling.outerWidth(true);
				});
			}

			//    (  ),    
			if(w - dw)
				_el.width(w - dw);

			//  
//			_el.show();

			_el.removeClass('hidden');
		}

		// AUTO HEIGHT
		if(this._widget.options.autoHeight) {//} &amp;&amp;  this.container.options.autoHeight != 'ignore'){

			var _el = $(this.el);


			if(!_el.is(":visible")) return;
			if(_el.attr('autoHeight') == 'ignore') return;


			if(_el.attr('autoHeight') == 'fit') {

				var h0 = _el.height();
				var dh = _el.outerHeight() - _el.height();

				_el.hide();

				var h = this._widget.options.height || 0;
				_el.parents().each(function(i, el){
					if(!h) h = $(el).height();
					if(h) return false;
				});

				h = Math.floor(h - dh);

				if(h > h0)
					_el.height(h);

				_el.show();

				return;
			}


			var debug = (this._widget.debug == 'autoheight');

			_el.height(0);


//			this.el.hide();

			var dh = 0;
			var h = 0;
			_el.parents().each(function(i, el){
				el = $(el);
				var w = el.ergo();
				if((w &amp;&amp; w.options.height) || el.attr('autoHeight') == 'true' || el.attr('autoHeight') == 'stop' || el.is('body')){
					h = el.height();
//					h = el[0].scrollHeight;
					return false;
				}
				else {
//					if(dh == 0) dh = el.height();
					if(el.attr('autoheight') != 'ignore-siblings') {
						dh += (el.outerHeight(true) - el.height());
						el.siblings().not('td, :hidden').each(function(i, sibling){
							sibling = $(sibling);
							if(sibling.attr('autoHeight') != 'ignore')
								dh += sibling.outerHeight(true);
						});
					}
				}
			});


//			if(Ergo.context.debug) console.log({h: h, dh: dh});

			dh += (_el.outerHeight(true) - _el.height());

//			if(Ergo.context.debug) console.log({h: h, dh: dh});


			var self = this;

			//    
			var h_ratio = 1;
			_el.siblings().not('td').each(function(i, sibling){
				sibling = $(sibling);
				var ah = sibling.attr('autoHeight');
				//  
				if(!ah) {
					if(sibling.is(':visible'))
						dh += sibling.outerHeight(true);
				}
				else if(ah != 'ignore-siblings' &amp;&amp; ah != 'ignore') {
					h_ratio++;
					dh += sibling.outerHeight(true) - sibling.height();
				}
			});



			// var h_ratio = 1;
//
			// if(this.container.parent) {
//
			// this.container.parent.children.each(function(sibling){
				// if(sibling == self.container) return;
				// var ah = sibling.options.autoHeight;
				// if(!ah) {
					// dh += sibling.el.outerHeight(true);
				// }
				// else if(ah != 'ignore-siblings') {
					// h_ratio++;
					// dh += sibling.el.outerHeight(true) - sibling.el.height();
				// }
			// });
//
			// }



			// if(this.el.attr('autoheight') != 'ignore-siblings') {
				// this.el.siblings().not('td, :hidden').each(function(i, sibling){
					// sibling = $(sibling);
					// if(sibling.attr('autoHeight') != 'ignore') {
						// dh += sibling.outerHeight(true);
						// if(debug)	console.log({type: 'sibling', el: sibling, h: sibling.outerHeight(true)});
					// }
				// });
			// }




			if(Ergo.context.debug) console.log({h: h, dh: dh, k: h_ratio});

//			this.el.height((h - dh)/h_ratio);

			if( this.options.autoHeightType == 'min' ) {

				_el.height('');

				_el.css('min-height', (h - dh)/h_ratio);
			}
			else if( this.options.autoHeightType == 'max' ) {

				_el.height('');

				_el.css('max-height', (h - dh)/h_ratio);
			}
			else {
				_el.height((h - dh)/h_ratio);
			}

//			this.el.show();

		}

		// AUTO FIT
		if(this._widget.options.autoFit === true){

			var _el = $(this.el);

			var dw = _el.outerWidth() - _el.width();
			var dh = _el.outerHeight() - _el.height();

			_el.hide();

			var h = this._widget.options.height || 0;
			var w = this._widget.options.width || 0;
			_el.parents().each(function(i, el){
				if(!h) h = $(el).height();
				if(!w) w = $(el).width();
				if(w &amp;&amp; h) return false;
			});

			_el.siblings().not(':hidden').each(function(i, el){
				w -= $(el).outerWidth(true);
			});

			_el.width(w - dw);
			_el.height(Math.floor(h - dh));

			_el.show();
		}

	},

	/**
	 *   (,  )
	 */
	_rebuild: function(updated) {

		console.log('REBUILD LAYOUT', updated);

		// if(updated) {
		// 	for(var i = 0; i &lt; updated.length; i++) {
		// 		var item = updated[i];
		// 		item.unrender();
		// 		item.render();
		// 	}
		// }

	},



	build: function() {

//		var render_list = [];

		// this._widget.children.each(function(item){
//
//
//
		// });


	}



});//, 'layouts:default');


Ergo.alias('layouts:default', Ergo.core.Layout);


// Ergo.$layout = function(o, etype) {
	// return Ergo.object(o, 'layout:'+etype);
// };




/**
 *     
 * @namespace
 */
Ergo.layouts = {};


//Ergo.$layouts = Ergo.object;

Ergo.$layouts = function(o, etype) {

	var clazz = Ergo._aliases['layouts:'+etype];

	if(!clazz/*!Ergo.alias(etype)*/) {

		// var i = etype.indexOf(':');
		// if(i > 0) {
		// 	etype = etype.substr(i+1);
		// }

		o.unshift({name: etype});

		etype = 'default';
	}

	return Ergo.object('layouts', o, etype);
};



/**
 *   
 *
 * :
 * 	`text`   
 * 	`innerText`   
 * 	`innerHtml` html- 
 * 	`opacity`  0..1
 * 	`width` 
 * 	`height` 
 * 	`autoWidth` - {@link Ergo.core.Layout}
 * 	`autoHeight` - {@link Ergo.core.Layout}
 * 	`autoBind` - 
 * 	`autoUpdate` - 
 * 	`tooltip`  
 * 	`id` HTML id (  )
 * 	`name`   (  )
 * 	`tabindex` HTML tabindex
 * 	`format`   
 * 	`store`       
 * 	`hidden`  
 *
 *
 * @mixin
 */
Ergo.WidgetOptions = {


	get text() {
		if(this.$content) {
			return this.$content.opt('text');
		}
		else {
			return this.vdom.innerEl.textContent;
		}

		// if(!this.__c)
		// 	return this.__l.el.textContent;
		// // else if(this.children.size() == 0)
		// // 	return this.layout.el.textContent;
		// else if(this.$content)
		// 	return this.$content.opt('text');
		// else
 	// 		return this.__l.containerEl.textContent;
	},
//	getText: function() {	return this.layout.el.text();	},
	// get width() {	return this.el.outerWidth();	},
	// get height() { return this.el.outerHeight();	},
	get name() {
		return this._name || this._key || this._index;
	},



	set text(v) {
		if(this.$content) {
			this.$content.opt('text', v == null ? '': v);
		}
		else {
			this.vdom.innerEl.textContent = ( v == null ? '': v );
		}

		this.__txt = v;

// 		if(!this.__c)
// 			this.dom.el.textContent = ( v == null ? '': v );
// 		else if(this.children.size() == 0)
// //			this.layout.el.text( v == null ? '': v );
// 			this.layout.el.textContent = ( v == null ? '': v );
// 		else if(this.$content)
// 			this.$content.opt('text', v == null ? '': v);
// 		else
// //			this.layout.el.text( v == null ? '': v );
//  			this.layout.el.textContent = ( v == null ? '': v );

	},
	// set_innerText: function(v) {	this.layout.el.text(v); },
//	set innerHtml(v) {	this.vdom.innerEl.innerHTML = (v || ''); },
	// set_opacity: function(v) {
	// 	if($.support.opacity)
	// 		this.el.css('opacity', v);
	// 	else {
	// 		this.el.css('filter', 'Alpha(opacity:' + (v*100.0) + ')');
	// 		this.el.css('-ms-filter', 'progid:DXImageTransform.Microsoft.Alpha(Opacity=' + (v*100.0).toFixed() + ')');
	// 	}
	// },
	// set width(v) { this.el.outerWidth(v); },
	// set height(v) { this.el.outerHeight(v); },



// 	set autoWidth(v) {
// 		v ? this.vdom.el.setAttribute('autoWidth', v) : this.vdom.el.removeAttribute('autoWidth');
// 	},
// 	set autoHeight(v) {
// 		if(v) {
// 			this.vdom.el.setAttribute('autoHeight', v);
// 			if(v === true || v == 'ignore-siblings')
// 				this.vdom.setStyle('overflow-y', 'auto');//.el.style['overflow-y'] = 'auto';//('overflow-y', 'auto');
// 		}
// 		else {
// 			this.vdom.el.removeAttribute('autoHeight');
// 			this.vdom.setStyle('overflow-y', '');
// //			this.el.css('overflow-y', '');
// //			this.el.style['overflow-y'] = '';
// 		}
// 	},




	set name(v) { this._name = v; },


// 	set format(v) {
// 		if($.isString(v)) this.options.format = Ergo.format_obj.curry(v);
// 	},
// 	set unformat(v) {
// 		if($.isString(v)) this.options.unformat = Ergo.unformat_obj.curry(v);
// 	},

	//FIXME  
	set hidden(v) {
		this.vdom.outerEl.style.display = (v ? 'none' : '');//.css('display', v ? 'none' : '');
//		this.el.css('display', v ? 'none' : '');
	},




	//TODO placeholder?



};





Ergo.WidgetAttributes = {
	attributes: ['id', 'tabindex']
};




Ergo.WidgetProps = {

  props: {

    get: {
      // text: function() {
    	// 	if(this.$content) {
    	// 		return this.$content.opt('text');
    	// 	}
    	// 	else {
    	// 		return this.vdom.innerEl.textContent;
    	// 	}
    	// },

    },

    set: {
      innerHtml: function(v) {
        this.vdom.innerEl.innerHTML = (v || '');
      },

      autoWidth: function(v) {
    		v ? this.vdom.el.setAttribute('autoWidth', v) : this.vdom.el.removeAttribute('autoWidth');
    	},

    	autoHeight: function(v) {
    		if(v) {
    			this.vdom.el.setAttribute('autoHeight', v);
    			if(v === true || v == 'ignore-siblings')
    				this.vdom.setStyle('overflow-y', 'auto');//.el.style['overflow-y'] = 'auto';//('overflow-y', 'auto');
    		}
    		else {
    			this.vdom.el.removeAttribute('autoHeight');
    			this.vdom.setStyle('overflow-y', '');
    //			this.el.css('overflow-y', '');
    //			this.el.style['overflow-y'] = '';
    		}
    	},


      format: function(v) {
    		if($.isString(v)) this.options.format = Ergo.format_obj.curry(v);
    	},

    	unformat: function(v) {
    		if($.isString(v)) this.options.unformat = Ergo.unformat_obj.curry(v);
    	},

    	hidden: function(v) {
    		this.vdom.outerEl.style.display = (v ? 'none' : '');//.css('display', v ? 'none' : '');
    //		this.el.css('display', v ? 'none' : '');
    	},



      // 

      id: function(v) {
    		this.vdom.el.setAttribute('id', v);
    	},

    	tabindex: function(v) {
    		this.vdom.el.setAttribute('tabindex', v);
    	},

    	tooltip: function(v) {
    		this.vdom.el.setAttribute('title', v);
    	}



    }

  }
  
};





/**
 *   /
 *
 *      javascript- Object
 *
 * @class
 * @extends Ergo.core.Object
 *
 */
Ergo.core.Collection = function(src) {

	var a = new Array(arguments.length);
	for(var i = 0; i &lt; arguments.length; i++)
		a[i] = arguments[i];

	this._initialize.apply(this, a);
}

 Ergo.override(Ergo.core.Collection.prototype, {
// Ergo.core.Collection = Ergo.declare('Ergo.core.Collection', 'Ergo.core.Object', /** @lends Ergo.core.Collection.prototype */{
//
// 	defaults: {
// //		plugins: [Ergo.Observable]
// 	},
//
	_initialize: function(src) {
//		this._super(options);
//		Ergo.core.Collection.superclass._initialize.call(this, options);

//		this.options = options;
//		this.events = new Ergo.events.Observer(this);

		this.src = src || {};
	},


	create: function(v) {
		return new Ergo.core.Collection(v);
	},


	/**
	 *  
	 * @param {Object} i 
	 * @param {Object} item 
	 */
	set: function(i, item) {
		if(arguments.length == 1) {
			item = i;
			var old = this.src;
			this.src = item;
//			this.events.fire('value:changed', {'value': item, 'oldValue': old});
		}
		else {
			var old = this.src[i];
			this.src[i] = item;
//			this.events.fire('item:changed', {'item': item, 'index': i, 'oldItem': old});
		}
	},

	/**
	 *    
	 * @param {Object} i 
	 */
	unset: function(i) {
		this.remove_at(i);
	},

	/**
	 *    
	 * @param {Object} i
	 */
	get: function(i) {
		return this.src[i];
	},

	/**
	 *   
	 * @param {Object} item 
	 * @param {Object} [i] 
	 *
	 *     set
	 */
	// add: function(item, i) {
		// this.src[i] = item;
// //		this.events.fire('item:add', {'item': item});
	// },



	/**
	 *    
	 * @param {Object} i 
	 */
	remove_at: function(i) {
		var item = this.src[i];
		delete this.src[i];
		return item;

//		this.events.fire('item:removed', {'item': item});
	},

	/**
	 *  
	 *
	 *     remove_at
	 *
	 * @param {Object} item 
	 */
	remove: function(item) {
		this.remove_at(this.key_of(item));
		return item;
	},

	/**
	 *    
	 *
	 *     remove_at
	 *
	 * @param {Object} criteria -
	 *
	 *  ,  ,  criteria  true
	 */
	remove_if: function(criteria) {
		var keys = Ergo.filter_keys(this.src, criteria);
		keys.sort(Ergo.sort_numbers).reverse();
		var removed = [];
		for(var i = 0; i &lt; keys.length; i++) removed.push( this.remove_at(keys[i]) );
		return removed;
	},


	remove_all: function() {
		for(i in this.src)
			this.remove_at(i);
	},


	/**
	 *     
	 */
	clear: function() {
		this.remove_all();
//		this.src = {};
	},

	/**
	 *    
	 * @param {Object} callback
	 */
	each: function(callback) {
		return Ergo.each(this.src, callback);
	},

//	ensure: function(i) {
//
//	},

	/**
	 *   ,  
	 */
	find: function(criteria) {
		return Ergo.find(this.src, criteria);
	},

	/**
	 *   ,  
	 */
	find_all: function(criteria) {
		return Ergo.filter(this.src, callback);
	},



	//
	//TODO  filter  map    ,   
	//

	/**
	 *  
	 */
	filter: function(callback) {
		return this.create( Ergo.filter(this.src, callback) );
	},

	/**
	 *  
	 */
	map: function(callback) {
		return this.create( Ergo.map(this.src, callback) );
	},

	/**
	 *     
	 * @param {Object} criteria
	 */
	includes: function(criteria) {
		return Ergo.includes(this.src, callback);
	},

	is_include: function(criteria) {
		return Ergo.includes(this.src, callback);
	},


	/**
	 *  
	 */
	size: function() {
		var n = 0;
		for(var i in this.src) n++;
		return n;
	},

	count: function() {
		return this.size();
	},

	/**
	 * ,    
	 */
	is_empty: function() {
		return this.size() == 0;
	},

	/**
	 *   
	 * @param {Object} item
	 */
	key_of: function(item) {
		return Ergo.key_of(this.src, item);
	},

	/**
	 *       
	 *
	 * @param {Object} m
	 * @param {Object} args
	 */
	apply_all: function(m, args, reverse) {
		Ergo.apply_all(this.src, m, args, reverse);
	},


	/**
	 *      
	 * @param {Object} i 
	 */
	has_key: function(i) {
		return (i in this.src);
	},

	/**
	 *     
	 */
	keys: function() {
		var k = [];
		for(var i in this.src) k.push(i);
		return k;
	}

});




/**
 *   
 *
 *      javascript- Array
 *
 * @class
 * @extends Ergo.core.Collection
 *
 */
Ergo.core.Array = Ergo.declare('Ergo.core.Array', 'Ergo.core.Collection', /** @lends Ergo.core.Array.prototype */{

	_initialize: function(src, options) {
//		this._super(src || [], options);
		Ergo.core.Array.superclass._initialize.call(this, src || []);//, options);
//		this.src = src || [];
//		Ergo.Observable.call(this);
//		this.events = new Ergo.events.Dispatcher();
	},


	create: function(v) {
		return new Ergo.core.Array(v);
	},


	/**
	 *   
	 * @param {Object} item
	 * @param {Object} i
	 */
	add: function(item, i) {
		if(i == null) {
			this.src.push(item);
			i = this.src.length-1;
		}
		else {
			if(i > this.src.length) {
				console.warn('Add item at index greater than array length may cause errors');
			}
			this.src.splice(i, 0, item);
		}

//		this.events.fire('item:added', {'item': item, 'index': i});
		return i;
	},


	/**
	 *    
	 * @param {Object} i
	 */
	remove_at: function(i) {
		var item = this.src[i];
		this.src.splice(i, 1);
		return item;
//		this.events.fire('item:removed', {'item': item});
	},


	remove_all: function() {
		while(this.src.length)
			this.remove_at(0);
	},

	size: function() {
		return this.src.length;
	},

	// clear: function() {
		// this.src = [];
	// },

	/**
	 *   
	 */
	first: function() {
		return this.src[0];
	},

	/**
	 *   
	 */
	last: function() {
		return this.src[this.src.length-1];
	},

	keys: function() {
		var k = [];
		for(var i = 0; i &lt; this.src.length-1; i++) k.push(i);
		return k;
	},

	sort: function(comparator) {
		this.src.sort(comparator);
	},

	copy: function() {
		return this.create(this.src.slice(0));
	}


});






/**
 *  
 *
 *
 * @class
 * @name Ergo.core.WidgetChildren
 * @extends Ergo.core.Array
 *
 *
 */
Ergo.declare('Ergo.core.WidgetChildren', 'Ergo.core.Array', /** @lends Ergo.core.WidgetChildren.prototype */{

// 	defaults: {
// //		plugins: [Ergo.Observable]
// //		include: 'observable'
// 	},


	_initialize: function(w) {
//		this._super(null, o);

//		Ergo.core.WidgetArray.superclass._initialize.call(this, null, o);

//		this.options = o || {};
		this.src = [];
//		this.events = new Ergo.events.Observer(this);

		this.autobinding = true;

		this._widget = w;
	},


	factory: function(o, type) {

		var default_opt = this.options.defaultOpt || 'text';
		if($.isString(o)) {
			var v = o;
			o = (this.options.shortcuts || {})[v];
			if(!o) {
				o = {};
				o[default_opt] = v;//{text: o};
			}
		}
		else if(Array.isArray(o)) o = {items: o};
		var default_child = 'default' + type[0].toUpperCase() + type.substr(1);
		default_child = this.options[default_child];

//		for(var i = 0; i &lt; default_child.length; i++) {
			if( $.isString(default_child) ) {
				default_child = {etype: default_child};
			}
//			default_child[i] = $ergo.copy(default_child[i]);
//		}

//		console.log(type, default_child, o, this.options);

		return $.ergo( [default_child, o] );//, null, this.scope );
//		return $.ergo( Ergo.smart_override({}, this.options[default_child], o) );
	},



	// get _source() {
	// 	return this.src;
	// },




	add: function(item, i, type) {

//		console.log('add item');

//		var key;
		var w = this._widget;

//		item = w.factory(item);

		//     
		if(type == undefined) {
			//     
			type = (i &amp;&amp; $.isString(i)) ? 'component' : 'item';
		}

//		type = type || 'item';

		//      
		if(!(item instanceof Ergo.core.Widget)) {
			item = (w.options[type+'Factory'] || this.factory).call(w, item, type);
		}
//		item = (w.options[type+'Factory'] || this.factory).call(w, item, type);

		item._type = type;

		//      ()     _key
		if(i &amp;&amp; (typeof i === 'string')) {
			item._key = i;
			i = undefined;
		}
		else {
			item._index = i;
		}

		//   parent
		item.parent = w;


		//     children
		if(i != null &amp;&amp; ('_index' in item)) {//item._index) {
			// FIXME    
			// if(this.src[this.src.length-1]._index &lt; item._index)
				// i =
			for(i = this.src.length-1; i >= 0; i--) {
				if(('_index' in this.src[i]) &amp;&amp; this.src[i]._index &lt; item._index) {
//					i--;
//					i++;
					break;
				}
			}

			i++;
		}
		else if(i == null &amp;&amp; ('_index' in item)) {
			// FIXME      
			item._index = 0;
			for(var j = this.src.length-1; j >= 0; j--) {
				if(this.src[j]._type == item._type) {
					item._index = this.src[j]._index + 1;
//					item.dom.el._index = item._index; //WARN      layout
					break;
				}
			}
		}

//		var i0 = i;


//		console.log('i', i);
		//    
//		i = this._super(item, i);
		i = Ergo.core.WidgetChildren.superclass.add.call(this, item, i);



//		console.log(i0 + ' > '+i);

		//   _index   
		for(var j = i+1; j &lt; this.src.length; j++) {
			if('_index' in this.src[j]) {
				this.src[j]._index++;
//				this.src[j].dom.el._index++; //WARN      layout
			}
		}





//			this.src[j]._index = j;

		//FIXME     show    
		// if(item.options.autoRender === true) {
			// if(item.options.showOnRender) item.show();
			// if(item.options.hideOnRender) item.hide();
		// }

		//      ()  accessor
		if(item._key) {
//			w[item._key] = item;
			w['$'+item._key] = item;
		}



		//       i (    undefined)
		// if(item.options.autoRender === true)
		// 	w.vdom.add(item, item._index);//i);


		//     ()
		if(w.data &amp;&amp; !item.data &amp;&amp; this.autobinding)
			item.bind(w.data, false, false);



//		console.log('item:add');
		//TODO         
		this._widget.events.fire('item#added', {'item': item});

		return item;
	},




	remove_at: function(i) {

//		var key;
		var w = this._widget;

		// //      accessor
		// if($.isString(i)) {
// //			key = i;
			// i = w[i]._index;
		// }


//		var item = this._super(i);
		var item = Ergo.core.WidgetChildren.superclass.remove_at.call(this, i);


//		if('hide' in item) item.hide();

		//   _index   
		for(var j = i; j &lt; this.src.length; j++) {
			if('_index' in this.src[j]) {
				this.src[j]._index--;
//				this.src[j].dom.el._index--;
			}
		}

//			this.src[j]._index = j;

		//  parent, _index  _key   
		delete item.parent;
		delete item._index;

		if(item._key) {
			delete w['$'+item._key];
//			delete w[item._key];
			delete item._key;
		}


		// if(item.options.hideOnDestroy) {
			// item.hide().then(function(){ w.layout.remove(item); });
		// }
		// else {
			//    
//		w.layout.remove(item); //FIXME
		// }


//		this.events.fire('item:remove', {'item': item});

		return item;
	},




	each: function(callback/* filter, sorter*/) {

		// var c = this._widget; //    ,  
		//
		// var values = this.src;
		//
		// var filter = filter || c.options.filter;
		// var sorter = sorter || c.options.sorter;
		//
		// if(filter || sorter) {
		//
		// 	var kv_a = [];
		//
		// 	// Filtering source and mapping it to KV-array
		// 	values.forEach(function(v, i) {
		// 		if(!filter || filter(v, i)) {
		// 			kv_a.push( [i, v] );
		// 		}
		// 	});
		//
		//
		// 	if(sorter) {
		// 		// Sorting KV-array
		// 		kv_a.sort( sorter );
		// 	}
		//
		//
		// 	for(var i = 0; i &lt; kv_a.length; i++) {
		// 		var kv = kv_a[i];
		// 		var prev = i ? kv_a[i-1][1] : undefined;
		// 		callback.call(c, kv[1], i, prev);//kv[0]);
		// 	}
		//
		// }
		// else {
			// Basic each
			this.src.forEach(callback);
//			Ergo.each(this.src, callback);

//		}

	},



	stream: function(filter, sorter, pager, callback) {

		var c = this._widget; //    ,  

		var filter = filter || c.options.filter;
		var sorter = sorter || c.options.sorter;
		var pager = pager || c.options.pager;

		if(filter || sorter || pager) {

			var kv_a = [];

			// Filtering source and mapping it to KV-array
			this.src.forEach(function(v, i) {
				if(!filter || filter(v, i)) {
					kv_a.push( [i, v] );
				}
			});


			if(sorter) {
				// Sorting KV-array
				kv_a.sort( sorter );
			}


			for(var i = 0; i &lt; kv_a.length; i++) {
				var kv = kv_a[i];
//				var prev = (i > 0) ? kv_a[i-1][1] : undefined;
				callback.call(c, kv[1], i);//kv[0]);
			}

			//TODO pager
		}
		else{
			this.src.forEach(callback.bind(c));
		}

	},







	remove_all: function() {

		var w = this._widget;

		for(var i = 0; i &lt; this.src.length; i++) {
			var item = this.src[i];

			delete item.parent;
			delete item._index;

			if(item._key) {
				delete w['$'+item._key];
				delete w[item._key];
				delete item._key;
			}

		}

		this.src.length = 0; // possible bugs
	},




	// _destroy_all: function() {
		// while(this.src.length)
			// this.remove_at(0)._destroy();
	// }

//	find: function(i) {
//		return Ergo.core.ItemCollection.superclass.find.call(this, Ergo.utils.widget_filter(i));
//	}

});








/**
 *   
 *
 *
 * @class
 * @name Ergo.core.WidgetComponents
 * @extends Ergo.core.Array
 *
 *
 */
Ergo.declare('Ergo.core.WidgetComponents', 'Ergo.core.Array', /** @lends Ergo.core.WidgetComponents.prototype */ {

// 	defaults: {
// //		plugins: [Ergo.Observable]
// //		include: 'observable'
// 	},

	_type: 'component',


	_initialize: function(w) {//}, o) {
//		this._super(null, o);

//		this.options = o;

		this.src = [];
//		this.events = new Ergo.events.Observer(this);

		this._widget = w;
	},


	get _source() {
		var result = {};
		var _type = this._type;
//		var o = this.options;
		this._widget.children.src.forEach(function(c) { if(c._type == _type) result[c._key] = c; });
		return result;
	},



	create: function(v) {
		return new Ergo.core.WidgetComponents(this._widget);
	},


	/**
	 *  
	 * @param {Object} i 
	 * @param {Object} item 
	 */
	set: function(i, item) {
		// if(i in this._widget)
		// 	this.remove_at(i);
		if( ('$'+i) in this._widget)
			this._widget['$'+i]._destroy();
//			this._widget.children.remove_at(i);
		return this._widget.children.add(item, i, this._type);
	},




	/**
	 *    
	 * @param {Object} i
	 */
	get: function(i) {
		return this._source[i];
	},

	/**
	 *   
	 * @param {Object} item 
	 * @param {Object} [i] 
	 *
	 *     set
	 */
	// add: function(item, i) {
		// this.src[i] = item;
// //		this.events.fire('item:add', {'item': item});
	// },



	/**
	 *    
	 * @param {Object} i 
	 */
	remove_at: function(i) {
//		return this._widget.children.remove_at(i);
		var removed = this._widget.children.remove_if(function(v) {	return v._key == i;	});

		return removed.length == 0 ? null : removed[0];
	},

	/**
	 *  
	 *
	 *     remove_at
	 *
	 * @param {Object} item 
	 */
	remove: function(item) {
		return this.remove_at(item._key);
	},

	/**
	 *    
	 *
	 *     remove_at
	 *
	 * @param {Object} criteria -
	 *
	 *  ,  ,  criteria  true
	 */
	remove_if: function(criteria) {
		var keys = Ergo.filter_keys(this._source, criteria);
		keys.sort(Ergo.sort_numbers).reverse();
		var removed = [];
		for(var i = 0; i &lt; keys.length; i++) removed.push( this.remove_at(keys[i]) );
		return removed;
	},


	remove_all: function() {
		var src = this._source;
		for(i in src)
			this.remove_at(i);
	},


	/**
	 *     
	 */
	clear: function() {
		this.remove_all();
	},

	/**
	 *    
	 * @param {Object} callback
	 * @param {Object} delegate
	 */
	// each: function(callback) {
	// 	return Ergo.each(this._source, callback);
	// },

	each: function(callback/*, filter, sorter*/) {

		// var c = this._widget; //    ,  
		//
		// var values = this._source;
		//
		// var filter = filter || c.options.filter;
		// var sorter = sorter || c.options.sorter;
		//
		// if(filter || sorter) {
		//
		// 	var kv_a = [];
		//
		// 	// Filtering source and mapping it to KV-array
		// 	values.forEach(function(v, i) {
		// 		if(!filter || filter(v, i)) {
		// 			kv_a.push( [i, v] );
		// 		}
		// 	});
		//
		//
		// 	if(sorter) {
		// 		// Sorting KV-array
		// 		kv_a.sort( sorter );
		// 	}
		//
		//
		// 	for(var i = 0; i &lt; kv_a.length; i++) {
		// 		var kv = kv_a[i];
		// 		var prev = (i > 0) ? kv_a[i-1][1] : undefined;
		// 		callback.call(c, kv[1], i, prev);//kv[0]);
		// 	}
		//
		// }
		// else {
			// Basic each
			this._source.forEach(callback);
//			Ergo.each(this.src, callback);

//		}

	},




	stream: function(filter, sorter, pager, callback) {

		var c = this._widget; //    ,  

		var filter = filter || c.options.filter;
		var sorter = sorter || c.options.sorter;
		var pager = pager || c.options.pager;


		if(filter || sorter || pager) {

			var kv_a = [];

			// Filtering source and mapping it to KV-array
			this._source.forEach(function(v, i) {
				if(!filter || filter(v, i)) {
					kv_a.push( [i, v] );
				}
			});


			if(sorter) {
				// Sorting KV-array
				kv_a.sort( sorter );
			}


			for(var i = 0; i &lt; kv_a.length; i++) {
				var kv = kv_a[i];
//				var prev = (i > 0) ? kv_a[i-1][1] : undefined;
				callback.call(c, kv[1], i);//kv[0]);
			}

			//TODO pager

		}
		else{
			this._source.forEach(callback.bind(c));
		}

	},




//	ensure: function(i) {
//
//	},

	/**
	 *   ,  
	 */
	find: function(criteria) {
		return Ergo.find(this._source, criteria);
	},

	/**
	 *   ,  
	 */
	find_all: function(criteria) {
		return Ergo.filter(this._source, callback);
	},



	//
	//TODO  filter  map    ,   
	//

	/**
	 *  
	 */
	filter: function(callback) {
		return this.create( Ergo.filter(this._source, callback) );
	},

	/**
	 *  
	 */
	map: function(callback) {
		return this.create( Ergo.map(this._source, callback) );
	},

	/**
	 *     
	 * @param {Object} criteria
	 */
	includes: function(criteria) {
		return Ergo.includes(this._source, callback);
	},

	/**
	 *  
	 */
	size: function() {
		var n = 0;
		var src = this._source;
		for(var i in src) n++;
		return n;
	},

	/**
	 * ,    
	 */
	is_empty: function() {
		return this.size() == 0;
	},

	/**
	 *   
	 * @param {Object} item
	 */
	key_of: function(item) {
		return Ergo.key_of(this._source, item);
	},

	/**
	 *       
	 *
	 * @param {Object} m
	 * @param {Object} args
	 */
	apply_all: function(m, args) {
		Ergo.apply_all(this._source, m, args);
	},


	/**
	 *      
	 * @param {Object} i 
	 */
	has_key: function(i) {
		return (i in this._source);
	},

	/**
	 *     
	 */
	keys: function() {
		var k = [];
		for(var i in this._source) k.push(i);
		return k;
	},


	add: function(item, i) {
		return this._widget.children.add(item, i, this._type);
	},


	first: function() {
		return this._source[0];
	},


	last: function() {
		return this._source[src.length-1];
	}


});




/**
 *   
 *
 *
 * @class
 * @name Ergo.core.WidgetItems
 * @extends Ergo.core.WidgetComponents
 *
 *
 */
Ergo.declare('Ergo.core.WidgetItems', 'Ergo.core.WidgetComponents', /** @lends Ergo.core.WidgetItems.prototype */ {

	_type: 'item',

	get _source() {
		var result = [];
		this._widget.children.src.forEach(function(c) { if(!('_key' in c)) result.push(c); });
		return result;
	},



	create: function(v) {
		return new Ergo.core.WidgetItems(this._widget);
	},


	last: function() {
		var src = this._source;
		return src[src.length-1];
	},

	size: function() {
		var src = this._source;
		return src.length;
	},

	remove_all: function() {
		var src = this._source;
		for(var i = 0; i &lt; src.length; i++)
			this.remove(src[i]);//_at(src[i]._index);
	},



	remove_at: function(i) {
		var removed = this._widget.children.remove_if(function(v) {	return v._index === i;	});

		return removed.length == 0 ? null : removed[0];
	},


	remove: function(item) {
		return this.remove_at(item._index);
	},



/*
	set: function(i, item) {
		this._widget.children.add(item, i, 'item');
	},

	add: function(item, i) {
		this._widget.children.add(item, i, 'item');
	}
*/

});




Ergo.WidgetData = {


  /**
	 *    
	 *
	 *   autoBind = false,     .
	 *
	 * @param {Object|Array|string} data  
	 */
	bind: function(data, update, pivot) {

		var o = this.options;
		var self = this;
		var w = this;

		var data_id = o.dataId;

		// if(data_id != null &amp;&amp; data_id[0] == '@') {
		// 	data = this._context.data( data_id.substr(1) );//[data_id];//[data_id.substr(1)];
		// 	data_id = undefined;
		// }

		//       ,    
		if(this.data == data || data === undefined || o.autoBind === false) return;

		//     :
		//         ,    
		if(this.data)
			this.data.events.off(this);


		// ,     
		if(pivot === undefined) pivot = true;
		this._pivot = pivot;



//		if(update !== false) update = true;

		//TODO custom data injector
		if( $.isString(data) ) {
			// var w = this;
			// while(!w._scope) {
			// 	w = w.parent;
			// }
			// if(w._scope) {
			// 	data = w._scope[data];
			// }
			// else {
			// 	throw new Error('Can not inject scope datasource into detached widget');
			// }
			var name_a = data.split(':');
			var src = this[name_a[0]];
			if(src == null) {
				throw new Error('Injecting data source ['+data+'] is undefined');
			}
			// if(src &amp;&amp; !src.data) {
			// 	throw new Error('Injecting data source ['+data+'] has no property \"data\"');
			// }
			// src = src.data;
			if(name_a[1]) {
				var prop_a = name_a[1].split('.');
				while(prop_a.length) {
					if(src == null) {
						throw new Error('Injecting data source property ['+data+'] does not exist');
					}
					src = src[prop_a.shift()];
				}
			}
			// var src = (name_a.length == 1) ? this : this[name_a[0]];
			// var prop_a = name_a[1].split('.');
			// while(prop_a.length) {
			// 	src = src[prop_a.shift()];
			// }
			data = src;// src[name_a[1]];
		}


		//    dataId,      ,   -    
		if(data_id) //'dataId' in o)
			this.__dta = (data instanceof Ergo.core.DataSource) ? data.entry(data_id) : new Ergo.core.DataSource(data, data_id);
		else
			this.__dta = (data instanceof Ergo.core.DataSource) ? data : new Ergo.core.DataSource(data);





		//     ( )
		if(o.dynamic) {

// 			//     ,    
// 			this.data.events.on('entry:added', function(e){
//
// //				console.log(e);
//
// 				self.children.autobinding = false;
// 				var item = self.items.add({}, e.isLast ? null : e.index);
// 				self.children.autobinding = true;
// 				item.bind(e.entry);
//
// 				item._dynamic = true;
//
// 				item.render();
// 			}, this);

// 			//    ,    
// 			this.data.events.on('entry:deleted', function(e){
// 				var item = self.item({data: e.entry});
// 				if(item)
// 					item._destroy();
// //				self.children.remove( self.item({data: e.entry}) )._destroy();//e.index) );// {data: self.data.item(e.index)});
// 			}, this);

// 			//    ,      
// 			this.data.events.on('entry:changed', function(e){
// 				//FIXME   
// 				var item = self.item({data: e.entry});
// 				if(!item) {
// 					self.children.autobinding = false;
// 					item = self.items.add({});
// 					self.children.autobinding = true;
//
// 					item.bind(e.entry);
// 					item._dynamic = true;
// 				}
//
// 				//FIXME _rebind ?
// //				item.bind(/*self.data.entry(e.entry.id)*/e.entry, false, false);
// 	//			self.getItem( e.item.id )._dataChanged(); //&lt;--      
// 			}, this);


			// this.data.events.on('entryDirty', function(e){
			// 	if( self.options.dynamicFilter )
			// 		self._rebind(false);
			// });



			//     ,    -    
			this.data.events.on('changed', function(e){

				//  diff  ,   
				if(e.created || e.updated || e.deleted) {
					self._rebind(true, e);
				}
				else {
					self._rebind(false);
					self._dataChanged(false, false);  //FIXME     _rebind
				}

			}, this);


			// this.data.events.on('value:sync', function(e){
			//
			// 	self._dataChanged();
			//
			// }, this);

			//    
			this.data.events.on('dirty', function(e){
				self._dataChanged(false, false); //     
			}, this);

			//       
			this.data.events.on('diff', function(e) {

				self._rebind( false, {created: e.created, updated: e.updated, deleted: e.deleted} );

			}, this);



			//        

//			this.layout.immediateRebuild = false;

			this.children.filter(function(c){ return c._dynamic; }).apply_all('_destroy');

			var filter = o.dynamicFilter ? o.dynamicFilter.bind(this) : undefined;
			var sorter = o.dynamicSorter ? o.dynamicSorter.bind(this) : undefined;
			var pager = o.dynamicPager ? o.dynamicPager.bind(this) : undefined;


			this.data.each(function(dataEntry, i){
//					self.items.add({}).bind(dataEntry, true, 2);
					self.children.autobinding = false;
					var item = self.items.add({});//{ 'data': dataEntry, 'autoUpdate': false });
					self.children.autobinding = false;

					item.bind(dataEntry, false, false);
//					item._pivot = false;
					item._dynamic = true;

//					item.el.attr('dynamic', true);
			}, filter, sorter, pager);

			// this.layout.immediateRebuild = true;
			// this.layout.rebuild();


			filter = o.renderFilter ? o.renderFilter.bind(this) : undefined;
			sorter = o.renderSorter ? o.renderSorter.bind(this) : undefined;
			pager = o.renderPager ? o.renderPager.bind(this) : undefined;

			var prev = undefined;
			this.items.stream(filter, sorter, pager, function(item, i) {

				item.render(null, null, prev); //FIXME     

				if(item._rendered) {
					prev = item;
				}

				// if(item._dynamic &amp;&amp; !item._rendered &amp;&amp; item.options.autoRender !== false) {
				// 	self.vdom.add(item, i);
				// }
			});

//			this._layoutChanged();

		}
		else {
			// STATIC BIND

			if(this._pivot || this.options.binding) {


				this.data.events.on('changed', function(e) {

					//     ,    "" 
					/*if(o.updateOnDataChanged)*/
					//self._dataChanged(true);
					self._rebind();
				}, this);

				this.data.events.on('dirty', function(e) {
					self._dataChanged(false, false); //     
				}, this);

			}




			// this.data.events.on('value:sync', function(e){
			//
			// 	self._dataChanged();
			//
			// }, this);


//			this.data.events.on('value:changed', this._rebind.bind(this), this);

			//        :
			//	1.      (     ),   
			// 	2.      (     )
			//	3. tve e  ,    
			if(this.__c) {

				this.children.each(function(child){
					if(!child._pivot &amp;&amp; child.data != self.data) child.bind(self.data, false, false);
				});
			}

		}

		//   (      )
		if(update !== false &amp;&amp; !this.data.fetch) this._dataChanged();


		if(this.data.fetch) {
			this.data.on('fetched', function() {
				this._layoutChanged();				
			}.bind(this), this);
		}

		//   data:
//		this._bindNsEvents('data');

		this._bindEvents('data');


//		if( this.data.options.fetchable ) {

		// this.data.events.on('fetched', function(){
		// 	// ?
		// 	w._layoutChanged();
		// }, this);

		//    autoFetch,       fetch()
		if(o.autoFetch)	this.data.fetch();//.then(function(){ self.events.fire('fetch'); });
//		}


//		this.events.fire('bound');
	},



	unbind: function() {
		//
		delete this._dta;
	},



	/**
	 *
	 * @protected
	 */
	_rebind: function(update, diff, initial) {

		var o = this.options;
		var self = this;


		if(!this.__dta) return;

		initial = initial || this;

//		console.log('rebind', this);

		// //    dataId,      ,   -    
		// if('dataId' in o)
			// data = (data instanceof Ergo.core.DataSource) ? data.entry(o.dataId) : new Ergo.core.DataSource(data, o.dataId);
		// else
			// data = (data instanceof Ergo.core.DataSource) ? data : new Ergo.core.DataSource(data);
//
		// //       ,    
		// if(data != this.data) {
			// this.bind(data, update, pivot);
			// return
		// }


		// console.log('rebind ('+self.options.dynamic+')');
		// console.log(''+self.options.html + ' ' + self.getValue());



		if(o.dynamic) {

//			console.log('rebind (dynamic)');

			// TODO

			if(diff) {
				this._dataDiff(diff.created, diff.deleted, diff.updated);

//				this._dataChanged(false, false);
			}
			else {

	//		console.log('rebind (dynamic)');

				//        
	//			this.layout.immediateRebuild = false;

				// //    
				this.children.filter(function(c){ return c._dynamic; }).apply_all('_destroy');

	//			var t0 = Ergo.timestamp();

				var filter = o.dynamicFilter ? o.dynamicFilter.bind(this) : undefined;
				var sorter = o.dynamicSorter ? o.dynamicSorter.bind(this) : undefined;
				var pager = o.dynamicPager ? o.dynamicPager.bind(this) : undefined;


				this.data.each(function(dataEntry, i){
	//					self.items.add({}).bind(dataEntry, true, 2);
					self.children.autobinding = false;
					var item = self.items.add({});//{ 'data': dataEntry });
					self.children.autobinding = false;

					item.bind(dataEntry, undefined, false);
//					item._pivot = false;
					item._dynamic = true;
	//					item.el.attr('dynamic', true);
	//					item.dataPhase = 2;
	//				item.render();
				}, filter, sorter, pager);

	//			var t1 = Ergo.timestamp();
	//			console.log(t1 - t0);

				// this.layout.immediateRebuild = true;
				// this.layout.rebuild();

	//			if(!Ergo.noDynamicRender)
//				this.render();


				// filter = o.renderFilter ? o.renderFilter.bind(this) : undefined;
				// sorter = o.renderSorter ? o.renderSorter.bind(this) : undefined;
				// pager = o.renderPager ? o.renderPager.bind(this) : undefined;
				//
				// this.items.each(function(item, i) {
				// 	if(item._dynamic &amp;&amp; !item._rendered) {
				// 		item.render();
				// 	}
				// }, filter, sorter, pager);

				this.render();

			}

			//   (      )
//			if(update !== false) this._dataChanged(true);

		}
		else {


//			console.log('rebind (static)', this._pivot);

			if(this.__c) {

				this.children.each(function(child){
	//				if(!child._pivot) child.rebind(false);
					// 1. rebind        dataSource
					// 2. rebind        dataSource
					//      ( ,  rebind   )

					//     
					//     ,     rebind
					//     
					if(!child._pivot &amp;&amp; !(initial.data == child.data &amp;&amp; child.options.dynamic) &amp;&amp; (child.data != self.data || update === false || !child.options.binding)) {
						child._rebind(false, undefined, initial);
					}
				});

			}

			//TODO ,    render()   

//			this._layoutChanged();

		}


		//   (      )
		//   
		if(update !== false)
			this._dataChanged(undefined, undefined, true);



	},




  /**
	 *   
	 *
	 *     (`options.binding`),      
	 *
 	 * @param {Boolean} lazy  true,      ,     
 	 * @param {Boolean} cascade   false,       
 	 * @param {Boolean} noDynamic   true,      ,   
 	 *
	 * @protected
	 */
	_dataChanged: function(lazy, cascade, no_dynamic) {

//		this.events.fire('refresh');//, e);

		//   ,    
//		if(cascade &amp;&amp; !this.options.cascading) return;

//		if(!this.options.autoBind /*|| this._lock_data_change*/) return;

		var binding = this.options.binding;

		if(binding &amp;&amp; (('__dta' in this) || ('__val' in this))){ //FIXME  

			if( typeof binding == 'string' ) {
//				this[binding] = this.value;
				this.prop(binding, this.value);
			}
			else {
				if( binding.call(this, this.value) === false) return false;
//				if( binding.call(this, this.value) === false) return false;
			}
//			var val = this.getValue();
//			this._lock_value_change = true;
//			delete this._lock_value_change;

			/**
			 *
			 *
			 */
			this.events.fire('dataChanged');//, e);
		}

		// var e = new Ergo.events.CancelEvent({value: this.getValue()});
		// if(e.isCanceled) return;


		if(cascade === false)
			return;

		var self = this;

//		if(cascade !== false) {
		this.children.each(function(child){

			if(no_dynamic &amp;&amp; child.options.dynamic) return;

			//    , :
			//  1.   
			//  2.       
			//  3.       
			if(lazy &amp;&amp; child.data &amp;&amp; child.data == self.data) return;
			if(child._pivot || child.options.autoBind === false) return; //FIXME     =>    
//			if(lazy &amp;&amp; child.options.dynamic) return;
			child._dataChanged(lazy, cascade, no_dynamic);
		});
//		}
//			this.children.apply_all('_dataChanged', [true]);

//		this.children.each(function(child) { child._dataChanged(); });

	},




	_dataDiff: function(created, deleted, updated) {

		var o = this.options;

		var filter = o.dynamicFilter ? o.dynamicFilter.bind(this) : null;
		var sorter = o.dynamicSorter ? o.dynamicSorter.bind(this) : null;
		var pager = o.dynamicPager ? o.dynamicPager.bind(this) : null;


		var rerender_a = [];
		var rerender_new_a = [];



//		console.log( 'Diff (create, delete, update)', created &amp;&amp; created.length, deleted &amp;&amp; deleted.length, updated &amp;&amp; updated.length );

//		console.log(created, deleted, updated);

		var self = this;



		if(deleted) {
//			this.items.each(function(item) { console.log('k', item._index); });
			// DELETED
			for(var i = 0; i &lt; deleted.length; i++) {
				var e = deleted[i];
				var item = this.item({data: e});
				if(item) {
					item._destroy();
				}
			}
//			this.items.each(function(item) { console.log('m', item._index); });
		}



		// this.items.each(function(item) {
		// 	var ok = false;
		// 	self.data.entries.each(function(entry) {
		// 		if( entry == item.data )
		// 			ok = true;
		// 	});
		// 	if(!ok)
		// 		console.warn('before create', item);
		// });



		if(created) {
			// CREATED
			for(var i = 0; i &lt; created.length; i++) {
				var e = created[i];
				var index = e._id[0];
				var value = e._val();


				if(!filter || filter(e._val(), index)) {

					var kv0 = [index, value];

//					console.log('kv', index, value);


					// var compare = function(item) {
					// 	if(sorter) {
					// 		var kv1 = [item.data._id[0], item.data._val()];
					// 		return sorter.call(e, kv0, kv1)
					// 	}
					// 	else {
					// 		return kv0[0] - item.data._id[0];
					// 	}
					// }
					//
					//
					//
					//
					//
					// var after = _qfind(this.items, compare);


					var after = this.items.find(function(item) {
						if(sorter) {
							return true;
							// var kv1 = [item.data._id[0], item.data._val()];
							// if( sorter.call(e, kv0, kv1) &lt;= 0 ) {
							// 	return true;
							// }
						}
						else {
							if( index &lt;= item.data._id[0] ) {
								return true;
							}
						}
					});

					if(sorter)
						index = null;
					else
						index = after ? after._index : null;

//					console.log('create', index);

					//   
					this.children.autobinding = false;
					var item = this.items.add({}, index);
					this.children.autobinding = true;
					item.bind(e, true, false);

					item._dynamic = true;

//					item.render();
					rerender_new_a.push(item);


				}
			}
		}



		// this.items.each(function(item) {
		// 	var ok = false;
		// 	self.data.entries.each(function(entry) {
		// 		if( entry == item.data )
		// 			ok = true;
		// 	});
		// 	if(!ok)
		// 		console.warn('before update', item);
		// });



		if(updated) {
			// UPDATED

			var n_upd = 0;

			for(var i = 0; i &lt; updated.length; i++) {


				var e = updated[i];
				var _item = this.item({data: e});
				var index = e._id[0];
				var value = e._val();



				if(filter) {
					if( !filter(value, index) ) {
						if( _item ) {
							_item._destroy();
							_item = null;
						}
						continue;
					}
				}

//				console.log('kv', index, value);


				var kv0 = [index, value];


				// var compare = function(item) {
				// 	if(sorter) {
				// 		var kv1 = [item.data._id[0], item.data._val()];
				// 		return (item == _item) ? 1 : sorter.call(e, kv0, kv1)
				// 	}
				// 	else {
				// 		return kv0[0] - item.data._id[0];
				// 	}
				// }
				//
				//
				// var after = _qfind(this.items, compare);



				var after = this.items.find(function(item) {
					if(sorter) {
						return true;
						// var kv1 = [item.data._id[0], item.data._val()];
						// // TODO       
						// if( item != _item &amp;&amp; sorter.call(e, kv0, kv1) &lt;= 0 ) {
						// 	return true;
						// }
					}
					else {
						if( item != _item &amp;&amp; index &lt;= item.data._id[0] ) {
							return true;
						}
					}
				});


				if(sorter)
					index = null;
				else
					index = after ? after._index : null;

//				console.log('update', index, !_item);

				if( !_item ) {

					this.children.autobinding = false;
					_item = this.items.add({}, index);
					this.children.autobinding = true;
					_item.bind(e, false, false);  //    

					_item._dynamic = true;

					rerender_new_a.push( _item );
					// if(!sorter) {
					// 	rerender_a.push( _item );
					// }
					// else {
//						_item.render();
//					}

				}
				else {

//					console.log('relocate', _item._index, ' => ', index, ' of ', this.items.size());

					if(!sorter) {
						// FIXME
						if(index != _item._index+1) {
							n_upd++;
//							_item.unrender()
							this.items.remove(_item);
							this.items.add(_item, index);
//							_item.render()

							rerender_a.push( _item );
						}
					}

				}





			}


//			console.log(' ', n_upd);
		}



		//
		// [id0, val0, index, item]
		//





		if( sorter ) {

//			var item_values = [];
//			var item_indices = [];

			var kv_a = [];
			this.items.each(function(item, i) {
				kv_a.push( [item.data._id[0], item.data._val(), i, item] );
//				item_values.push(item.data._val());//.timeState);
//				item_indices.push(item._index);//.timeState);
			});

			// Sorting KV-array
			kv_a.sort(sorter);


			$ergo.fixDisorder(kv_a, function(i, j) {

				var _item = this.items.get(i);

				//TODO      items.move()
				this.items.remove(_item);
				this.items.add(_item, j);

				rerender_a.push( _item );

			}.bind(this));


/*
			var offset_a = [];

//			var values = [];
//			var indices = [];

			kv_a.forEach(function(kv, i) {
				offset_a[kv[2]] = kv[2] - i;
//				indices.push(kv[2]);
//				values.push(kv[1]);//.timeState);
			});

//			console.log( 'indices', indices );
//			console.log( 'item_values', JSON.parse(JSON.stringify(item_values)) );
//			console.log( 'item_indices', JSON.parse(JSON.stringify(item_indices)) );
//			console.log( 'values', JSON.parse(JSON.stringify(values)) );
//			console.log( 'corrections', JSON.parse(JSON.stringify(corr_a)) );

			var n = 0;

			var measure_a = [];

			var moved_a = [];

			while( n &lt; kv_a.length+1 ) {



				var max_measure = [-1,-1];

				measure_a = [];

				for(var i = 0; i &lt; kv_a.length; i++) {
	//				var i_item = this.items.get(i);
					var i_index = i - offset_a[i];

					if( moved_a[i_index] )
						continue;

					var measure = [-1, -1, -1];


					for(var j = 0; j &lt; kv_a.length; j++) {
						var j_index = j - offset_a[j];

	//					var j_item = this.items.get(j);
						if( (j &lt; i &amp;&amp; j_index > i_index) || (j > i &amp;&amp; j_index &lt; i_index) ) {
							if(measure[0] == -1) {
								measure[1] = j;// Math.min(measure[1], j);
							}
							measure[2] = j;//Math.max(measure[2], j);
							measure[0]++;
						}
					}

					measure_a[i] = measure;

					if(measure[0] > max_measure[0]) {
						max_measure[0] = measure[0];
						max_measure[1] = measure[1];
						max_measure[2] = measure[2];
						max_measure[3] = i;
					}

				}

				if(max_measure[0] == -1)
					break;


				n++;



				// var k = 0;
				//
				// for(var i = 0; i &lt; measure_a.length; i++) {
				// 	if(max_measure[0] == measure_a[i][0])
				// 		k++;
				// }

//				console.log( 'max measure, count', max_measure, k);

				//  
				var _i = max_measure[3];
				var _j = (max_measure[2] > max_measure[3]) ? max_measure[2] : max_measure[1];

				var _item = this.items.get(_i);

//				console.log('index', _i, _j);

				//TODO      items.move()
//				_item.unrender()
				this.items.remove(_item);
				this.items.add(_item, _j);
//				_item.render()

				rerender_a.push( _item );


				moved_a[_i-offset_a[_i]] = true;


				var i_offset = offset_a[_i];

				if(_j &lt; _i) {
					for(var i = _i; i > _j; i--) {
						offset_a[i] = offset_a[i-1]+1;
					}
//					offset_a[_j] = offset_a[_j+1]
				}
				if(_j > _i) {
					for(var i = _i; i &lt; _j; i++) {
						offset_a[i] = offset_a[i+1]-1;
					}
//					offset_a[_j] = offset_a[_j-1]
				}

				offset_a[_j] = i_offset + (_j - _i);

			}
*/

//			console.log( '', n );

			// console.log( 'measures', measure_a );
			// console.log( 'offsets', offset_a );




		}


		this.events.fire('diff', {created: rerender_new_a, updated: rerender_a});


	}




	// is_bound: function() {
	// 	return (this.data != null);
	// },




};




Ergo.WidgetRender = {




	_bindVDOM: function() {

		var o = this.options;

		if(o.layout) {
			if(typeof o.layout === 'string') {
				var clazz = $ergo.alias(o.layout) || $ergo.alias('layouts:'+o.layout);
				if(!clazz) {
					throw new Error('Unknown layout ['+o.layout+']');
				}
				this.__vdom = new (clazz)(o.tag, this);
			}
			else if( o.layout.constructor === Object ) {
				var name = o.layout.etype || 'default';
				this.__vdom = new ($ergo.alias('layouts:'+name))(o.tag, this, o.layout);
//				this.__vdom = new Ergo.core.Layout(o.tag, this, o.layout);
			}
			else if( o.layout.constructor === Function ) {
				this.__vdom = o.layout.call(this, o.tag);
			}
			else {
				console.error('Can not create vdom for layout ['+o.layout+']');
			}
//		 this.__vdom = (o.layoutFactory || this.layoutFactory)(layout);
		}
		else {
		 this.__vdom = new Ergo.core.Layout(o.tag, this);
		}

//		this.__vdom.attach(this);//this.layout.options._widget || this);


		if( o.dynamic ) {
			this.events.on('diff', function(e) {
				//  
				this._rerender(false, {created: e.created, deleted: e.deleted, updated: e.updated});
			}.bind(this));
		}


		this._bindEvents('vdom');
	},





	render: function(target, cascade, beforeItem) {

//		console.log('render');

//    var el = this.el;

		//     non-empty  
		if( this.options.autoRender == 'non-empty' &amp;&amp; !this.__txt &amp;&amp; (!this.__c || this.__c.src.length == 0) ) {
			return;
		}


		//         
		if( this.__c) {

			var self = this;
			var o = this.options;
			var filter = o.renderFilter ? o.renderFilter.bind(this) : null;
			var sorter = o.renderSorter ? o.renderSorter.bind(this) : null;
			var pager = o.renderPager ? o.renderPager.bind(this) : null;


			//       DOM
			var prev = null;
			this.__c.stream(filter, sorter, pager, function(child, i) {

				// //    
				// if(item._dynamic &amp;&amp; item.data) {
				// 	return;
				// }

//				if(!item._rendered &amp;&amp; item.options.autoRender !== false &amp;&amp; !(item.options.autoRender == 'non-empty' &amp;&amp; item.children.src.length == 0 &amp;&amp; !item.options.text)) {  // options.text?
				if(!child._rendered) {
					child.render(null, false, prev);
				}

				if(child._rendered) {
					prev = child;
				}


					// if( self.__c.src.length == 1 &amp;&amp; item._type != 'item' ) {
					// 	item.el._weight = item._weight;
			    //   self.el.appendChild(item.el);
					// 	item._rendered = true;
					// }
					// else {
					// 	item._type == 'item' ? self.layout.add(item, item._index) : self.layout.add(item);
					// }
//				}

//				item.render(false);

	    });

			// this.__c.src.forEach(function(item) {
			// });
		}
		//   
		else {

		}



		if( this.parent &amp;&amp; target == null ) {//} &amp;&amp; (target == null || (this.options.autoRender == 'non-empty' &amp;&amp; (!this.__c || !this.__c.src.length == 0 || this.options.text))) ) {

			if(!this._rendered &amp;&amp; this.options.autoRender !== false) {
				// if( this.parent.__c.src.length == 1 &amp;&amp; this._type != 'item' ) {
				// 	this.dom.el._weight = this._weight;
				// 	this.parent.dom.el.appendChild(this.dom.el);
				// 	this._rendered = true;
				// }
				// else {

				if(beforeItem &amp;&amp; beforeItem.options.weight == this.options.weight) {
					this.parent.vdom.addAfter(this, beforeItem, this.options.weight);
				}
				else {
					this.parent.vdom.addAfter(this, undefined, this.options.weight);
				}

				// if(forcedIndex != null) {
				// 	this._type == 'item' ? this.parent.vdom.add(this, forcedIndex) : this.parent.vdom.add(this);
				// }
				// else {
				// 	this._type == 'item' ? this.parent.vdom.add(this, this._index) : this.parent.vdom.add(this);
				// }

//				}
			}

		}
		else if(target) {
			if( target.constructor === String ) {
				if(target[0] == '#') {
					target = document.getElementById(target.substr(1));
				}
				else if(target[0] == '.') {
					target = document.getElementsByClassName(target.substr(1))[0];
				}
				else {
					target = document.getElementsByTagName(target)[0];
				}
			}
			if(target) {
				target.appendChild(this.vdom.outerEl);
				this._rendered = true;
			}
		}


		//  
		if(cascade !== false) {
			this._layoutChanged();
		}


		if( this.options.showOnRender || this.options.renderEffects ) {
			this.show();
		}


  },





	unrender: function() {

		this._rendered = false;

		var callback = function() {
			if(this.parent) {
				this.parent.vdom.remove(this);
			}
			else {
				this.__vdom.detach();
			}
		};


		if( this.options.hideOnUnrender || this.options.renderEffects ) {
			this.hide().then(callback.bind(this));
		}
		else {
			callback.call(this);
		}

//		return $.when( /*(this.options.hideOnUnrender || this.options.renderEffects) ? this.hide() :*/ true )
//			.then(function() {
//			}.bind(this));
	},




  /**
	 *  () , ..    DOM-
	 *
	 *     ,      
	 * ,       
	 *
	 *      
	 *
	 *     _layoutChanged
	 *
	 */


/*
	render: function(target, cascade) {


		var self = this;


		if(target === true)
			this.options.autoRender = true; //?


		//    .children
		if( this.__c ) {

			for(var i = 0; i &lt; this.children.src.length; i++) {

				var item = this.children.src[i];

//			this.children.each(function(item){
				if(!item._rendered &amp;&amp; item.options.autoRender !== false &amp;&amp; !(item.options.autoRender == 'non-empty' &amp;&amp; item.children.src.length == 0 &amp;&amp; !item.options.text)) {

					if(this.children.src.length == 1 &amp;&amp; item._type != 'item') {
							//   ,      
						// if(item._type == 'item') {
						// 	item.el[0]._index = item._index;
						// 	self.el.append(item.el);
						// }
						// else {
							item.el[0]._weight = item._weight;
							self.el.append(item.el);
//						}

						item._rendered = true;
					}
					else {
						item._type == 'item' ? self.layout.add(item, item._index) : self.layout.add(item);
					}

				}

//			});
			}
			// this.children.each(function(item){
				// item._layoutChanged();
			// });


			for(var i = 0; i &lt; this.children.src.length; i++) {
				var item = this.children.src[i];
//			this.children.each(function(item){
				if( !(item.options.dynamic &amp;&amp; item.data) )  //FIXME
					item.render(false, false);
//			});
			}

		}


		if( (target !== false || (this.options.autoRender == 'non-empty' &amp;&amp; (!this.__c || !this.children.src.length == 0 || this.options.text))) &amp;&amp; this.parent) {

			if(!this._rendered &amp;&amp; this.options.autoRender !== false) {

//				console.log(this);

				if(this.parent.children.src.length == 1 &amp;&amp; this._type != 'item') {
						//   ,      
					// if(this._type == 'item') {
					// 	this.el[0]._index = this._index;
					// 	this.parent.el.append(this.el);
					// }
					// else {
						this.el[0]._weight = this._weight;
						this.parent.el.append(this.el);
//					}

					this._rendered = true;
				}
				else {
					this._type == 'item' ? this.parent.layout.add(this, this._index) : this.parent.layout.add(this);
				}



//				if(this.options.showOnRender) this.show();
//				if(this.options.hideOnRender) this.hide();
			}

		}
		else if(target) {
			$(target).append(this.el);
			this._rendered = true;
//			target.layout.add(this, this._index);
		}





		if(cascade !== false)
			this._layoutChanged();


		return $.when( (this.options.showOnRender || this.options.renderEffects) ? this.show() : true );
	},
*/


	/**
	 *    DOM-
	 *
	 */


/*
	unrender: function() {

		this._rendered = false;

		return $.when( (this.options.hideOnUnrender || this.options.renderEffects) ? this.hide() : true )
			.then(function() {
				if(this.parent &amp;&amp; this.parent.__l) {
					this.parent.layout.remove(this);
				}
				else {
					this.el.detach();
				}
			}.bind(this));

	},
*/



	/**
	 *  
	 *
	 *
	 *
	 * @protected
	 *
	 */
	_rerender: function(cascade, diff) {

		var w = this;
		var o = this.options;

		//  .children  ,   
		if(!this.__c) return;



		//  `non-empty`
		if( this._rendered ) {
			if( this.options.autoRender !== true &amp;&amp; (this.options.autoRender == 'non-empty' &amp;&amp; this.__c.src.length == 0 &amp;&amp; !this.__txt) ) {
				this.unrender();
//				w.layout.remove( this );
			}
		}
		else if( this.parent ) {
			if( this.options.autoRender !== false &amp;&amp; !(this.options.autoRender == 'non-empty' &amp;&amp; this.__c.src.length == 0 &amp;&amp; !this.__txt) ) {
				this.render();
//				this._type == 'item' ? this.parent.layout.add(this, this._index /*item._index*/) : this.parent.layout.add(this, undefined, this._weight);
			}
		}


		if(diff) {

			//  

			this._renderDiff(diff.created, diff.deleted, diff.updated);


		}
		else {

			var filter = o.renderFilter ? o.renderFilter.bind(this) : null;
			var sorter = o.renderSorter ? o.renderSorter.bind(this) : null;
			var pager = o.renderPager ? o.renderPager.bind(this) : null;

			//  

//			console.log('full rerender');

			//   DOM-  
			this.__c.each(function(child){
				if(child._rendered)
					child.unrender();
			});


			//   DOM- 
			var prev = undefined;
			this.__c.stream(filter, sorter, pager, function(child, i){

				if(!child._rendered &amp;&amp; child.options.autoRender !== false) {
					this.vdom.addAfter(child, prev, child.options.weight);
//					child._type == 'item' ? this.vdom.add(child, i) : this.vdom.add(child);
//					item.render();
				}

				if(child._rendered) {
					prev = child;
				}

				// if(!item._rendered &amp;&amp; item.options.autoRender !== false &amp;&amp; !(item.options.autoRender == 'non-empty' &amp;&amp; item.__c.src.length == 0 &amp;&amp; !item.options.text)) {
				//
				// 	item._type == 'item' ? w.layout.add(item, i /*item._index*/) : w.layout.add(item, undefined, i);
				//
				// }
			});

		}


		//  
		if(cascade !== false)
			this._layoutChanged();

	},





  /**
	 * ,     
	 *
	 * @protected
	 */
	_layoutChanged: function(cascade) {

//		if(this.options.autoHeight || this.options.autoWidth || this.options.autoFit) {
//			console.log(this.el);
		this.vdom.update();

		if(this.options.rendering) {
			this.options.rendering.call(this);
		}
//		}
		//FIXME       fire('layoutChanged')
//		if(this.layout.options.updateMode == 'auto') this.layout.update();

		if(cascade !== false &amp;&amp; this.__c &amp;&amp; !(this.data &amp;&amp; this.options.dynamic)) {
			this.__c.apply_all('_layoutChanged', cascade);
		}

//		this.events.fire('layoutChanged');
	},





	_renderDiff: function(created, deleted, updated) {

//		console.log('render diff', arguments);

		var o = this.options;

		var filter = o.renderFilter ? o.renderFilter.bind(this) : null;
		var sorter = o.renderSorter ? o.renderSorter.bind(this) : null;
		var pager = o.renderPager ? o.renderPager.bind(this) : null;

		var self = this;

		var vdom = this.vdom;




		if(created) {
			for(var i = 0; i &lt; created.length; i++) {
				var item = created[i];
				var index = item._index;

				if(filter) {
					if( !filter(item, item._index) ) {
						//     ,       vdom
						continue;
					}

				}


				item.render();  //FIXME  ?

//				console.log('create', item.text, item._index, item.vdom.outerEl._pos);

			}
		}




		var kv_a = [];
//		var prev = undefined;
		this.items.each(function(item, i) {
			//     
			if(item._rendered &amp;&amp; (!filter || filter(item, item._index))) {
				kv_a.push( [item._index, item, item.vdom.el._pos, item.vdom] );
//				prev = item;
			}
		});


		if(sorter) {
			// Sorting KV-array
			kv_a.sort(sorter);
		}


		// console.log('disorder', kv_a);
		// var texts = [];
		// for(var i = 0; i &lt; this.vdom.innerEl.childNodes.length; i++) {
		// 	texts.push(this.vdom.innerEl.childNodes[i].textContent);
		// }
		// console.log('text', texts);


		$ergo.fixDisorder(kv_a, function(i, j, kv_i, kv_j) {

			var item_i = this.vdom.at(i)._vdom._widget;
			var item_j = this.vdom.at(j)._vdom._widget;

//			var _item = this.items.get(i);

//			console.log('move', i, j, item_i, item_j);//kv_i[1].text, kv_j[1].text, i, j, kv_i[1].vdom.outerEl._pos, kv_j[1].vdom.outerEl._pos);

			//TODO      items.move()
			vdom.remove(item_i);
//			vdom.add(_item, j);
			if(i &lt; j) {
				vdom.addAfter(item_i, item_j, item_i.options.weight);
			}
			else {
				vdom.addBefore(item_i, item_j, item_i.options.weight);
			}

		}.bind(this));





/*
		if(deleted) {

		}



		if(created) {
			for(var i = 0; i &lt; created.length; i++) {
				var item = created[i];
				var index = item._index;

				if(filter) {
					if( !filter(item, item._index) ) {
						//     ,       vdom
						continue;
					}

				}

				// //       
				// if(sorter) {
				// 	index = null;
				// }

//				vdom.render(item);
				item.render();  //FIXME  ?

			}
		}


		if(updated) {

			for(var i = 0; i &lt; updated.length; i++) {
				var item = updated[i];

				if(filter) {
					if( !filter(item, item._index) ) {
						//       ,     VDOM
						if(item._rendered) {
							vdom.remove(item);
						}
						continue;
					}
				}


				//         item._index
				if(!item._rendered) {
					vdom.add(item, item._index);
				}
				//   sorter,      
				else if(!sorter){
					// MOVE
					vdom.remove(item);
					vdom.add(item, item._index);
				}

			}

		}



		if(sorter) {

			var kv_a = [];
			this.items.each(function(item, i) {
				//    
				if(item._rendered) {
					kv_a.push( [item._index, item, item.dom.el._pos, item.dom] );
				}
			});


			// Sorting KV-array
			kv_a.sort(sorter);


			$ergo.fixDisorder(kv_a, function(i, j) {

				var _item = this.items.get(i);

				//TODO      items.move()
				vdom.remove(_item);
				vdom.add(_item, j);

			}.bind(this));


		}
*/

	}







};



Ergo.alias('mixins:jquery', {

  get el() {
    return $(this.vdom.el);
  },


  get jquery() {
    if(!this.__jq) {
      var self = this;

      this.__jq = {
        events: {
          on: function(name, callback) {
            self.el.on(name, callback.bind(self));
          }
        },

        get el() {
          return self.el;
        }
      }

      this._bindEvents('jquery');
    }

    return this.__jq;
  },


  set width(v) { this.el.outerWidth(v); },
	set height(v) { this.el.outerHeight(v); },

  get width() {	return this.el.outerWidth();	},
	get height() { return this.el.outerHeight();	},


  // $render: function(target) {
  //   return target ? this.render($(target)[0]) : this.render();
  // },

  /**
	 *  
	 *
	 *   ,      DOM-
	 */
	show: function(wrapperAware) {
		return $.when( (wrapperAware !== false) ? $(this.vdom.outerEl).show() : this.el.show() );
	},


	/**
	 *  
	 *
	 *   ,      DOM-
	 */
	hide: function(wrapperAware) {
		return $.when( (wrapperAware !== false) ? $(this.vdom.outerEl).hide() : this.el.hide() );
	}






});
















/**
 *     
 *
 * :
 *
 *
 *
 * @class
 * @name Ergo.core.Widget
 * @extends Ergo.core.Object
 * @param {Object} o 
 * @param {string} o.layout   
 * @param {function} o.layoutFactory  
 * @param {string} o.as css-   ( cls  state)
 * @param {string} o.cls css-
 * @param {object} o.style  
 * @param {string} o.html html- 
 * @param {object} o.components  
 * @param {object} o.defaultComponent    
 * @param {function} o.componentFactory  
 * @param {array} o.items  
 * @param {object} o.defaultItem    
 * @param {function} o.itemFactory  
 * @param {boolean} o.dynamic   
 * @param {object|array|string} o.data  
 * @param {string} o.dataId    
 * @param {object} o.events  
 * @param {object} o.states  
 * @param {object} o.transitions    
 * @param {string} o.state  
 * @param {function} o.rendering   jQuery-
 * @param {string} o.renderTo   
 * @param {boolean} o.showOnRender   show  
 * @param {boolean} o.hideOnDestroy   hide  
 * @param {string|function} o.binding     
 * @param {Any} o.value  
 * @param {object} o.wrapper  ""
 * @param {function} o.format  ""   ,  
 * @param {function} o.unformat  /   "" 
 * @param {boolean} o.autoBind    
 * @param {boolean} o.autoRender -  
 * @param {boolean} o.autoHeight   
 * @param {boolean} o.autoWidth   
 *
 * @mixes observable
 * @mixes statable
 *
 * @fires dataChanged
 * @fires fetch
 * @fires fetched
 * @fires bound
 * @fires afterBuild
 * @fires click
 * @fires doubleClick
 *
 * @property {object} options
 * @property {Ergo.core.Layout} layout
 * @property {jQuery} el
 * @property {Ergo.core.DataSource} data
 * @property {Ergo.core.Observer} events
 * @property {Ergo.core.StateManager} states
 * @property {Ergo.core.WidgetChildren} children
 * @property {Ergo.core.WidgetItems} items
 * @property {Ergo.core.WidgetComponents} components
 * @property {string} text
 * @property {any} name
 * @property {string} width
 * @property {string} height
 *
 *
 */
Ergo.defineClass('Ergo.core.Widget', 'Ergo.core.Object', /** @lends Ergo.core.Widget.prototype */{


	defaults: {
//		layout: 'default',
		// states: {
// //			'hidden': 'hidden',
			// 'disabled': 'disabled',
			// 'invalid': 'invalid'
// //			'unselectable': 'unselectable'
		// },
//		plugins: [Ergo.Observable, Ergo.Statable],
//		autoBind: true,
//		autoUpdate: true,
//		include: [/*'observable',*/ 'statable'],

		// layoutFactory: function(layout) {
		// 	if( $.isString(layout) )
		// 		layout = $.ergo({etype: layout}, 'layouts');
		// 	else if(!(layout instanceof Ergo.core.Layout))
		// 		layout = $.ergo(Ergo.override({etype: 'default'}, layout), 'layouts');
		// 	return layout;
		// },
//		events: {},
//		defaultItem: {},
		// defaultComponent: {},
		// componentFactory: function(o) {
			// if($.isString(o)) {
				// o = this.options.shortcuts[o] || {text: o};
			// }
			// return Ergo.widget( Ergo.smart_override({}, this.options.defaultComponent, o) );
		// },
//		shortcuts: {},
//		showOnRender: false,
//		hideOnRender: false,
		// set: {
		// },
		// get: {
		// }
	},

	rules: {
		as: 'list',
		defaultItem: ['object'],
		defaultComponent: ['object'],
		nestedItem: ['object'],
		components: ['object', {'*': ['object']}],
		items: ['array', {'*': ['object']}],
		states: ['object'],//, {'*': 'list'}],
		transitions: ['object'],//, {'*': 'list'}]
	},



	// set scope(scope) {
	// 	this
	// }


	// ctx: {
	// 	events: {
	// 		on: function(name, callback, w) {
	// 			(w._context || Ergo.context).events.on(name, callback, w);
	// 		}
	// 	}
	// },




	/**
	 *  
	 *
	 *      ,    ,
	 *    DOM-,    .
	 *
	 * @protected
	 */
	_destroy: function(root) {

		var self = this;

		// if(this.options.hideOnDestroy &amp;&amp; !noHide) {
			// return this.hide().then(function() { self._destroy(true); });
		// }
		// else {

		var destroy = function(){

			if(this.data)
				this.data.events.off(this);

			//    
			($context || Ergo.context).events.off(this);

			if(this.scope)
				this.scope.events.off(this); //FIXME        s

			//    
			this.events.off();

			if(this.__c) {

				//     
				for(var i = this.__c.src.length-1; i >=0 ; i--) {
					this.__c.src[i]._destroy(false);
				}

			}

//			if(!eventsOnly) {

			//       (data + event handlers)  
			if(this.parent &amp;&amp; root !== false)
				this.parent.children.remove(this);

			if(this.__c) {

				this.children.remove_all();

				//  
//				this.layout.clear();  //?
			}

			if(this.__vdom) {
				this.__vdom.clear();

//				$ergo.dom.remove(this.el);
//				this.el.remove();
			}

//			}


			//   _destroy    
			// while( !this.children.is_empty() ) {
			// 	this.children.first()._destroy(true);
			// }

//			this.children.apply_all('_destroy');

			this._destroyed = true;

		};

		if( root !== false ) {
			this.unrender()
			destroy.call(this);
			//			this.unrender().then( destroy.bind(this) );
		}
		else {
			destroy.call(this);
		}

//		}
//		if(this.options.debug)	console.log('_destroyed');

	},




	/**
	 *     :
	 *
	 *  ""     $
	 *
	 * @protected
	 */
	_pre_construct: function(o) {
		Ergo.core.Widget.superclass._pre_construct.call(this, o);
//		this._super(o);



		var self = this;


		// ""  
		for(var i in o) {
			if(i[0] == '$') {
				var key_a = i.split('__');
				var overrides = {};
				var val = overrides;

				while(key_a.length > 0) {
					var k = key_a.shift();
					var v = (key_a.length == 0) ? o[i] : {};
					if(k[0] == '$') {
						k = k.substr(1);
						val.components = {};
						val = val.components[k] = v;
					}
					else {
						val = val[k] = v;
					}
				}

				$ergo.mergeOptions(o, overrides);
			}
		}








	},





	/**
	 *    :
	 * 1.  
	 * 2.   DOM- ( jQuery)
	 * 3.  
	 * 4.  
	 * 5.   (, jquery, ctx)
	 * 6.   onClick, onDoubleClick
	 *
	 * @protected
	 */
	_construct: function(o) {
		Ergo.core.Widget.superclass._construct.call(this, o);


		var self = this;
//		var el = this.el;




		//    
		/**
		 * @field
		 *
		 * @description   
		 *
		 */
//		this.children = new Ergo.core.WidgetChildren(this);

		/**
		 *  
		 * @field
		 */
//		this.components = new Ergo.core.WidgetComponents(this, {type: 'component'});
		/**
		 *  
		 * @field
/		 */
//		this.items = new Ergo.core.WidgetItems(this, {type: 'item'});

		//TODO   jQuery-  
		//    DOM    
		/**
		 * @field
		 *
		 * @description jQuery-,    
		 *
		 */


/*
		if(o.rendering) {

			o.rendering.call(this, o);

		}
		else {

			this.el = $(o.html);//this.$html());

			if(!o.html) {
				this.el = $(document.createTextNode(''));
			}

			if('style' in o) this.el.css(o.style);
			if('cls' in o) this.el.addClass($.isString(o.cls) ? o.cls : o.cls.join(' '));
			if('baseCls' in o) this.el.addClass(o.baseCls);

			if(o.as) {
				var as = o.as.join(' ').split(' ');
				var cls = [];
				for(var i = 0; i &lt; as.length; i++) {
					if(as[i][0] != '+' &amp;&amp; as[i][0] != '-')
						cls.push(as[i]);
				}
				this.el.addClass(cls.join(' '));
			}

		}

		this.el[0]._ergo = this;


  	if(o.layout)
	 		this.layout; //FIXME    ,    
		//  if(o.layout) {
		// 	 this.layout = (o.layoutFactory || this.layoutFactory)(o.layout);
		//  }
		//  else {
		// 	 this.layout = new Ergo.core.Layout();
		//  }
		//
		// this.layout.attach(this);//this.layout.options._widget || this);
*/

		var _widget = this;

//		if(o.layout) {
//		this.layout = o.layout;
//		}




// 		var _dom = {
//
// 			style: function(k, v) {
// 				if(arguments.length == 2) {
// 					v = (typeof v === 'number') ? v + 'px' : v;
// 					_dom.el.style[k] = v;
// 				}
// 				else if(arguments.length == 1 &amp;&amp; k) {
// 					if( k.constructor === Object ) {
// 						for(var i in k) {
// 							var v = k[i];
// 							v = (typeof v === 'number') ? v + 'px' : v;
// 							_dom.el.style[i] = v;
// 						}
// 					}
// 					else if( k.constructor === String ) {
// 						return _dom.el.style[k];
// 					}
// 				}
// 			},
//
// 			addClass: function(cls) {
// 				if( cls &amp;&amp; _dom.el instanceof Element ) {
// 					(''+cls).split(' ').forEach(function(c) {
//
// 						if(!c) return;
//
// 						if(_dom.el.classList) {
// 							_dom.el.classList.add(c);
// 						}
// 						else {
// 							// IE9
// 							var re = new RegExp("(^|\\s)" + c + "(\\s|$)", "g");
// 							if(!re.test(_dom.el.className)) {
// 								_dom.el.className = (_dom.el.className + " " + c).replace(/\s+/g, " ").replace(/(^ | $)/g, "")
// 							}
// 						}
// 					});
// 				}
// 			},
//
// 			removeClass: function(cls) {
// 				if( cls &amp;&amp; _dom.el instanceof Element ) {
// 					(''+cls).split(' ').forEach(function(c) {
//
// 						if(!c) return;
//
// 						if(_dom.el.classList) {
// 							_dom.el.classList.remove(c);
// 						}
// 						else {
// 							// IE9
// 							var re = new RegExp("(^|\\s)" + c + "(\\s|$)", "g");
// 							_dom.el.className = _dom.el.className.replace(re, "$1").replace(/\s+/g, " ").replace(/(^ | $)/g, "");
// 						}
// 					});
// 				}
// 			},
//
// 			remove: function() {
// 				if(_dom.el.parentNode) {
// 					_dom.el.parentNode.removeChild(_dom.el);
// 				}
// 			}
//
// 		};
//
// 		if(o.rendering) {
//
// 			o.rendering.call(this, o);
//
// 		}
// 		else {
//
// 			if( o.tag ) {
// 				_dom.el = (o.tag.constructor === String) ? document.createElement(o.tag) : o.tag;
// //				_dom.el = document.createElement(o.tag);
// 			}
// 			else {
// 				_dom.el = document.createTextNode('');
// 			}
//
// //			var _el = this.el;
// 		}
//
// 		_dom.el._ergo = this;
//
//
//
//
// 		//   `dom`
// 		_dom.events = {
// 			_listeners: {},
//
// 			on: function(name, callback) {
// 				_widget.events.on('dom#'+name, callback);
// 				if(!this._listeners[name]) {
// 					this._listeners[name] = function(e) { this.events.fire('dom#'+name, {}, e); }.bind(_widget);
// 					_dom.el.addEventListener(name, this._listeners[name]);
// 				}
// 			},
//
// 			off: function(name) {
// 				_widget.events.off('dom#'+name);
// 				for(var i in this._listeners) {
// 					_dom.el.removeEventListener(name);
// 				}
// 			}
//
// 		};
//
//
// 		this.dom = _dom;



		// if(o.tag)
		// 	this.layout;

		// if('layout' in o) {
		// 	this.layout;
		// }

		//FIXME     vdom

		if('style' in o) {
			this.vdom.setStyle(o.style);
		}

		if('cls' in o) {
			this.vdom.setClass(o.cls);
		}





		if('components' in o) {
			var arr = [];
			//     
			Ergo.each(o.components, function(c, i){
				if(!c.ignore)
					self.children.add(c, i, 'component');
			} );

		}



		if('items' in o){
			for(var i = 0; i &lt; o.items.length; i++)
				this.children.add(o.items[i]);

		}






/*
		if('onClick' in o)
			this.el[0].addEventListener('click', function(e) { if(!self.states.is('disabled')) self.events.fire('click', {button: e.button}, e); })
//			this.el.click(function(e) { if(!self.states.is('disabled')) self.events.fire('click', {button: e.button}, e); });
		if('onDoubleClick' in o)
			this.el.dblclick(function(e) { if(!self.states.is('disabled')) self.events.fire('doubleClick', {button: e.button}, e); });

//		if(o.fastclick)
//			this.el.mousedown(function(e) { if(!self.states.is('disabled') &amp;&amp; e.button === 0) self.events.fire('click', {button: e.button}, e); });



*/

		this.events.rise = Ergo.rise;
		this.events.sink = Ergo.sink;

	},






//	_theme: function() {
//		if(this.options.ui == 'jquery_ui') this._theme_jquery_ui
//	}



	/**
	 *   :
	 * 1.  (renderTo)
	 * 2.   (data)
	 * 3.   (state)
	 *
	 * @protected
	 */
	_post_construct: function(o) {
//		this._super(o);
		Ergo.core.Widget.superclass._post_construct.call(this, o);




		if('as' in o) {
      var as = o.as.join(' ').split(' ');

			for(var i = 0; i &lt; as.length; i++) {
				if(as[i][0] == '+' || as[i][0] == '&amp;')
					this.states.set(as[i].substr(1));
				else if(as[i][0] == '-' || as[i][0] == '!')
					this.states.unset(as[i].substr(1));
				else {
//					this.dom.el.classList.add(as[i]);
					this.vdom.addClass(as[i]);
				}
			}

      // for(var i = 0; i &lt; clsList.length; i++) {
      //   this.dom.addClass(clsList[i]);
      // }
    }


//		console.log(this.events.events);
		if(this.events.events['click']) {
			this.vdom.events.on('click', function(e) { this.events.fire('click', {}, e); });
		}

		if(this.events.events['doubleClick']) {
			this.vdom.events.on('dblclick', function(e) { this.events.fire('doubleClick', {}, e); });
		}


		if(Ergo._scope) {
			this.scope = Ergo._scope;
		}


		if('renderTo' in o) {
			this.render(o.renderTo);
		}


		if('data' in o) {
			this.data = o.data;
		}



		this._bindEvents('context');



		this.events.fire('afterBuild');

	},










	// factory: function(item) {
		// if(!(item instanceof Ergo.core.Widget)) {
			// item = this.options.componentFactory.call(this, item);
		// }
		// return item;
	// },




	/**
	 *   
	 *
	 *     ,     ( `w.opt('name')` )
	 *
	 *       `stop()`,   
	 *
	 * @param {Object} originalEvent  
	 * @param {string} eventContext   (`jquery`, `scope`  ..)
	 * @param {string} name  
	 *
	 */
	action: function(v, event, eventType) {

		v = v || this.opt('name');
		// if(arguments.length == 1) {
		// 	e = v;
		// 	v = this.opt('name');
		// }

		// if( v == null /*|| $.isNumeric(v)*/ )
		// 	throw new Error('Invalid action name ['+v+"]");

		this.events.rise(''+v, {}, event);

		if(eventType != v &amp;&amp; event.stop)
			event.stop();
	},














// 	filter: function(type, criteria) {
//
// 		if(type == 'render') {
// //			if(criteria)
// 			this.options.renderFilter = criteria;
// 			this._rerender();
// 		}
//
// 		if(type == 'compose') {
// 			if(this.options.dynamic) {
// //				if(criteria)
// 				this.options.dynamicFilter = criteria;
// 				this._rebind();
// 			}
// 		}
//
// 	},




	// filter: function(criteria, opt, type) {

	// 	type = type || 'items';

	// 	this[type].each(function(item) {
	// 		var ok = criteria( opt ? item.opt(opt) : item );
	// 		if( !ok ) {
	// 			item.unrender();
	// 		}
	// 		else if(!item._rendered) {
	// 			item.render();
	// 		}
	// 	});

	// },












	/**
	 *     
	 *
	 * @param {Object} callback ,    
	 */
	walk: function(callback) {
		if( callback.call(this, this) === false)
			return;

		if(!this.__c)
			return;

		this.children.each(function(item){
			item.walk(callback);
		});
	},




	/**
	 *    ,     
	 */
	next: function() {
		if(!this.parent) return null;
		return this.parent.item(this._index+1);
	},

	/**
	 *    ,     
	 */
	prev: function() {
		if(!this.parent) return null;
		return this.parent.item(this._index-1);
	},

	/**
	 *  
	 *
	 * @param {int|string|class|Function|Object} i ||||
	 * @returns {Ergo.core.Widget}
	 *
	 * @example
	 * w.item(2) -     2
	 * w.item('header') -     "header"
	 * w.item(Ergo.widgets.MyWidget) -   Ergo.widgets.MyWidget
	 * w.item({tag: 'hello'}) - ,    "tag"  "hello"
	 *
	 */
	item: function(i) {
//		return this.children.find(Ergo.filters.by_widget(i));
		var finder = Ergo.by_widget(i);
		var j = 0;
		return this.children.find(function(item, i){
			if(item._type == 'item'){
				if(finder.call(this, item, j)) return true;
				j++;
			}
//			return item.type == 'item' &amp;&amp; ;
		});
	},


	/**
	 *  
	 *
	 *  
	 *
	 * @param {string|class|Function|Object} i |||
	 * @returns {Ergo.core.Widget}
	 *
	 */
	component: function(i) {
		var finder = Ergo.by_widget(i);
		return this.children.find(function(item, j){
			return item._type == 'component' &amp;&amp; finder.call(this, item, j);
		});
	},





	//-------------------------------------------
	//      
	//-------------------------------------------


	/**
	 *     .
	 *
	 *     ""  .
	 *
	 * @returns {Array}   
	 */
	parents: function(list) {
		if(arguments.length == 0) list = [];
		if(!this.parent) return list;
		list.push(this.parent);
		return this.parent.parents(list);
	},

	/*
	 *   
	 *
	 *    ,    
	 *
	 * @example
	 * a.parent();
	 * b.parent({'data': dataItem});
	 * c.parent(Ergo.widgets.Box);
	 * d.parent(function(w) { return w.options.width &lt; 100; });
	 * e.parent('header');
	 *
	 * @param {Any} [criteria] 
	 *
	 * @deprecated
	 */
	// parent: function(i) {
//
		// if(arguments.length == 0) return this.parent;
//
		// return Ergo.find(this.parents(), Ergo.by_widget(i));
	// },
//







	//---------------------------------------------
	//     
	//---------------------------------------------




	get children() {
		if(!this.__c) {
			this.__c = new Ergo.core.WidgetChildren(this);
		}
		return this.__c;
	},

	get components() {
		if(!this.__cmp) {
			this.__cmp = new Ergo.core.WidgetComponents(this, {type: 'component'});
		}
		return this.__cmp;
	},

	get items() {
		if(!this.__itm) {
			this.__itm = new Ergo.core.WidgetItems(this, {type: 'item'});
		}
		return this.__itm;
	},

	get data() {
		return this.__dta;
	},

	set data(v) {
		if(v != null) {
			this.bind(v);
		}
		else {
//			this._unbindEvents('data');
			this.unbind();
		}
	},



	get vdom() {
		if(!this.__vdom) {
			this._bindVDOM();
		}
		return this.__vdom;
	},



	get scope() {
		if(!this.__scp &amp;&amp; this.parent) {
			this.__scp = this.parent.scope;
		}
		return this.__scp;
	},

	set scope(v) {
		if(v != null) {
			this.__scp = v;
			this._bindEvents('scope');
		}
		else if(this.__scp) {
			this.__scp.off(this);
			delete this.__scp;
		}

	},


	get context() {
		return $context || Ergo.context;
		// if(!this.__ctx) {
		// 	this.__ctx = (this.scope) ? this.scope._context : Ergo.context;
		// 	this._bindEvents('context');
		// }
		// return this.__ctx;
	},


	// get dom() {
	// 	var el = this.el;
	// 	if(!this.__dom) {
	// 		this.__dom = {
	// 			events: {
	// 				on: function(name, callback) {
	// 					el.addEventListener(name, callback);
	// 				}
	// 			}
	// 		}
	// 	}
	// 	return this.__dom;
	// },


	// get layout() {
	// 	if(!this.__l) {
	// 		var o = this.options;
	// 		if(o.layout) {
 // 			 this.__l = (o.layoutFactory || this.layoutFactory)(o.layout);
	// 		}
	// 		else {
	// 		 this.__l = new Ergo.core.Layout();
	// 		}
	//
 // 			this.__l.attach(this);//this.layout.options._widget || this);
	//
	// 		if( o.dynamic ) {
	// 			this.events.on('diff', function(e) {
	// 				//  
	// 				this._rerender(false, {created: e.created, deleted: e.deleted, updated: e.updated});
	// 			}.bind(this));
	// 		}
	//
	// 	}
	// 	return this.__l;
	// },








	/**
	 *  ,   .
	 *
	 *     (`options.format`),      
	 *
	 * @returns {Any} undefined,      
	 */
	get value() {
		var val;
		var o = this.options;

		if(this.data)
			val = this.data.get();
//		else if('__val' in this)
		else
			val = this.__val;
		// else
		// 	val = this.opt('text');

//			val = (o.value) ? o.value.call(this) : this.opt('text');

		//    ,   
		if(this.options.format)
			val = o.format.call(this, val);

		return val;
	},

	/**
	 *  ,   
	 *
	 *     (`options.unformat`),      
	 *
	 * @param {Any} val 
	 */
	set value(val) {

//		if(this._lock_value_change) return;

		var o = this.options;

		// deprecated
		if(o.store)
			val = o.store.call(this, val);

		if(o.unformat)
			val = o.unformat.call(this, val);

		if(this.data){

			//    
			this.data.set(val);

		}
		else {
			this.__val = val;
			//     
			this._dataChanged();
//			o.value ? o.value.call(this, val) : this.opt('text', val);
		}


//		if(o.binding)
//			o.binding.call(this, val);

//		this.events.fire('valueChanged', {'value': val});

	},


/*
	format: function(val) {
		//    ,   
		if(this.options.format)
			val = this.options.format.call(this, val);
		return val;
	},
*/



	// $valueChanged: function() {
//
	// },






	// $unknown_opt: function(i, v) {
//
		// //  
		// if(i in this.states._states) {
			// this.states.toggle(i, v)
		// }
		// //  
		// else if(i in this.states._exclusions) {
			// this.states.set(v);
		// }
//
	// }





	prop: function(i, v) {

		if(arguments.length == 1) {

			if( this.options.get &amp;&amp; (i in this.options.get) ) {
				return this.options.get[i].bind(this)();
			}
			else if( i in this.props.get ) {
				return this.props.get[i].bind(this)();
			}
			else if( (i in this) &amp;&amp; $ergo.hasGetter(this, i) ) {
				return this[i];
			}
			else if(i in this.states._states) {
				return this.states.is(i);
			}
			// else {
			// 	console.warn('Property ['+i+'] not found');
			// }

			return;
		}
		else if(arguments.length == 2) {

			if( this.options.set &amp;&amp; (i in this.options.set) ) {
				this.options.set[i].bind(this)(v);
			}
			else if( (i in this.props.set) ) {
				this.props.set[i].bind(this)(v);
			}
			else if( (i in this) &amp;&amp; $ergo.hasSetter(this, i) ) {
				this[i] = v;
			}
			else if(i in this.states._states) {
				this.states.toggle(i, v);
			}
			//FIXME
			else if(i in this.states._exclusives) {
				this.states.set(v);
			}
			// else {
			// 	console.warn('Property ['+i+'] not found');
			// }

			return this;
		}

	},





	/**
	 *   
	 *
	 *   :
	 * 1.   `options.set`
	 * 2.  set_*
	 * 3. 
	 * 4. ES5-
	 * 5.   
	 * 6.  
	 *
	 * @param {object} o 
	 */

	//  _opt: function(o) {
	//
 // 		for(var i in o) {
 // 			if( !(i in $ergo.rules) ) {
 // 				if( (i in this) &amp;&amp; $ergo.setter(this, i) ) {
 // 					this[i] = o[i];
 // 				}
	// 			else if(i in this.states._states) {
	// 				this.states.toggle(i, o[i]);
	// 			}
	// 			else if(i in this.states._exclusives) {
	// 				this.states.set(o[i]);
	// 			}
 // 			}
 // 		}
	//
 // 	},



/*
	_opt: function(o) {

//		var self = this;

		var exclusions = {
			components: true,
			items: true,
			set: true,
			get: true,
			mixins: true,
			defaultItem: true,
			defaultComponent: true,
			nestedItem: true,
			events: true,
			states: true,
			attributes: true,
		};

//		var el = this.el;

		for(var i in o) {

			if( (i in exclusions) || i[0] == '$') continue;

			//    
			if(this.options.set &amp;&amp; this.options.set[i])
				this.options.set[i].call(this, o[i], this.options);
			//     ,   java-like 
			else {
				//   Java-like 
				var java_setter = 'set_'+i;//.capitalize();
				if(this[java_setter])
					this[java_setter](o[i]);
				// //  
				// else if(this.layout._etype == 'layouts:'+i)
				// 	this.layout
				//  
				else if(i in this.states._states)
					this.states.toggle(i, o[i]);
				//   
				else if( (i in this) &amp;&amp; Ergo.setter(this, i) ) {
					// var desc = Object.getOwnPropertyDescriptor(this, i);
					// if(desc &amp;&amp; desc.set)
					this[i] = o[i];
				}
				else if(i in this.states._exclusives)
					this.states.set(o[i]);
				//  
				else if(this.attributes.indexOf(i) != -1)
					o[i] ? this.el.attr(i, o[i]) : this.el.removeAttr(i);

			}
		}


//		profiler.tick('opt', 'other');
//
//		profiler.stop('opt');

	},
*/



	layoutFactory: function(layout) {
		if( $.isString(layout) )
			layout = $.ergo({etype: layout}, 'layouts');
		else if(!(layout instanceof Ergo.core.Layout))
			layout = $.ergo(Ergo.override({etype: 'default'}, layout), 'layouts');
		return layout;
	},





	rise: function(name, e, baseEvent) {
		if(!e) e = {};
		e.target = e.target || this;
		e = this.events.fire(name, e, baseEvent);
		if(this.parent &amp;&amp; !e.stopped) {
			this.parent.rise(name, e);
		}
	},


	sink: function(name, e, baseEvent) {
		if(!e) e = {};
		e.target = e.target || this;
		e = this.events.fire(name, e, baseEvent);
		if(this.parent &amp;&amp; !e.stopped) {
			this.parent.rise(name, e);
		}
	},









/*
	get __skeleton() {

		var s = {
			components: [],
			items: [],
			states: [],
			events: [],
			options: {}
		};



		var exclusions = {
			components: true,
			items: true,
			set: true,
			get: true,
			mixins: true,
			defaultItem: true,
			defaultComponent: true,
			nestedItem: true,
			events: true,
			states: true,
			attributes: true,
			__skeleton: true,
			include: true,
			children: true
		};

		// simple options
		for(var i in this.options) {
			if( !(i in exclusions) &amp;&amp; !/on\S/.test(i) ) {
				s.options[i] = ['get', 'set'];
			}
		}

		// get/set options
		if( this.options.get ) {
			for(var i in get) {
				if( !(i in s.options) ) {
					s.options[i] = ['get'];
				}
			}
		}
		if( this.options.set ) {
			for(var i in set) {
				if( !(i in s.options) ) {
					s.options[i].push('set');
				}
			}
		}

		// state options
		for(var i in this.states._states) {
			s.options[i] = ['get', 'set'];
		}
		for(var i in this.states._exclusives) {
			s.options[i] = ['get', 'set'];
		}

		// property options
		var w = this;
		while(w) {
			for(var i in w) {
				var desc = Object.getOwnPropertyDescriptor(w, i);
				if(desc &amp;&amp; !(i in exclusions)) {
					if(desc.get) {
						s.options[i] = s.options[i] ? s.options[i].concat('get') : ['get'];
					}
					if(desc.set) {
						s.options[i] = s.options[i] ? s.options[i].concat('set') : ['set'];
					}
				}
			}
			w = w.constructor.superclass;
		}


		this.components.each(function(c, i) {
			s.components.push(i);
		})


		s.states = Object.keys(this.states._states);

		s.events = Object.keys(this.events.events);

		return s;
	}
*/




	// setTextSelection: function(v) {
		// if(!v) {
      // if($.browser.mozilla){//Firefox
        // this.el.css('MozUserSelect','none');
      // }
      // else if($.browser.msie){//IE
        // this.el.bind('selectstart',function(){return false;});
      // }
      // else{//Opera, etc.
        // this.el.mousedown(function(){return false;});
      // }
		// }
	// }





}, 'widgets:widget');



Ergo.override(Ergo.core.Widget.prototype, Ergo.alias('mixins:observable'));

Ergo.override(Ergo.core.Widget.prototype, Ergo.alias('mixins:statable'));

Ergo.override(Ergo.core.Widget.prototype, Ergo.WidgetOptions);

Ergo.deep_override(Ergo.core.Widget.prototype, Ergo.WidgetProps);

Ergo.override(Ergo.core.Widget.prototype, Ergo.WidgetData);

Ergo.override(Ergo.core.Widget.prototype, Ergo.WidgetRender);

Ergo.override(Ergo.core.Widget.prototype, Ergo.alias('mixins:jquery'));

/*
Ergo.override(Ergo.core.Widget.prototype, Ergo.WidgetAttributes);

Ergo.override(Ergo.core.Widget.prototype, Ergo.WidgetRender);
*/


//Ergo.widget = function(){
//	if(arguments.length == 1) return Ergo.object(arguments[0]);
//	return Ergo.object( Ergo.smart_override.apply(this, arguments) );
//};

Ergo.$widget = Ergo.object;

// Ergo.$widget = function(o, etype) {
	// return Ergo.object(o, 'widget:'+etype);
// };


Ergo.after_rise = function(e, type, base) {
	if(this.parent &amp;&amp; !e.stopped) this.parent.events.fire(type, e, base);
};


Ergo.after_sink = function(e, type, base) {
	this.children.each(function(child){
		child.events.fire(type, e, base);
	});
};


Ergo.rise = function(name, e, baseEvent) {
	if(!e) e = {};//new Ergo.core.Event();
	e.after = Ergo.after_rise;
	e.target = e.target || this.target;
	this.fire(name, e, baseEvent);
};

Ergo.sink = function(name, e, baseEvent) {
	if(!e) e = {};//new Ergo.core.Event();
	e.after = Ergo.after_sink;
	e.target = e.target || this.target;
	this.fire(name, e, baseEvent);
};





//------------------------------
//   jQuery
//------------------------------

$ergo = Ergo.override(function(o, ns, scope) {

//	var o = Ergo.smart_override.apply(this, arguments);

	var etype = null;

	if( Array.isArray(o) ) {
		for(var i = o.length-1; i >= 0; i--) {
			if(o[i])
				etype = o[i].etype;
			if(etype) break;
		}
	}
	else {
		etype = o.etype;
		o = [o];
	}


	if(!etype) {
		throw new Error('Object etype is not defined \n'+$ergo.pretty_print(o)+'');
	}

	// var ns = null;
	// var scope = null;
	//
	// if( $.isString(ns_or_scope) ) {
	// 	ns = ns_or_scope;
	// }
	// else {
	// 	scope = ns_or_scope;
	// }

//	var etype = o.etype;
	ns = ns || 'widgets';
	var i = etype.indexOf(':');
	if(i > 0) {
		ns = etype.substr(0, i);
		etype = etype.substr(i+1);
	}

	if( !Ergo['$'+ns] )
		throw new Error('Namespace "'+ns+'" not defined');

	o.etype = ns+':'+etype;

	var w = Ergo['$'+ns](o, etype);//, scope);

	scope = scope || Ergo._scope;

	if(scope &amp;&amp; w.options.sid) {//w.opt('scopeKey')) {
		scope.addWidget( w.options.sid, w );
	}

	return w;

}, Ergo);

$.ergo = $ergo;



$.fn.ergo = function(o) {
	if(this.length > 0){
		var widget = (this[0]._vdom) ? this[0]._vdom._widget : undefined;// this.data('ergo-widget');
		if(widget) return widget;
		if(!o) return undefined;
		o.html = this;
	}
	else if(arguments.length == 0) return null;

	return $.ergo(o);
};









/**
 *   
 *
 * @namespace
 */
Ergo.widgets = {};


Ergo.$widgets = $ergo.object.bind(this, 'widgets');


/**
 * 
 *
 *   
 *
 * @class
 * @name Ergo.core.Context
 * @extends Ergo.core.Object
 *
 */
Ergo.defineClass('Ergo.core.Context', 'Ergo.core.Object', /** @lends Ergo.core.Context.prototype */{

	defaults: {
//		plugins: [Ergo.Observable] //, Ergo.Statable]
		include: 'observable',

		events: {
			'restore': function(e) {
				//TODO      
			}
		}

	},





	_construct: function(o) {
		this._super(o);


		this._scopes = {};
		this._callbacks = {};
		this._depends = {};
		this._data = {};
		this._params = {};

		this._widget = null;


		// if('events' in o) {
		// 	for(var i in o.events) {
		// 		var callback_a = o.events[i];
		// 		for(var j = 0; j &lt; callback_a.length; j++) {
		// 			var callback = callback_a[j];
		// 			if( $.isFunction(callback) ) {
		// 				this.events.on(i, callback, this);
		// 			}
		// 		}
		// 	}
		// }

		var ctx = this;


		this.scopes = {

			scope: function(name, callback) {

				if(arguments.length == 1) {
					if(name[0] == ':') {
						for(var i in ctx._scopes) {
							if(i.indexOf(name) > 0)
								return ctx._scopes[i];
						}
					}
					else {
						return ctx._scopes[name];
					}
				}
				else if(arguments.length == 2) {
					ctx._callbacks[name] = callback;
				}
				else {
					ctx._callbacks[name] = arguments[2];
					ctx._depends[name] = Array.isArray(arguments[1]) ? arguments[1] : [arguments[1]] ;
				}

			},


			get: function(name) {
				return ctx._scopes[i];
			}

		};





		if(o.hashLinks) {

			//   
			$('html').click(function(e){
				var el = $(e.target);
		//		console.log(el[0].localName);
		//		console.log(el.attr('href'));
				if(el[0] &amp;&amp; el[0].localName == 'a' &amp;&amp; el.attr('href') == '#') {
					e.preventDefault();

					// !
					// var w = el.ergo();
					// if(w &amp;&amp; w.opt('link')) {
		// //				$context.setState( w.opt('link'), 'pages', {}, true );
					// }
				}
			});


		}


//		if(o.history) {






			// $(window).on('popstate', function(e) {
			// 	var p = e.originalEvent.state;
			// 	if(p) {
			// 		self._no_history = true;
			// 		self.events.fire('restore', {scope: p._scope, params: p});
			// 		self._no_history = false;
			// 	}
			// });


			// this.events.reg('scope:joined', function(e) {

			// 	if(e.scope.history &amp;&amp; !self._no_history) {
			// 		window.history.pushState( Ergo.override({_scope: e.scope._name}, self._params), e.scope._name );//, 'title', '#'+url);
			// 	}

			// });

//		}




		if(o.windowBox) {

			//      
			$(window).on('resize', function(){

				//  &lt;body>   
				$('body').height(window.innerHeight);
				//  
				$context.app._layoutChanged();

			});


			$('body').height(window.innerHeight);
		}



	},


	/*
	state: function(s, fn) {
		this.states.state(s, function() {
			fn.apply(this, arguments);
			return false;
		}.bind(this));
	},
	*/




	open_glass_pane: function() {
		var gp = $('&lt;div class="glass-pane" autoheight="ignore"/>')
			.on('mousedown', function(e){
				e.preventDefault();
				return false;
			});

		$('body').append(gp);

		return gp;
	},


	close_glass_pane: function() {
		$('.glass-pane').remove();
	},



	//     (  )
	widget: function(key) {

		var name_a = key.split('@');

		if(name_a.length == 2) {
			return this._scopes[name_a[0]].widget(name_a[1]);
		}

		// for(var i in this._scopes) {
		// 	var w = this._scopes[i].widgets[key];
		// 	if(w) return w;
		// }

	},



	get data() {
		return this._data;
	},


/*
	//    
	data: function(key, v) {

		if(arguments.length == 1)
			return this._data[key];
		else
			this._data[key] = v;

		// for(var i in this._scopes) {
		// 	var d = this._scopes[i].data[key];
		// 	if(d) return d;
		// }

	},




	// param: function(key, v) {
	// 	if(arguments.length == 1)
	// 		return this._params[key];
	// 	else
	// 		this._params[key] = v;
	// },


	//  
	scope: function(name, callback) {

		if(arguments.length == 1) {
			if(name[0] == ':') {
				for(var i in this._scopes) {
					if(i.indexOf(name) > 0)
						return this._scopes[i];
				}
			}
			else {
				return this._scopes[name];
			}
		}
		else if(arguments.length == 2) {
			this._callbacks[name] = callback;
		}
		else {
			this._callbacks[name] = arguments[2];
			this._depends[name] = Array.isArray(arguments[1]) ? arguments[1] : [arguments[1]] ;
		}

	},
*/

	//    
	join: function(scope_name, params, widget) {

		var ctx = this;

		var parent = null;

		var chain = scope_name.split('.');

		console.log('scope chain', chain);

		if( chain.length > 1 ) {
			//   
			parent = this._scopes[chain[chain.length-2]] || this.join( chain.splice(0,chain.length-1).join('.'), $ergo.override(params || {}, {prejoined: true}) );
		}

		scope_name = chain[chain.length-1];


		if(!this._callbacks[scope_name]) {
			throw new Error('Scope ['+scope_name+'] is not registered in context');
		}


		if( parent ) {
			//   
			// FIXME ,       
			for( var i in parent._children )
				this.disjoin( parent._children[i] );
		}


		var scope = this._scopes[scope_name];


		if( !scope ) {
			// var scope = this._scopes[scope_name];
			// ctx.events.fire('scope:rejoin', {scope: scope, params: scope._params});
			// scope.events.fire('rejoin');
			//
			// console.log('rejoin:'+scope_name);
			// return this._scopes[scope_name];


		// var name_a = scope_name.split(':');
		// var group = (name_a.length == 1) ? null : name_a[name_a.length-1];
		//
		// //       ,   
		// for(var i in this._scopes) {
		// 	if(i.indexOf(':'+group) != -1) {
		// 		this.events.fire('scope:disjoin', {scope: this._scopes[i]});
		// 		this.disjoin(i);
		// 	}
		// }


		// //    ,    
		// if( this._depends[scope_name] ) {
		// 	var base_scopes = this._depends[scope_name];
		//
		// 	var base_scope = null;
		// 	for(var i = 0; i &lt; base_scopes.length; i++) {
		// 		base_scope = this._scopes[base_scopes[i]];
		// 		if(base_scope)
		// 			break;
		// 	}
		//
		// 	if( !base_scope ) {
		// 		ctx.join(base_scopes[0]);
		// 		base_scope = this._scopes[base_scopes[0]]
		// 	}
		//
		// 	parent = base_scope;
		//
		// }


//		this._params[scope_name] = this._params[scope_name] || {};

			//  
			scope = new Ergo.core.Scope(widget);
			scope._context = this;
			scope._name = scope_name;
			scope._parent = parent;
	//		scope._container = container;

	//		Ergo.override(scope, overrides);

			scope._chain = parent ? parent._chain.concat(scope_name) : [scope_name];



			if(parent)
				parent._children[scope_name] = scope;

			this._scopes[scope_name] = scope;

		}



		scope._params = params || {};// Ergo.override(this._params[scope_name], params);// this._params[scope_name];


		var deferred = $.Deferred();

		scope._promise = deferred.promise();



	//		ctx.events.fire('scope:prejoin', {scope: scope, params: scope._params});
		ctx.events.fire('scope#join', {scope: scope, params: scope._params});
		scope.events.fire('join');


		var _scope = Ergo._scope;

		Ergo._scope = scope;

		//  
		var initPromise = this._callbacks[scope_name].call(this, scope, Ergo.override({}, scope._params), scope._promise) || true;

		Ergo._scope = _scope;

		//   ?





		$.when(initPromise).done(function() {

			//    
			scope.createWidgets();

			ctx.events.fire('scope#joined', {scope: scope, params: scope._params});
			scope.events.fire('joined');

			console.log('join:'+scope_name);

			scope._joined = true;

			try {
				deferred.resolve(scope, scope._params);
			}
			catch(err) {
				console.log(err);
			}
		});

		return scope;//._promise;
	},


	//    
	disjoin: function(scope) {

		if( $.isString(scope) )
			scope = this._scopes[scope];


		scope.events.fire('disjoin', {scope: scope});
		this.events.fire('scope#disjoin', {scope: scope, params: scope._params});


		//   
		for(var i in scope._children) {
			this.disjoin( scope._children[i] );
		}


		//    (   )

		scope.destroyWidgets();


		// for(var i in scope.widgets) {
		//
		// 	var w = scope.widgets[i];
		//
		// 	console.log('destroy', i);
		//
		//
		// 	w._destroy();
		//
		// }


		delete this._scopes[scope._name];

		console.log('disjoin', scope._name);

		if(scope._parent)
			delete scope._parent._children[scope._name];

		scope.events.fire('disjoined');


		//  ?

	},



// 	//  
// 	to: function(scope_name, params, data) {
//
// 		//   ?
//
//
// 		//   
// 		var ctx = new Ergo.core.Context();
// 		ctx.params = params;
// 		ctx._data = data;
// //		ctx._scope = this;
//
// 		ctx.join(scope_name);
//
// 		this._subcontext = ctx;
//
// 	},



	reset: function() {

		for(var i in this._scopes) {
//			this.events.fire('scope:disjoin', {scope: this._scopes[i]});
			this.disjoin(i);
		}

	},


	init: function() {

		var e = this.events.fire('restore', {name: null, params: {}});//, opts: {}});


		this.join( e.name, e.params );//, e.options );

//		var ctx = this;

/*
		var p = window.history.state;

		this._no_history = true;

		this.events.fire('scope:restore', {params: (p ? p : ctx.options.main)});

	// 	if(p) {

	// 		// 
	// 		this.restore(p);
	// 	}
	// 	else {
	// 		//   
	// //		$context.join( $context.options.main );
	// 		this.restore( $context.options.main )
	// 	}

		this._no_history = false;
*/
	}


	// restore: function(name, p) {
	//
	// 	$context.join(name, p);
	//
	// // 	//  
	// // 	for(var i in p) {
	// // 		for(var j in this._callbacks) {
	// // 			var s = ''+i+':'+p[i];
	// // 			if(i == j || s == j) {
	// // //				console.log('restore', i);
	// // 				$context.join(j);
	// // 			}
	// // 		}
	// // 	}
	//
	// }


});







Ergo.context = new Ergo.core.Context();

$context = Ergo.context;



/**
* 
*
*	  ,   
*
*
*/

Ergo.defineClass('Ergo.core.Scope', 'Ergo.core.Object', {

	defaults: {
		include: 'observable'
	},


	_initialize: function(widget, o) {
		Ergo.core.Scope.superclass._initialize.call(this, o);

		this.widgets = {};

		this._children = {};
//		this.data = {};
		this._widget = widget;

	},


// 	_construct: function(o) {
// 		this._super(o);
//
//
// //		this.context = null;
// 	},



	addWidget: function(key, widget) {

		//
		if(widget.constructor === Object) {
			widget = $.ergo(widget);
		}

		this.widgets[key] = widget;
		widget.scope = this;

		return widget;
	},



	widget: function(k, w) {

		if(arguments.length == 1) {
			return this.widgets[k];
		}
		else {
			return this.addWidget(k, w);
		}

	},


	// removeWidget: function(key) {
	//
	// 	var w = this.widgets[key];
	//
	// 	//
	//
	// 	delete w.scope;
	// 	delete this.widgets[key];
	//
	// 	w._destroy();
	//
	// },



	createWidgets: function() {

		//    (   )
		for(var i in this.widgets) {

			var w = this.widgets[i];

			//  ,   
			var container = null//this._widget;
			for(var scope = this._parent; scope &amp;&amp; !container; scope = scope._parent) {
				container = scope._widget;
			}

			var container = container || this._context._widget;

			//       
			if(!w.parent &amp;&amp; !w._rendered) {
				//     ,  
				container.components.set(i, w);
//				w.render();
			}

			container.render();
		}

	},



	destroyWidgets: function() {

		Object.keys(this.widgets).forEach(function(key) {

			var w = this.widgets[key];

			w._destroy();

			// w.unrender();
			//
			// w.parent.components.remove(key);

		}.bind(this));

	},




/*
	// /    
	widget: function(key, w) {

		if(arguments.length == 1) {
			return this.widgets[key];
		}
		else if(arguments.length == 2) {

			if($.isPlainObject(w)) {
				w = $.ergo(w, null, this);
//				w.bind();
			}

			this.widgets[key] = w;
			w.scope = this;
			this['$'+key] = w;

			return w;
		}

	},
*/

	disjoin: function() {

		//TODO      

		this._context.disjoin(this._name);
	},



	get params() {
		return this._params;
	}



});















/**
 *     
 *
 *
 * @class
 * @name Ergo.data.Collection
 * @extends Ergo.core.DataSource
 */
Ergo.declare('Ergo.data.Collection', 'Ergo.core.DataSource', /** @lends Ergo.data.Collection.prototype */{

	defaults: {
		model: null,
		idKey: 'id',
		query: {}
	},

	/**
	 *   
	 *
	 * @field
	 *
	 */
	model: null,


	/**
	 *     OID
	 */
	find: function(id) {
		var a = this.get();
		for(var i in a)
			if(a[i][this.options.idKey] == id) return a[i];
		return null;
	},


	find_entry: function(id) {

		var valueUid = (this.options.valueUid || this._valueUid);

		var a = this.get();
		for(var i in a)
			if(valueUid.call(this, a[i], i) == id) return this.entry(i);
		return null;
	},




	_initialize: function(v) {
		if(arguments.length == 0)
			this._super([]);
		else if(arguments.length == 1) {
			Array.isArray(v) ? this._super(v) : this._super([], v);
		}
		else
			this._super.apply(this, arguments);

	},



	/**
	 *     =>   
	 *
	 */
	fetch: function(q) {

		this._fetched = undefined;

		var parse = this.options.parser || this._parse;
		var query = Ergo.override({}, this.options.query, q);

		this.events.fire('fetch');

		var provider = this.options.provider;

		if( $.isString(provider) )
			provider = Ergo.alias('providers:'+provider);


		if(provider) {
			var self = this;
			return provider.find_all(this, query).then(function(data) {

				var v = parse.call(self, data);

				if(self.options.sync) {
					self.sync( v );
					self._fetched = true;
					// self.source = v;
					// self._fetched = 'swap';
				}
				else {
					self.set( v );
					self._fetched = true;
				}
				self.events.fire('fetched');

				return data;
			});
		}
		else {
			this._fetched = true;
			this.events.fire('fetched');
		}

	},





	// _merge: function(oldData, newData) {
	//
	//
	// },


/*
	sync: function(q) {

		this._fetched = undefined;

		var parse = this.options.parser || this._parse;
		var query = Ergo.override({}, this.options.query, q);

		var provider = this.options.provider;

		this.events.fire('fetch:before');

		if( $.isString(provider) )
			provider = Ergo.alias('providers:'+provider);


		if(provider) {
			var self = this;
			return provider.find_all(this, query).then(function(data) {

				var v = parse.call(self, data);

				if(v.length == self.source.length) {
					self.source = v;
					self.events.fire('value:sync');
				}
				else {
					self.set( v );
				}
				self._fetched = true;
				self.events.fire('fetch:after');
			});
		}
		else {
			this._fetched = true;
			this.events.fire('fetch:after');
		}

		return $.when(null);
	},
*/



	_parse: function(v) {
		return v;
	},

	_compose: function(v) {
		return v;
	},


	/**
	 *   =>    
	 *
	 */
	purge: function() {
		this._fetched = false;
	},

	/**
	 *     ( )
	 *
	 */
	flush: function() {

//		var id = this._oid();

		var composer = this.options.composer || this._compose;
		var parser = this.options.parser || this._parse;
		var provider = this.options.provider;

		this.events.fire('flush');

		if( $.isString(provider) )
			provider = Ergo.alias('providers:'+provider);

		if(provider) {

			var data = composer.call(this, this.get(), 'update');

			return provider.update(this, data, this.options.query).then(function(data) {
				this.events.fire('flushed');
				return parser.call(this, data, 'update');
			}.bind(this));

		}
		else {
			this.events.fire('flushed');
		}

		return $.when(null);
	},




	drop: function(id) {

		this.events.fire('drop');

		if( $.isString(provider) )
			provider = Ergo.alias('providers:'+provider);

		if(provider) {

			return provider.delete(this, id)
				.done(function(data) {
					this.events.fire('dropped');
					return data;
				}.bind(this));

		}
		else {
			this.events.fire('dropped');
		}


		return $.when(null);
	},






	/**
	 * @deprecated
	 */
	// invoke: function(action) {
	//
	// 	var provider = this.options.provider;
	// 	var composer = this.options.composer || this._compose;
	//
	// 	if( $.isString(provider) )
	// 		provider = Ergo.alias('providers:'+provider);
	//
	// 	if(provider) {
	//
	// 		var data = composer.call(this, this.get(), action);
	//
	// 		return provider[action](this, this.options.query).then(function(data) {
	// 			// ?
	// 			return data;
	// 		});
	// 	}
	//
	// },







	/**
	 *   
	 */
	_factory: function(i) {

		/**
		 *       - .
		 * ,    :
		 *  -   
		 *  -   
		 *  -  ,    
		 */

		var model = this.options.model || this.model; //      ,   ,     
//		if($.isFunction(model)) model = model.call(this, this.val()[i]);
		if($.isFunction(model) &amp;&amp; !$.isClass(model)) model = model.call(this, this.get()[i]);
		if($.isString(model)) model = Ergo.alias(model);// eval(model); //TODO       
		model = model || Ergo.core.DataSource;

		var o = {provider: this.options.provider};
		return new model(this, i, o);
	}



});



/**
 *    .
 *
 *
 * @class
 * @name Ergo.data.Object
 * @extends Ergo.core.DataSource
 */
Ergo.declare('Ergo.data.Object', 'Ergo.core.DataSource', /** @lends Ergo.data.Object.prototype */{

	defaults: {
		idKey: 'id',
		oidKey: 'id'
	},

	/**
	 *   
	 */
	fields: {
	},



	_oid: function() {
		return this.get(this.options.idKey);
	},

	get oid() {
		return this.get(this.options.oidKey);
	},

	// oid: function() {
	// 	return this.get(this.options.idKey);
	// },

	// /**
	//  *  
	//  * @function
	//  */
	// validate: null,



	_initialize: function(o, v) {
		if(arguments.length == 0)
			this._super({});
		else if(arguments.length == 1) {
			this._super({}, o);
		}
		else
			this._super.apply(this, arguments);
	},




	set: function(v) {

		//      
		if(arguments.length == 1) {

			if(this.options.readonly) return;

			var validator = this.options.validator || this._validate;

			if(validator) {
				if( validator.call(this, v) === false ) {
					this.events.fire('invalid', {value: v, entry: this});
					return;
				}
				else {
					this.events.fire('valid', {value: v, entry: this});
				}
//					throw new Error('Invalid value: ['+v+']');
			}
		}

		return this._super.apply(this, arguments);
//		Ergo.data.Model.superclass.set.apply(this, arguments);
	},


	/**
	 *  
	 *
	 *
	 */
	fetch: function(id) {

		if(arguments.length == 0)
			id = this.oid;

//		this._fetched = true;
		var parser = this.options.parser || this._parse;
		var provider = this.options.provider;

		if( $.isString(provider) )
			provider = Ergo.alias('providers:'+provider);

		this.events.fire('fetch');

		if(provider) {
//			var self = this;
			return provider.find(this, id, this.options.query).then(function(data) {
				this.set( parser.call(this, data) );
				this._fetched = true;
				this.events.fire('fetched');
				return data;
			}.bind(this));
		}
		else {
			this._fetched = true;
			this.events.fire('fetched');
		}

	},


	/**
	 *  "" 
	 *
	 */
	_parse: function(v) {
		return v;
	},





	flush: function() {

		var oid = this.oid;

		var composer = this.options.composer || this._compose;
		var parser = this.options.parser || this._parse;
		var provider = this.options.provider;

		this.events.fire('flush');

		if( $.isString(provider) )
			provider = Ergo.alias('providers:'+provider);

		if(provider) {

			// create
			if(oid == null) {

				var data = composer.call(this, this.get(), 'create');

				return provider.create(this, data, this.options.query)
					.done(function(data) {
						this.events.fire('flushed');
						return parser.call(this, data, 'create');
					}.bind(this));
			}
			// update
			else {

				var data = composer.call(this, this.get(), 'update');

				return provider.update(this, oid, data, this.options.query)
					.then(function(data) {
						this.events.fire('flushed');
						return parser.call(this, data, 'update');
					}.bind(this));
			}
		}
		else {
			this.events.fire('flushed');
		}

		return $.when(null);
	},


	_compose: function(v) {
		return v;
	},



	drop: function() {

		var oid = this.oid;

		this.events.fire('drop');

		if( $.isString(provider) )
			provider = Ergo.alias('providers:'+provider);

		if(provider) {

			return provider.delete(this, oid)
				.done(function(data) {
					this.events.fire('dropped');
					return data;
				}.bind(this));

		}
		else {
			this.events.fire('dropped');
		}


		return $.when(null);
	},





	// invoke: function(action) {
	//
	// 	var oid = this._oid();
	//
	// 	var provider = this.options.provider;
	// 	var composer = this.options.composer || this._compose;
	//
	// 	if( $.isString(provider) )
	// 		provider = Ergo.alias('providers:'+provider);
	//
	// 	if(provider) {
	//
	// 		var data = composer.call(this, this.get(), action);
	//
	// 		return provider[action](this, oid, data, this.options.query).then(function(data) {
	// 			// ?
	// 			return data;
	// 		});
	// 	}
	//
	// },




//	get: function() {
//		var v = this._super.apply(this, arguments);
//		var v = Ergo.data.Model.superclass.get.apply(this, arguments);

//		return (this.format) ? this.format.call(this, v) : v;
//	},





	/**
	 *    ().
	 */
	_factory: function(i) {

		/**
		 *       - .
		 * ,    :
		 *  -   
		 *  -   
		 *  -  ,    
		 */

		var obj = this.fields[i];
		var o = {};
//		if($.isFunction(model)) model = model.call(this, this.val()[i]);
		if($.isPlainObject(obj)) {
			o = obj;
			obj = obj.etype;
		}
		if($.isFunction(obj) &amp;&amp; !$.isClass(obj))
			obj = obj.call(this, this.get()[i]);
		if($.isString(obj))
			obj = Ergo.alias(obj);// || obj); //TODO       
		obj = obj || Ergo.core.DataSource;

		o.provider = this.options.provider;

		return new obj(this, i, o);
	}

}, 'data:object');






Ergo.defineClass('Ergo.data.NodeList', 'Ergo.data.Collection', {

	defaults: {
	},

	model: 'data:node',

	purge: function() {
		this.set([]);
		this._fetched = false;
	}

}, 'data:node-list');




Ergo.defineClass('Ergo.data.Node', 'Ergo.data.Object', {

	defaults: {
	},

	fields: {
		'children': 'data:node-list'
	},


	fetch: function() {
		var d = this;
		d.events.fire('fetch');
		return d.entry('children').fetch( {id: d.oid} ).then(function(){ d._fetched = true; d.events.fire('fetched'); });
	},


	purge: function() {
		this.entry('children').purge();
		this._fetched = false;
	},


	get branch() {
		return this.get('children');
	}


}, 'data:node');




Ergo.declare('Ergo.data.PagedCollection', 'Ergo.data.Collection', {
	
	defaults: {
		pageSize: 30,
		totalCount: 0,
		index: 0
	},
	
	
	
	set index(v) {
		this.options.query.from = (v-1)*this.options.pageSize;
		this.options.query.to = v*this.options.pageSize;
	},
	
	
	get count() {
		return Math.ceil(this.options.totalCount / this.options.pageSize);
	},
	
	
	_parse: function(v) {
		this.options.totalCount = v.total;
		this.options.from = v.from;
		this.options.to = v.to;
		
		return v.data;
	}
	
	
	
/*	
	fetch: function() {

		this.events.fire('fetch');
		
		var o = this.options;
		
		if(o.provider) {
			var self = this;
			return o.provider.get(this, Ergo.deep_override({}, this.options.query, {from: o.from,	to: o.to}))
				.then(function(response) {
				
				o.from = response.from;
				o.to = response.to;
				o.totalCount = response.total;
				
				self.set(response.data); 
				self._fetched = true;
				
				self.events.fire('fetched');
			});
		}
		else {
			this._fetched = true;			
			this.events.fire('fetched');
		}
		
	}
*/	
	
	
});



Ergo.defineClass('Ergo.data.AjaxProvider', 'Ergo.core.Object', {
	
	defaults: {
		dataType: 'json'
	},
	
	
	_initialize: function(url, o) {
		this._super(o || {});
		
		this._url = url;
	},
	
	
	find_all: function(ds, query) {
		return $.ajax({
			url: this._url,
			data: query,
			dataType: this.options.dataType
		});
	}
	
	
}, 'data:ajax-provider');









Ergo.declare('Ergo.layouts.Inherited', 'Ergo.core.Layout', {

	// select: function(item) {
		// return this.container.parent.el;
	// }


	_initialize: function() {
		Ergo.layouts.Inherited.superclass._initialize.apply(this, arguments);

		//  
		this._widget.options.autoRender = false;
	},



	// add: function(item, index, weight, group) {
	//
	// 	var g = [[this._widget.options.weight, this._widget._index]];
	//
	// 	this._widget.parent.vdom.add(item, index, weight, group ? g.concat(group) : g);
	//
	// },


	addAfter: function(item, otherItem, weight, group) {

		var g = [[this._widget.options.weight, this._widget._index]];  //FIXME this._widget._index  

		this._widget.parent.vdom.addAfter(item, otherItem, weight, group ? g.concat(group) : g);

	},


	addBefore: function(item, otherItem, weight, group) {

		var g = [[this._widget.options.weight, this._widget._index]];  //FIXME this._widget._index  

		this._widget.parent.vdom.addBefore(item, otherItem, weight, group ? g.concat(group) : g);

	}




}, 'layouts:inherited');


Ergo.declare('Ergo.layouts.HBox', 'Ergo.core.Layout', {
	
	defaults: {
		name: 'hbox'
	}	
	
}, 'layouts:hbox');


Ergo.declare('Ergo.layouts.Bar', 'Ergo.core.Layout', {
	
	defaults: {
		name: 'bar'
	}
	
}, 'layouts:bar');


Ergo.declare('Ergo.layouts.Row', 'Ergo.core.Layout', {

	defaults: {
		name: 'rows'
	},

	wrap: function(item) {
		return ((item.options.divider) ? item.el : $('&lt;div/>').append(item.el))[0];
	}

}, 'layouts:rows');


Ergo.defineClass('Ergo.layouts.HSlide', 'Ergo.core.Layout', {

	defaults: {
		name: 'hslide',
		// html: '&lt;div style="white-space: nowrap; display: inline-block"/>',
		// include: ['observable']
	},

	html: '&lt;div style="white-space: nowrap; display: inline-block"/>',


	_initialize: function() {
		Ergo.layouts.HSlide.superclass._initialize.apply(this, arguments);
//		this._super(o);

		this._offset = 0;
	},




	slide_next: function() {
		var width = $(this.el).width();
//		if(!this._offset) this._offset = 0;
		this._offset += width;
		if(this._offset > $(this.innerEl).width() - width) {
			this._offset = $(this.innerEl).width() - width;
//			this.nextBtn.states.set('disabled');
		}
		else {
//			this.nextBtn.states.unset('disabled');
		}
//		this.prevBtn.states.unset('disabled');

		$(this.innerEl).css('margin-left', -this._offset);

		this._widget.events.fire('layout#slide', {hasPrev: this.has_prev(), hasNext: this.has_next()});
	},

	slide_prev: function() {
		var width = $(this.el).width();
//		if(!this._offset) this._offset = 0;
		this._offset -= width;
		if(this._offset &lt;= 0) {
			this._offset = 0;
//			this.prevBtn.states.set('disabled');
		}
		else {
//			this.prevBtn.states.unset('disabled');
		}

//		this.nextBtn.states.unset('disabled');

		$(this.innerEl).css('margin-left', -this._offset);

		this._widget.events.fire('layout#slide', {hasPrev: this.has_prev(), hasNext: this.has_next()});
	},



	slide_to_item: function(item, bias) {

		bias = bias || 0;

		var x = this._item_offset(item);//this._widget.item(i).el.position().left + this._offset;//_item_offset(i);
		var w = $(item.vdom.el).outerWidth(true);
		var frame_w = $(this.el).width();
		var box_w = $(this.innerEl).width();

		if(x - bias &lt; this._offset) {
			this._offset = Math.max(x - bias, 0);
			$(this.innerEl).css('margin-left', -this._offset);
		}
		else if(x+w+bias > this._offset+frame_w) {
			this._offset = Math.min(box_w-frame_w, x+w-frame_w+bias);
			$(this.innerEl).css('margin-left', -this._offset);
		}

		this._widget.events.fire('layout#slide', {hasPrev: this.has_prev(), hasNext: this.has_next()});
	},


	_item_offset: function(item) {
		var offset = $(item.vdom.el).offset();
		var offset0 = $(this.innerEl).offset();

		return offset.left - offset0.left;
	},


	has_prev: function() {
		return this._offset > 0;
	},

	has_next: function() {
		var frame_w = $(this.el).width();
		var w = $(this.innerEl).width();
		return (w - this._offset) > frame_w;
	}




}, 'layouts:hslide');



Ergo.declare('Ergo.layouts.VBox', 'Ergo.core.Layout', {
	
	defaults: {
		name: 'vbox'
	}	
	
}, 'layouts:vbox');


Ergo.declare('Ergo.layouts.Stack', 'Ergo.core.Layout', {
	
	defaults: {
		name: 'stack'
	}
	
}, 'layouts:stack');


Ergo.declare('Ergo.layouts.Columns', 'Ergo.core.Layout', {

	defaults: {
		name: 'columns'
	},



	select: function(item) {
		var _el = this.el;//this.el.filter('.'+item.options.col);
		if( item.options.col ) {
			var elements = this.el.childNodes;
			if(elements.length == 0) {
				_el = $('&lt;div class="col '+item.options.col+'"/>')[0];
				_el._col = item.options.col;
				item.vdom.targetKey = item.options.col;
				this.el.appendChild(_el);
			}
			else if( item.options.col > (elements[elements.length-1]._col || 0) ) {
				_el = $('&lt;div class="col '+item.options.col+'"/>')[0];
				_el._col = item.options.col;
				item.vdom.targetKey = item.options.col;
				this.el.appendChild(_el);
			}
			else {
				for(var i = 0; i &lt; elements.length; i++) {
					if( item.options.col == elements[i]._col ) {
						_el = elements[i];
						break;
					}
					if( item.options.col &lt; (elements[i]._col || 0) ) {
						_el = $('&lt;div class="col '+item.options.col+'"/>')[0];
						_el._col = item.options.col;
						item.vdom.targetKey = item.options.col;
						$ergo.dom.prependChild(this.el, _el);
//						this.el.prepend(_el);
						break;
					}
				}
			}
		}
//				console.log(elements.length, _el));
		return _el;//this.el.filter('.'+item.options.col);
	},



	wrap: function(item) {
		// var el = null;
		// if(item.options.col) {
		// 	var el = $('> .col.'+item.options.col, this.el); // [class^="col-
		// 	if(el.length == 0)
		// 		el = $('&lt;div class="col '+item.options.col+'"/>');
		// }
		// else {
		// 	var el = $('> div:not(.col)',  this.el);  //[class^="col-"]
		// 	if(el.length == 0)
		// 		el = $('&lt;div/>');
		// }
		return ((item.options.col) ? item.el : $('&lt;div/>').append(item.el))[0];
	}


	// wrap: function(item) {
	// 	return (item.options.divider) ? item.el : $('&lt;div/>').append(item.el);
	// }

}, 'layouts:columns');



Ergo.defineClass('Ergo.layouts.Grid', 'Ergo.core.Layout', {

	defaults: {
		name: 'grid',
//		pattern: []
	},


	wrap: function(item) {
		return $('&lt;div autoheight="ignore-siblings"/>').append(item.el)[0];
	},


	update: function() {
		Ergo.layouts.Grid.superclass.update.call(this);
//		this._super();


		var self = this;

		var o = this.options;

		var w = this._widget;

		var n = w.children.size();
		var k = (n == 0) ? 1 : (12/n).toFixed();


		w.children.each(function(item, i) {

			if(!item._rendered) return;

			var el = $(item.vdom.outerEl);

//			console.log(el._wrapper != null);


			if(w.options.pattern) {

				var offset = 0;
				var n = 0;
				var p = 0;
				for(var j = 0; j &lt; w.options.pattern.length; j++) {
					p = w.options.pattern[j];
					//   ,     
					if(p &lt; 0) {
						offset += p;
					}
					//   
					else {
						//        
						if(n &lt; i) {
							offset = 0;
							n++;
						}
						else {
							break;
						}
					}
				}

				if(n == i) {
					el.addClass('col-'+(item.options.col || p));
					if(offset &lt; 0)
						el.addClass('col-offset'+offset);
//					el.addClass('col-'+(item.options.col || w.options.pattern[i]));
				}
			}
			else {
				el.addClass('col-'+k);
			}


/*
			for(var i in o.pattern) {
				var j = o.pattern[i];

				var k = -1;
				var d = 0;
				// for(var j = 0; j &lt; tmpl.length; j++) {
					// if( tmpl[j] > 0 ) {
						// k++;
					// }
					// else if( tmpl[j] &lt; 0 ) {
						// d -= tmpl[j];
					// }
					// else {
						// d++;
					// }

//					if( k == item._index ) {
						el.addClass('col-'+j);
//						if(d)
//							el.addClass('col-'+'-offset-'+d);
//						break;
//					}

//					if( j > 0 ) d = 0;

//				}

			}
*/
		});


	}


}, 'layouts:grid');



Ergo.declare('Ergo.layouts.Table', 'Ergo.core.Layout', {
	
	defaults: {
		name: 'table'
//		columns: []
	},
	
	
	// construct: function(o) {
		// this._super(o);
// 		
	// },
	
	
	// update: function() {
	// 	this._super();
		
	// 	$('tr.group > td', this.el).attr('colspan', this.options.columns.length);
		
	// }
	
	
}, 'layouts:table');


/*
Ergo.declare('Ergo.layouts.Fluid', 'Ergo.core.Layout', {

	defaults: {
		name: 'fluid'
	}

}, 'layouts:fluid');
*/

Ergo.declare('Ergo.layouts.Float', 'Ergo.core.Layout', {

	defaults: {
		name: 'float'
	}

}, 'layouts:float');



Ergo.declare('Ergo.layouts.Tiles', 'Ergo.core.Layout', {

	defaults: {
		name: 'tiles'
	},


	attach: function(w) {
		Ergo.layouts.Tiles.superclass.attach.call(this, w);

		var sizes = ['one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight'];

		var tiles = this.options.size;

		$(this.el).addClass( tiles > sizes.length ? 'tiles-'+tiles : sizes[tiles-1] );
	},


	// set tiles(v) {
	// },

	wrap: function(item) {
		var el = $('&lt;div/>').append(item.el);
//		el.css({'width': '25%'});
		return el[0];
	}


}, 'layouts:tiles');


Ergo.declare('Ergo.layouts.Band', 'Ergo.core.Layout', {

	defaults: {
		name: 'band'
	},

	wrap: function(item) {
		var w = $('&lt;div/>');
		if(item.$label)
			w.append(item.$label.el);
		w.append(item.el);
		return w[0];
	}


}, 'layouts:band');



Ergo.declare('Ergo.layouts.Form', 'Ergo.core.Layout', {

	defaults: {
		name: 'form'
	},

	wrap: function(item) {
		var w = $('&lt;div/>');
		if(!item.$label &amp;&amp; item.options.label) {
			item.$label = $.ergo({etype: 'html:label', text: item.options.label});
		}
		if(item.$label) {
			w.append(item.$label.el);
		}
		w.append(item.el);
		return w[0];
	}


}, 'layouts:form');





Ergo.declare('Ergo.layouts.HForm', 'Ergo.layouts.Grid', {

	defaults: {
		name: 'hform'
	},

	wrap: function(item) {
		var w = $('&lt;div class="form-item"/>');
		if(!item.$label &amp;&amp; item.options.label) {
			item.$label = $.ergo({etype: 'html:label', text: item.options.label});
		}
		if(!item.$message &amp;&amp; item.options.message) {
			item.$message = $.ergo({etype: 'text', text: item.options.message, as: 'sub'});
		}
		if(item.$label) {
			w.append(item.$label.el);
		}
		w.append(item.el);
		if(item.$message) {
			w.append(item.$message.el);
		}
		return w[0];
	}


}, 'layouts:hform');






Ergo.declare('Ergo.layouts.VForm', 'Ergo.layouts.Grid', {

	defaults: {
		name: 'vform'
	},

	wrap: function(item) {
		var w = $('&lt;div/>');
		if(!item.$label &amp;&amp; item.options.label) {
			item.$label = $.ergo({etype: 'html:label', text: item.options.label});
		}
		if(item.$label) {
			w.append(item.$label.el);
		}

		var w2 = $('&lt;div class="form-item"/>');
		w2.append(item.el);

		w.append(w2);

		return w[0];
	},



	update: function() {

//		this._super();

		console.log('update vform');


		var self = this;

		var o = this.options;

		var w = this._widget;

		// var sz = w.children.size();
		// var k = (sz == 0) ? 1 : (12/sz).toFixed();


		w.children.each(function(item, i) {

			if(!item._rendered) return;

			var el = $(item.vdom.outerEl).children().filter('div') || $(item.el);

//			console.log(item._wrapper);


			if(w.options.pattern) {

				if(item.$label)
					item.$label.vdom.addClass('col-'+w.options.pattern[0]);
				else
					el.addClass('col-offset-'+w.options.pattern[0]);

				el.addClass('col-'+w.options.pattern[1]);

			}
			else {
				if(item.$label)
					item.$label.vdom.addClass('col-6');
				else
					el.addClass('col-offset-6');

				el.addClass('col-6');
			}

		});




	}





}, 'layouts:vform');



Ergo.declare('Ergo.layouts.Center', 'Ergo.core.Layout', {
	
	defaults: {
		name: 'center'
	},
	
	
	update: function() {
		this._super();
		
		// var box_w = this._widget.parent.el.width();
		// var box_h = this._widget.parent.el.width();

		var w = this._widget.el.width();
		var h = this._widget.el.height();
		
		this._widget.el.css({
			'margin-left': -w/2,
			'margin-top': -h/2
		});
		
	}
	
	
}, 'layouts:center');



Ergo.declare('Ergo.layouts.Flex', 'Ergo.core.Layout', {
	
	defaults: {
		name: 'flex'
	},
	
}, 'layouts:flex');




























/**
 *   show()  hide()   
 *
 * :
 * 	`effects`
 *
 * @mixin Ergo.mixins.Effects
 */


$ergo.rules['effects'] = ['override'];



Ergo.alias('includes:effects', {

	defaults: {
		effects: {
			show: 'show',
			hide: 'hide',
			delay: 0
		}
	},



	overrides: {

		show: function() {

			var effect = false;

//			if( !this.children.is_empty() || this.el.text() ) {  // ?

				var o = this.options.effects;


				if(o.initial) {
					o = Ergo.override({}, o, o.initial);
					delete this.options.effects.initial;
				}

				var el = $(this.vdom.outerEl);//_wrapper_el || this.el);

				// FIXME  
				if( !el.is(':visible')) {
					if(this._no_effects) {
						effect = el.show();
					}
					else if( $.isPlainObject(o.show) ) {
						effect = el[o.show.type]({
							duration: o.show.delay || o.delay,
							easing: o.show.easing || 'swing'
						});
					}
					else {
						effect = el[o.show]({
							duration: o.delay,
							easing: o.easing || 'swing'
						});
					}

				}

//			}

			return $.when( effect )
							.then(function(){ this.events.fire('show'); }.bind(this));
		},


		hide: function() {

			var effect = false;

//			if( !this.children.is_empty() || this.el.text() ) {  // ?

				var o = this.options.effects;

				if(o.initial) {
					o = Ergo.override({}, o, o.initial);
					delete this.options.effects.initial;
				}

				var el = $(this.vdom.outerEl);//_wrapper_el || this.dom.el);

				if( el.is(':visible')) {
					if( $.isPlainObject(o.hide) ) {
						effect = el[o.hide.type]({
							duration: o.hide.delay || o.delay,
							easing: o.hide.easing || 'swing'
						});
					}
					else {
						effect = el[o.hide]({
							duration: o.delay,
							easing: o.easing || 'swing'
						});
					}
				}
	//				effect = el[o.hide](o.delay);
//			}

			return $.when( effect )
							.then(function(){ this.events.fire('hide'); }.bind(this));
		}



	}


});



/**
 *
 * @mixin selectable
 *
 */
Ergo.alias('includes:selectable', {

	defaults: {
		// selection: {
		// 	lookup: null,
		// 	multiselect: false
		// },
		events: {
			'select': function(e) {
				this.selection.set( e.key != null ? e.key : (e.target.opt('name') || e.target._index) );
				e.stop();
			},
			'unselect': function(e) {
				this.selection.unset( e.key != null ? e.key : (e.target.opt('name') || e.target._index) );
				e.stop();
			}
		}
	},


	overrides: {

		set selected(selection) {
			this.selection.set(selection);
		},

		get selected() {
			return this.selection.get();
		}

	},


	_construct: function(opts) {

		var o = opts.selection || {};

		this.selection = {

			_widget: this,

			_selected: (o.multiselect) ? {} : null,

			set: function(key) {

				if(key == undefined) return null;

				var o = this._widget.options.selection || {};

				//   
				var lookup = o.lookup || this._widget.item;
				//   
				var multiselect = o.multiselect;

				var selected = null;
				//   
				if( key instanceof Ergo.core.Object ) {
					selected = key;
					key = selected.opt('name');
				}
				else {
					selected = lookup.call(this._widget, key);
				}
//				var selected = (key instanceof Ergo.core.Object) ? key : lookup.call(this._widget, key);

				// TODO    ,    


				//      ,    
	//			for(var i = 0; i &lt; this._selected.length; i++)
	//				if(this._selected[i] == selected) return;


				//   ,     
				if(!multiselect) {
					if(this._selected) {
						this._selected.states.unset('selected');
					}
				}
				else {

					if(!this._selected)
						this._selected = {};

					if(this._selected[key]) {
						this._selected[key].states.unset('selected');
					}
				}


				// //
				// if(!multiselect)
				// 	this._selected = [];


				if(selected == null) return;


				if(!multiselect) {
					this._selected = selected;
				}
				else {
					this._selected[key] = selected;
				}
//				this._selected.push(selected);


				selected.states.set('selected');


				this._widget.events.fire('selectionChanged', {selection: this.get(), selected: selected});

				return selected;
			},


			unset: function(key) {

				var o = this._widget.options.selection || {};

				//   
				var lookup = o.lookup || this._widget.item;
				//   
				var multiselect = o.multiselect;


				var unselected = null;

				if( arguments.length == 0 ) {
					unselected = this._selected;
				}
				else {
					//   
//					unselected = (key instanceof Ergo.core.Object) ? key : lookup.call(this._widget, key);

					if( key instanceof Ergo.core.Object ) {
						unselected = key;
						key = unselected.opt('name');
					}
					else {
						unselected = lookup.call(this._widget, key);
					}


				}



				if(unselected == null) return;


				if(!multiselect) {
					this._selected = null;
				}
				else {
					delete this._selected[key];
				}

//				Ergo.remove(this._selected, unselected);
//				this._selected.remove(unselected);

				unselected.states.unset('selected');


				this._widget.events.fire('selectionChanged', {selection: this.get(), unselected: unselected});

			},


			get: function(i) {
				if(arguments.length == 0) {
					return this._selected;
				}
				else {
					return this._selected ? this._selected[i] : null;
				}
			},


			toggle: function(key) {
				var o = this._widget.options.selection || {};

				//   
				var lookup = o.lookup || this._widget.item;

				var selected = null;

				if( key instanceof Ergo.core.Object ) {
					selected = key;
					key = selected.opt('name');
				}
				else {
					selected = lookup.call(this._widget, key);
				}


				if(!selected)
					return;


				if( selected.states.is('selected') ) {
					this.unset(key);
				}
				else {
					this.set(key);
				}

			},


			is_empty: function() {
				return this._selected.length == 0;
			},

			size: function() {
				return this._selected.length;
			},

			each: function(fn) {
				var o = this._widget.options.selection || {};

				if(!o.multiselect) {
					fn.call(this, this._selected);
				}
				else {
					for(var i in this._selected) {
						fn.call(this, this._selected[i]);
					}
				}

				// for(var item in this._selected) {
				//
				// }
				//
				// this._selected.forEach(fn);
			},

			clear: function() {
				var o = this._widget.options.selection || {};

				this.each(function(selected) {
					selected.states.unset('selected');
				});

				this._selected = o.multiselect ? {} : null;

				this._widget.events.fire('selectionChanged', {selection: this.get()});
			}


		};


	}


});


/**
 *      
 *
 * :
 * 	`active`
 *
 * @mixin Ergo.mixins.Pageable
 */
Ergo.alias('includes:pageable', {

	defaults: {
		cls: 'pageable'
	},

	overrides: {

		set_active: function(i) {

			var child = (i instanceof Ergo.core.Widget) ? i : this.children.find( Ergo.by_widget(i) );

			// this.children.each(function(c){
				// (c != child) ? c.hide() : c.show();
			// });

			if(child.layout) child._layoutChanged();

			var promise = $.when(true);

			if(this._active) {
				this._active.states.unset('active');
				promise = this._active.hide();
			}

			this._active = child;

			promise.then(function(){

				this._active.states.set('active');
				this._active.show();

			}.bind(this));


			return child;
		},


		get_active: function() {
			return this._active;
		}


	}


});


Ergo.alias('includes:focusable', {

	_post_construct: function(o) {

		this.el.attr('tabindex', 0);

	}


});


$ergo.rules['popup'] = ['object'];

$ergo.alias('includes:popup', {

	defaults: {
		as: 'popup',
		popup: {
			to: null,
			at: 'left top',
			my: 'left top',
			offset: [0, 0],
			closeOn: 'outerClick',
			exclusive: true,
			boundary: 'auto'
		},
		states: {
			'dropup-auto:auto': 'dropup-auto',
			'dropdown-auto:auto': 'dropdown-auto',
			'no-auto:auto': ''
		},
		events: {
			'jquery:mouseleave': function(e){
				if(this.options.popup.closeOn == 'mouseleave') this.close();
			}
		},
		autoHeight: 'ignore' //        
	},



	overrides: {

		open: function(position) {

			var popups = Ergo.context._popups;

			//       
			if(!popups.is_empty() &amp;&amp; this.options.popup.exclusive) {
				popups.apply_all('close');
				popups.remove_all();
			}



			var self = this;

			var x = 0;
			var y = 0;

			if(arguments.length == 2) {
				x = arguments[0];
				y = arguments[1];
				position = {};//offset: [arguments[0], arguments[1]]};
			}

			var p = $ergo.mergeOptions({}, [this.options.popup, position]);

			//  

			//     "at"
			x += p.offset[0];
			y += p.offset[1];


			//   ,    
			var to_el = null;

			//  ,     popup
			if(p.to) {
				to_el = $(p.to);
			}
			else if(this.parent) {
				to_el = this.parent.el;
			}



			//       "to"


			if(to_el) {

				var at = p.at.split(' ');

				if(at[0] == 'right') x += to_el.outerWidth(false);
				else if(at[0] == 'center') x += to_el.outerWidth(false)/2;

				if(at[1] == 'bottom') y += to_el.outerHeight(false);
				else if(at[1] == 'center') y += to_el.outerHeight(false)/2;

				if(p.adjust)
	//				this.el.width(to_el.outerWidth(false));
					this.el.css('min-width', to_el.outerWidth(false));

			}


			//      popup

			// var my = p.my.split(' ');

			// if(my[0] == 'right') x -= this.el.outerWidth(false);
			// else if(my[0] == 'center') x -= this.el.outerWidth(false)/2;

			// if(my[1] == 'bottom') y -= this.el.outerHeight(false);
			// else if(my[1] == 'center') y -= this.el.outerHeight(false)/2;


			// if(to_el) {
				// //   
				// var offset = to_el.offset();
	//
				// x += offset.left;
				// y += offset.top;
			// }


			if(p.behaviour == 'contextmenu') {

				var max_w = $(document).scrollLeft() + $(window).width();
				var max_h = $(document).scrollTop() + $(window).height();
				var pop_h = this.el.outerHeight(true);
				var pop_w = this.el.outerWidth(true);

				var dh = (y + pop_h) - max_h;
				if(dh > 0) {
					y -= pop_h;
				}

				var dw = (x + pop_w) - max_w;
				if(dw > 0) {
					x -= dw;//pop_w;
				}

				this.el.css({'left': x, 'top': y});
			}
			else if(p.behaviour == 'global') {

				var offset = to_el.offset();
				x += offset.left;
				y += offset.top;

				y += to_el.outerHeight(false);


				this.el.css({'left': x, 'top': y});
			}




			if(p.behaviour != 'none') {

//				this.el.css({'left': x, 'top': y});

			}



			if(p.boundary == 'auto' &amp;&amp; to_el) {
				//         
				var offset = to_el.offset();
				var max_x = $(window).width();
				var max_y = $(window).height();
				var scroll_top = 0;

				this.el.parents().each(function(i, elem) {
					scroll_top += $(elem).scrollTop();
				});

				if(offset.left + this.el.width() > max_x)
					this.states.set('pull-left-auto');
				else
					this.states.unset('pull-left-auto');

				if(offset.top + to_el.height() + this.el.outerHeight(true) - scroll_top > max_y)
					this.states.set('dropup-auto');
				else if(this.states.is('dropup') &amp;&amp; (offset.top - this.el.outerHeight(true) - scroll_top &lt; 0))
					this.states.set('dropdown-auto');
				else
					this.states.set('no-auto');


			}



			//   


			//   

			// FIXME    
			$('html').one('click.ergoPopup', function(e) {
				this.events.fire('outerClick');
				if(this.options.popup.closeOn == 'outerClick') this.close();
			}.bind(this));

			Ergo.context.events.once('outerClick', function(e) {
				this.events.fire('outerClick');
				if(this.options.popup.closeOn == 'outerClick') this.close();
			}.bind(this), this);



			//       
			popups.add(this);


			return this.show().then(function(){
				self.events.fire('opened');
			});
		},


		close: function() {
			var self = this;
			var popups = Ergo.context._popups;

			var k = popups.key_of(this);
			if( k > -1 ) {//Ergo.context._popup == this) {

				if(this != popups.last()) popups.get(k+1).close();  //TODO ,  ,      

				popups.remove(this);

				Ergo.context.events.off(this);

				$('html').off('click.ergoPopup');

				return this.hide().then(function(){
					self.events.fire('closed');
				});
			}

		}


	},



	_construct: function() {

		if(!Ergo.context._popups)
			Ergo.context._popups = new Ergo.core.Array();

	}



});


/*
Ergo.defineMixin('Ergo.mixins.Window', function(o) {


	this.open = function() {


		if(arguments.length == 2) {
			// x, y
			var x = arguments[0];
			var y = arguments[1];

			this.el.css({'top': y, 'left': x});
		}

		//    z-
		var z = Ergo.context._z || 0;
		z++;

		//  z-index
		this.el.css({'z-index': z*1000});

		$('body').append(this.el); // FIXME   render

		this.el.show();

	};


	this.close = function() {

		//   
		Ergo.context._z--;

		this.el.hide();

		this.el.detach(); // FIXME   unrender

		if(this.options._destroyOnClose)	this._destroy();

	};


	this.resize = function(w, h) {

	};



	this.move = function(x, y) {

		this.el.offset({
			left: x,
			top: y
		});

		// this.el.css({
		// 	left: x,
		// 	top: y
		// });

	};



//	o


	o.appearance = Ergo.smart_override({

	}, o.appearance);



}, 'mixins:window');

*/


Ergo.alias('includes:window', {

	overrides: {

		open: function() {


			if(arguments.length == 2) {
				// x, y
				var x = arguments[0];
				var y = arguments[1];

				this.el.css({'top': y, 'left': x});
			}

			//    z-
			var z = Ergo.context._z || 0;
			z++;

			//  z-index
			this.el.css({'z-index': z*1000});

			$('body').append(this.el); // FIXME   render

			this.el.show();

		},


		close: function() {

			//   
			Ergo.context._z--;

			this.el.hide();

			this.el.detach(); // FIXME   unrender

			if(this.options.destroyOnClose)
				this._destroy();

		},


		resize: function(w, h) {

		},



		move: function(x, y) {

			this.el.offset({
				left: x,
				top: y
			});

			// this.el.css({
			// 	left: x,
			// 	top: y
			// });

		}

	}


});




Ergo.alias('includes:modal', {

	defaults: {

		autoHeight: 'ignore',

		destroyOnClose: true,

		components: {
			overlay: {
				etype: 'html:div',
				cls: 'overlay',
				autoHeight: 'ignore',
	//			render: 'body',
				events: {
					'jquery:click': function(e) {

						Ergo.context.events.fire('outerClick', {type: 'overlay'});

						if(this.parent.options.closeOn == 'outerClick')
							this.parent.close();

						//   
						e.preventDefault();
						return false;
					}
				}
			}
		},
		events: {
			'jquery:click': function(e) {
				Ergo.context.events.fire('outerClick', {type: 'modal'});
//				if(this.options.closeOn == 'outerClick')
				e.stopPropagation();
			},
		}
	},


	overrides: {

		open: function() {

			var o = this.options;

			var modal = this;

			if(arguments.length == 2) {
				// x, y
				var x = arguments[0];
				var y = arguments[1];

				modal.el.css({'top': y, 'left': x});
			}

			//    z-
			var z = Ergo.context._z || 0;
			z++;

			//  z-index
			modal.$overlay.el.css({'z-index': z*1000});
			modal.el.css({'z-index': z*1000+1});

			modal.$overlay.render('body');
//			$('body').append(modal.$overlay.el);

			modal.$overlay.el.append( modal.el );

			modal._rendered = true;
			modal.$overlay._rendered = true;
	//		this.overlay.items.add(this);
	//		$('body').append(this.el);

			modal.render();





			var result = modal.$overlay.show().then(function(){

/*
				//	   ,    

				this.el.show();

				// ,     ,  


				if(o.position == 'top') {

					// top
					var w = this.el.width();

					var x = w/2;

					this.el.css({'margin-left': -x, 'top': 0});

				}
				else if(o.position == 'right') {

					// top
					var h = this.el.height();

					h = Math.min(h, $(window).height());

					var y = h/2;


					this.el.css({'right': 0, 'left': 'auto', 'margin-top': -y});

				}
				else {

					// center
					var w = this.el.width();
					var h = this.el.height();

					h = Math.min(h, $(window).height());

					var x = w/2;
					var y = h/2;


					this.el.css({'margin-left': -x, 'margin-top': -y});
				}


				this.el.hide();
*/

				this.events.fire('open');

				return this.show().then(function(){
					this.events.fire('opened');
					this._layoutChanged();
				}.bind(this));

			}.bind(this));



			return result;
		},


		//
		// Close modal
		//
		close: function() {

			var e = this.events.fire('close');

			if(e.canceled)
				return;


			Ergo.context._z--;

			return this.hide().then(function(){

	//			this.el.detach();

				this.$overlay.hide().then(function(){
					$ergo.dom.remove( this.$overlay.el );
//					this.overlay.el.detach();
					this.events.fire('closed');

					if(this.options.destroyOnClose)
						this._destroy();

				}.bind(this));

			}.bind(this));


		},


		/**
		 *
		 * Resize modal
		 *
		 */
		resize: function(w, h, comp) {

			var w1, h1;

			if(arguments.length > 0) {

				var el = (comp) ? this.component(comp).el : this.el;

				var w0 = el.css('width');//width();
				var h0 = el.css('height');//height();

//				setTimeout(function(){
					el.css({'width': w, 'height': h});
//				}, 1)

				var w1 = this.el.width();
				var h1 = this.el.height();

				// el.css({'width': w0, 'height': h0});

				// el.animate({
				// 	width: w,
				// 	height: h,
				// 	// 'margin-left': -w/2,
				// 	// 'margin-top': -h/2
				// });

			}
			else {
				w1 = this.el.width();
				h1 = this.el.height();
			}

			// return $.when(this.el.animate({
			// 	'margin-left': -w1/2,
			// 	'margin-top': -h1/2
			// }));

			return $.when(true);
		}


	}


});

/*
Ergo.defineMixin('Ergo.mixins.Draggable', function(o) {

	o.events = Ergo.smart_override({
		'jquery:mousedown': function(e) {

			if( e.button == 0 ) {

				var self = this;

				var offset = this.el.offset();

				var drag = {
					dx: e.pageX - offset.left,
					dy: e.pageY - offset.top,
				};

				//   
				this.el.parents().each(function(i, p){
					drag.dy += $(p).scrollTop() || 0;
					drag.dx += $(p).scrollLeft() || 0;
				});


				//  ""
				var glass = $('&lt;div class="glass"/>');
				$('body').append(glass);

				glass.on('mousemove', function(e) {

					if(drag) {
						self.events.rise('drag', {x: e.pageX, y: e.pageY, dx: drag.dx, dy: drag.dy, target: self});
					}


				});

				glass.on('mouseup', function(e) {

					glass.remove();

					self.events.rise('dragEnd', {x: e.pageX, y: e.pageY, dx: drag.dx, dy: drag.dy, target: self});
				});



				this.events.rise('dragStart', {x: e.pageX, y: e.pageY, dx: drag.dx, dy: drag.dy});

				e.preventDefault();
			}

		}
	}, o.events);



}, 'mixins:draggable');

*/




Ergo.alias('includes:fastclick', {


	_post_construct: function(o) {

		var w = this;

		w.el.mousedown(function(e) { 
			if(!w.states.is('disabled') &amp;&amp; e.button === 0) {
				w.events.fire('click', {button: e.button}, e);
			}
		});


		w.el.off('click');


		w.el.click(function(e) {
			e.preventDefault();
			e.stopPropagation();
		});



		// w.el.mouseup(function(e) { 
		// 	if(w._fastclick) {
		// 		delete w._fastclick;
		// 		e.stopPropagation();
		// 	}
		// });


	}

});

Ergo.alias('includes:router', {

  defaults: {
    hashUrl: true,
    events: {
      'restore': function(e) {

        console.log('restore from route', window.location.hash);

        var hash_a = window.location.hash.split('?');
        var path = hash_a[0];

        //   URL
        if(hash_a.length > 1) {

          var query = {};

          var query_a = hash_a[1].split('&amp;');

          for(var i = 0; i &lt; query_a.length; i++) {
            var p_a = query_a[i].split('=');
            var p_name = decodeURIComponent(p_a[0]);
            if( p_name ) {
              if( p_a.length == 1 ) {
                query[p_name] = '';
              }
              else {
                query[p_name] = decodeURIComponent(p_a[1].replace(/\+/g, " "));
              }
            }
          }

          e.params.$query = query;
        }


        // url = url.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        // var regex = new RegExp("[\\?&amp;]" + url + "=([^&amp;#]*)"),
        //     results = regex.exec(location.search);
        // return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));

        //FIXME
        path = path ? path.slice(2) : '';


        e.name = this.restoreFromPath( path, e.params );//, e.opts );

        console.log('router restore', e.params);

        // this.to( path, e.params );
        //
        // e.interrupt();
      }

    }
  },



  _construct: function(o) {

    var w = this;

    this.router = {

      // restore: function(params) {
      //
      // }

    }


  },



  overrides: {


    buildQuery: function(params) {
      var query = [];
      for(var i in params) {
        query.push( encodeURIComponent(i) + '=' + encodeURIComponent(params[i]) );
      }
      return query.join('&amp;');
    },


    absolutePath: function(path) {
      if( !path ) return path;
      if( path[0] == '/' ) return path;

      if( this.options.hashUrl ) {
        var url = window.location.hash.slice(2);
        path = url + '/' + path;
      }

      return path;
    },



    routeMatch: function(path, route) {

      var out = {};

      var path_a = path.split('/');

      //  
      if( $.isString(route) ) {

        if(route == path)
          return out;

        var route_a = route.split('/');
        if(path_a.length == route_a.length) {
          var matches = 0;
          for(var i = 0; i &lt; path_a.length; i++) {
            var p = path_a[i];
            var r = route_a[i];
            if( r[0] == ':')
              out[r.substr(1)] = p;
            else if( p != r )
              break;
            matches++;
          }

          if(matches == path_a.length)
            return out;
        }
      }

      return null;
    },

    //  
    routes: function(o) {

      var routes = {};

      var f = function(r, parent) {


        var p = (parent.path || '') + (r.path || '');
        var n = parent.name ?  parent.name + '.' + r.name : r.name;

        routes[p] = {
          name: n,
          history: !r.routes,
          path: p
        };

        if(r.routes) {
          for(var i = 0; i &lt; r.routes.length; i++)
            f(r.routes[i], routes[p]);
        }
      };

      f(o, {});

      this._routes = routes;

    },



    restoreFromPath: function(path, params) {//}, opts) {

      //    
      path = this.absolutePath(path);

      for(var i in this._routes) {

        var route = this._routes[i];

        var match = this.routeMatch(path, route.path);
        if( match ) {

          var o = {
            $path: '#!'+path,
            $history: route.history
          };

          $ergo.override(params, match, o); // merge path params and route params
//          $ergo.mergeOptions(opts, [o]); //

          return route.name;// {name: route.name, params: match, options: o};// this.join( route.name, match, o );
        }
      }

      return null;
    },



    to: function(path, params) {//}, opts) {

      params = params || {};
//      opts = opts || {};


      var name = this.restoreFromPath(path, params);//, opts);

      console.log('route to', name, params);//, opts);

      if( name ) {

        if(params &amp;&amp; params.$query) {
          params.$path += '?' + this.buildQuery(params.$query);
        }

        return this.join( name, params );//, opts );
      }

      return $.when(null);

      // //    
      // path = this.absolutePath(path);
      //
      // for(var i in this._routes) {
      //
      //   var route = this._routes[i];
      //
      //   var match = this.routeMatch(path, route.path);
      //   if( match ) {
      //
      //     console.log('route to', path, params, route);
      //
      //     var o = {
      //       path: '#!'+path,
      //       history: route.history
      //     };
      //
      //     if(params &amp;&amp; params.query) {
      //       o.path += '?' + this.buildQuery(params.query);
      //     }
      //
      //     Ergo.override(match, params); // merge path params and route params
      //     Ergo.smart_override(o, opts); //
      //
      //     return this.join( route.name, match, o );
      //   }
      // }
      //
      // return $.when(null);
    },


    back: function() {
      window.history.back();
    }


  }


});


Ergo.alias('includes:history', {

  defaults: {
    events: {
			'restore': function(e) {

//				console.log('- history', e.scope, e.hash, e.params);

        console.log('history restore', e.params);

        // if(e.params) {
        //   if(e.scope)
  			// 		this.join(e.scope, e.params);
        // }
        // else {
        //   ctx.reset();
        //   ctx.init();
        // }

				//    ,   
//				this.restore(e.scope, e.params, e.hash);
			},
			'scope#joined': function(e) {


				var scope = e.scope;

				if(scope._params.$history &amp;&amp; !this._no_history) {

          console.log('join history', e);

          var p = e.params.history || {};

					// var name_a = e.scope._name.split(':');
					// var p = {};
					// p[name_a[0]] = (name_a.length > 1) ? name_a[1] : true;
					// var p = Ergo.override(p, this._params[e.scope._name]);
//					var chain = scope._chain.join('.');
//					var p = Ergo.deep_override({_scope: chain}, scope._params);
					window.history.pushState( p, scope._name, scope._params.$path );//opt('path') );//, 'title', '#'+url);

					console.log('+ history', /*scope.opt('path')*/scope._params.$path, scope._name, p);

				}
			}
		}
  },


  _construct: function(o) {

    //  
    var location = window.history.location || window.location;

    var ctx = this;

    $(window).on('popstate', function(e) {

      var p = e.originalEvent.state;

      console.log('popstate', p);
//				console.log(e.originalEvent);
//				console.log(p);

      if(p) {

        //      history

        var e = ctx.events.fire('restore', {name: null, params: {history: p}/*, opt: {}*/});///*scope: p._scope,*/ params: p, hash: window.location.hash});

        ctx._no_history = true;
        ctx.join(e.name, e.params);//, e.opts);
        ctx._no_history = false;

      }
      else {
        console.warn('No popstate data. Scope can not be restored!');
      }

      // }
      // else {
      //   ctx.reset();
      //   ctx.init();
      // }


    //	console.log('popstate:', e.originalEvent);

    });

  }




});



Ergo.alias('includes:provider-methods', {

  _construct: function(o) {

    if(o.provider) {

      var provider = o.provider;

      if( $.isString(provider) )
        provider = Ergo.alias('providers:'+provider);

      for(var i in provider) {
        var p = provider[i];
        if( $.isFunction(p) ) {

          this['$'+i] = function(action) {
            var composer = this.options.composer || this._compose;
            var parser = this.options.parser || this._parse;

            var data = composer.call(this, this.get(), action);

            var args = [this];
            for(var j = 1; j &lt; arguments.length; j++)
              args.push(arguments[j]);

            return $.when(provider[action].apply(provider, args)).then(function(data) {
      				return parser.call(this, data, action);
      			});
          }.bind(this, i) //p.bind(provider, this);
        }
      }

    }

  }


});



Ergo.alias('includes:list-navigator', {

	_construct: function(o) {

		var _w = this;

		this.navigator = {

			get selected() {
				return this.__sel;
			},

			set selected(item) {
				if(this.__sel)
					this.__sel.states.unset('selected');

				this.__sel = item;

				if(this.__sel)
					this.__sel.states.set('selected');
			},




			next: function() {
				var item = this.selected ? this.selected.next() : _w.items.first();

				while(item) {
					if(item._rendered)
						break;
					item = item.next();
				}

				this.scroll_to(item);

				this.selected = item;
			},

			prev: function() {
				var item = this.selected ? this.selected.prev() : _w.items.last();

				while(item) {
					if(item._rendered)
						break;
					item = item.prev();
				}

				this.scroll_to(item);

				this.selected = item;
			},


			scroll_to: function(item) {

				if(!item)	return;

				var h = _w.el.height();
				var s_top = _w.el.scrollTop();
				var hi = item.el.outerHeight();
				var p = item.el.position().top;
				if( p + hi > h) {
					_w.el.scrollTop( s_top + p + hi - h );
				}
				else if ( p &lt; 0) {
					_w.el.scrollTop( s_top + p );
				}
				
			}

		};


	}


});



Ergo.alias('includes:user-input', {

  defaults: {
    events: {
      'jquery:keyup': 'do_input'
    }
  },


  overrides: {

    do_input: function(e) {

      var keyCode = e.keyCode;

      // var text = this.el.val();
      //

      var text = this.vdom.el.value || this.vdom.el.textContent;

      console.log('input', text, this.value, this.__val );


			if(keyCode == Ergo.KeyCode.UP
				|| keyCode == Ergo.KeyCode.DOWN
				|| keyCode == Ergo.KeyCode.ENTER
				|| keyCode == Ergo.KeyCode.ESC) {
				// TODO   
			}
			else {
				this.events.rise('input', {text: text, keyCode: keyCode});
			}
    }

  }

});



Ergo.alias('includes:expandable', {

	defaults: {
		components: {
			sub: {
				hidden: true
			}
		},
		transitions: {
			'* > expanded': function() {
				this.$sub.show();
			},
			'expanded > *': function() {
				this.$sub.hide();
			}
		},
		events: {
			'expand': function(e) {
				this.states.toggle('expanded');
//				e.stop();
			}
		}
	}

});



Ergo.alias('includes:exclusive-expand', {

	defaults: {
		events: {
			'expand': function() {
				//   
	      this.parent.items.each(function(item) {
	        if(item != this &amp;&amp; item.states.is('expanded'))
	          item.states.unset('expanded');
	      }.bind(this));
			}
		}
	}

});


Ergo.alias('includes:placeholder', {

  overrides: {

    set placeholder(v) {
      var tag = this.el.prop('tagName').toLowerCase();
      if(tag == 'input' || tag == 'textarea') {
        if(v != null) {
          this.el.prop('placeholder', v);
        }
        else {
          this.el.removeProp('placeholder');
        }
      }
      else {
        if(v != null) {
          this.el.attr('data-ph', v);
          this.states.set('ph');
        }
        else {
          this.el.removeAttr('data-ph');
          this.states.unset('ph');
        }
      }
    }

  }

});



Ergo.alias('includes:local-storage', {

  defaults: {
    lsKey: 'default',
    events: {
      'restore': function(e) {

//        console.log('localStorage restore', e.params);

      },
      'scope#join': function(e) {


        if(e.params) {

          var json = JSON.parse( window.localStorage.getItem(this.options.lsKey) ) || {};

          e.params.ls = json[e.scope._name] || {};

//           var json = JSON.parse( window.localStorage.getItem(this.options.lsKey) ) || {};
//           json[e.scope._name] = e.params.ls;
// //          Ergo.override( json.params, e.params.ls);
//           window.localStorage.setItem(this.options.lsKey, JSON.stringify(json));
        }

      },
      'scope#disjoin': function(e) {

//        console.log('localStorage save', e.scope._name, e.params);

        if(e.params &amp;&amp; e.params.ls) {
          var json = JSON.parse( window.localStorage.getItem(this.options.lsKey) ) || {};
          json[e.scope._name] = e.params.ls;
//          Ergo.override( json.params, e.params.ls);
          window.localStorage.setItem(this.options.lsKey, JSON.stringify(json));
        }

      }
    }
  }

});






















/**
 *   &lt;iframe>
 *
 * etype: html:iframe
 *
 * :
 * 	- src
 *
 * @class
 * @name Ergo.html.Iframe
 * @extends Ergo.core.Widget
 */
Ergo.defineClass('Ergo.html.Iframe', 'Ergo.core.Widget', {

	defaults: {
		tag: 'iframe'
	},

	set src(v) {
		this.vdom.el.setAttribute('src', v);
	}

}, 'html:iframe');



/**
 *   &lt;input>
 *
 * etype: html:input
 *
 * :
 * 	- type
 * 	- placeholder
 * 	- disabled
 * 	- name
 * 	- readonly
 *
 * @class
 * @name Ergo.html.Input
 * @extends Ergo.core.Widget
 */
Ergo.defineClass('Ergo.html.Input', 'Ergo.core.Widget', {

	defaults: {
		tag: 'input',
		binding: function(v) {
			this.el.val(v);
//			this.dom.el.value = v;
		},
		events: {
			'jquery:change': 'do_change'
		}
		// onChange: function(e) {
		// 	this.opt('value', this.el.val());
		// }
		// events: {
			// 'jquery:change': function() {
				// this.events.rise('change', {value: this.el.val()});
// //				this.opt('value', this.el.val());
			// }
		// }
	},

	attributes: ['id', 'tabindex', 'type', 'placeholder', 'disabled', 'readonly', 'size'],

	// set_type: function(v) {
	// 	this.el.attr('type', v);
	// },

	// set_placeholder: function(v) {
	// 	this.el.attr('placeholder', v);
	// },

	// set_disabled: function(v) {
	// 	(v) ? this.el.attr('disabled', '') : this.el.removeAttr('disabled');
	// },

	//   name
	set name(v) {
		this._name = v;
		this.vdom.el.setAttribute('name', v);
	},


	set text(v) {
		this.el.val(v);
	},


	set hidden(v) {
		this.el.prop('hidden', true);
	},

	set type(v) {
		this.vdom.el.setAttribute('type', v);
	},

	set placeholder(v) {
		this.vdom.el.setAttribute('placeholder', v);
	},

	// _change: function(e) {
	// 	this.events.rise('change', {value: this.el.val()});
	// },

	do_change: function(e) {
		this.events.rise('change', {value: this.el.val()});
	},


	// set_readonly: function(v) {
	// 	this.el.attr('readonly', v);
	// }




	// get_value: function() {
		// return this.el.val();
	// },
//
	// set_value: function(v) {
		// this.el.val(v);
	// }



}, 'html:input');





/**
 *   &lt;input type="text">
 *
 * etype: html:text-input
 *
 * :
 *
 * @class
 * @name Ergo.html.TextInput
 * @extends Ergo.core.Widget
 */
Ergo.defineClass('Ergo.html.TextInput', 'Ergo.html.Input', {

	defaults: {
		type: 'text',
		// binding: function(v) {
		// 	this.el.val(v);
		// },
		events: {
			// jquery
			'jquery:keyup': function(e) {
				this.events.rise('keyUp', {text: this.el.val()}, e);
			},
			'jquery:keydown': function(e) {
				this.events.rise('keyDown', {text: this.el.val()}, e);
			},
			// widget
			'change': function(e) {
				this.opt('value', e.value);
			},
			'keyUp': function(e) {
				var keyCode = e.base.keyCode;

				if(keyCode == Ergo.KeyCode.ESC
					|| keyCode == Ergo.KeyCode.DOWN
					|| keyCode == Ergo.KeyCode.ENTER
					|| keyCode == Ergo.KeyCode.ESC) {
					// TODO   
				}
				else {
					this.events.rise('input', {text: e.text, keyCode: keyCode});
				}

			}
		}

		// onChange: function(e) {
		// 	this.opt('value', e.value);
		// },
		//
		// onKeyUp: function(e) {
		//
		// }

		// events: {
		// 	'jquery:change': function() {
		// 		this.opt('value', this.el.val());
		// 	}
		// }
	}


}, 'html:text-input');





/**
 * 
 *
 * :`html:checkbox`
 *
 * :
 * 	`indeterminate`
 *
 * 
 * 	`action`    
 *
 * @class
 * @name Ergo.html.Checkbox
 * @extends Ergo.core.Widget
 */
Ergo.defineClass('Ergo.html.Checkbox', 'Ergo.html.Input', /** @lends Ergo.html.Checkbox.prototype */{

	defaults: {
//		html: '&lt;input type="checkbox"/>',
		type: 'checkbox',
		binding: function(v) {
			this.el.prop('checked', v);
		},
		onChange: function(e) {
			this.opt('value', e.value);//this.el.prop('checked'));
		}
// 		events: {
// 			'jquery:change': function(e) {
// 				this.opt('value', this.el.prop('checked'));
// //				w.events.fire('action');
// 			}
// 		}
	},


	set_indeterminate: function(v) {
		this.el.prop('indeterminate', v);
	},


	// _change: function() {
	// 	this.events.rise('change', {value: this.el.prop('checked')});
	// },

	do_change: function() {
		this.events.rise('change', {value: this.el.prop('checked')});
	}



}, 'html:checkbox');



/**
 * 
 *
 * :`html:radio`
 *
 *
 * @class
 * @name Ergo.html.Radio
 * @extends Ergo.html.Checkbox
 */
Ergo.defineClass('Ergo.html.Radio', 'Ergo.html.Checkbox', /** @lends Ergo.html.Radio.prototype */{

	defaults: {
		type: 'radio',
// 		binding: function(v) {
// 			this.el.prop('checked', v);
// 		},
// 		events: {
// 			'jquery:change': function(e) {
// //				w.opt('value', w.el.prop('checked'));
// 				this.events.rise('change', {value: this.el.prop('checked')});
// 			}
// 		}
	}

}, 'html:radio');





/**
 *   &lt;select>
 *
 * etype: html:select
 *
 * :
 * 	- disabled
 * 	- name
 * 	- readonly
 * 	- multiple
 *
 * @class
 * @name Ergo.html.Select
 * @extends Ergo.core.Widget
 */
Ergo.defineClass('Ergo.html.Select', 'Ergo.core.Widget', {

	defaults: {
		tag: 'select',
		defaultItem: {
			etype: 'html:option',
			binding: 'text'
		}
	},

	set_disabled: function(v) {
		(v) ? this.el.attr('disabled', '') : this.el.removeAttr('disabled');
	},

	set_name: function(v) {
		this.el.attr('name', v);
	},

	set_readonly: function(v) {
		this.el.attr('readonly', v);
	},

	set_multiple: function(v) {
		this.el.attr('multiple', v);
	}


}, 'html:select');




/**
 *   &lt;textarea>
 *
 * etype: html:Textarea
 *
 * :
 * 	- rows
 *
 * @class
 * @name Ergo.html.Textarea
 * @extends Ergo.core.Widget
 */
Ergo.defineClass('Ergo.html.TextArea', 'Ergo.core.Widget', {

	defaults: {
		tag: 'textarea',
		binding: function(v) {
			this.el.val(v);
		},
		events: {
			'jquery:change': 'do_change'
		}
	},

	attributes: ['id', 'tabindex', 'placeholder', 'disabled', 'readonly', 'rows'],


	// set_rows: function(v) {
	// 	this.el.attr('rows', v);
	// },

	//   name
	set_name: function(v) {
		this._name = v;
		this.el.attr('name', v);
	},


	set text(v) {
		this.el.val(v);
	},


	set hidden(v) {
		this.el.prop('hidden', true);
	},


	do_change: function(e) {
		this.events.rise('change', {value: this.el.val()});
	}


}, 'html:textarea');


/**
 *   &lt;button>
 *
 * etype: html:button
 *
 * @class
 * @name Ergo.html.Button
 * @extends Ergo.core.Widget
 */
Ergo.defineClass('Ergo.html.Button', 'Ergo.core.Widget', {

	defaults: {
		tag: 'button'
	}

}, 'html:button');



/**
 *   &lt;img>
 *
 * etype: html:img
 *
 * :
 * 	- src
 *
 * @class
 * @name Ergo.html.Img
 * @extends Ergo.core.Widget
 */
Ergo.defineClass('Ergo.html.Img', 'Ergo.core.Widget', {

	defaults: {
		tag: 'img'
	},

	attributes: ['id', 'tabindex', 'src'],


	set src(v) {
		this.vdom.el.setAttribute('src', v);
	}

}, 'html:img');


/**
 *   &lt;label/>
 *
 * @class
 * @name Ergo.html.Label
 * @extends Ergo.core.Widget
 */
Ergo.defineClass('Ergo.html.Label', 'Ergo.core.Widget', {

	defaults: {
		tag: 'label'
	},


  set _for(v) {
    this.el.prop('for', v);
  }

}, 'html:label');


/**
 *   &lt;label/>
 *
 * @class
 * @name Ergo.html.Label
 * @extends Ergo.core.Widget
 */
Ergo.defineClass('Ergo.html.A', 'Ergo.core.Widget', {

	defaults: {
		tag: 'a'
	},

  attributes: ['id', 'tabindex', 'href'],

	set href(v) {
		this.vdom.el.setAttribute('href', v);
	}


}, 'html:a');


/**
 *  
 *
 * :`.`
 *
 * :
 * 	`text`
 *
 * @class
 * @name Ergo.widgets._Text
 * @extends Ergo.core.Widget
 */
Ergo.defineClass('Ergo.html._Text', 'Ergo.core.Widget', {

	// set_text: function(v) {
	// 	this.el[0].textContent = (v == null ? '': v);
	// }

}, 'html:.');



/**
 *   &lt;form>
 *
 * etype: html:form
 *
 * :
 * 	- action
 *	- method
 *
 * @class
 * @name Ergo.html.Form
 * @extends Ergo.core.Widget
 */
Ergo.defineClass('Ergo.html.Form', 'Ergo.core.Widget', {

	defaults: {
//		html: '&lt;form method="POST"/>'
		tag: 'form'
	},

	set action(v) {
		this.vdom.el.setAttribute('action', v);
	},

	set method(v) {
		this.vdom.el.setAttribute('method', v);
	}

}, 'html:form');


/**
 * @namespace Ergo.html
 */


















/**
 *       $html
 *
 * etype: html:widget
 *
 * @class
 * @name Ergo.html.Widget
 * @extends Ergo.core.Widget
 */
Ergo.defineClass('Ergo.html.Widget', 'Ergo.core.Widget', {

	defaults: {
	}

}, 'html:widget');



Ergo.$html = function(o, etype) {

	if(!Ergo.alias('html:'+etype)) {

//		var _etype = etype;

// 		var i = etype.indexOf(':');
// 		if(i > 0) {
// //			ns = etype.substr(0, i);
// 			etype = etype.substr(i+1);
// 		}

		// var _o = $.isArray(o) ? o[o.length-1] : o;
//
// //		o.etype = 'html:widget';
		// _o.html = '&lt;'+_etype+'/>';

//		o.unshift({html: '&lt;'+etype+'/>'});
		o.unshift({tag: etype});

		etype = 'widget';
	}

	return Ergo.object('html', o, etype);
};
</code></pre>
        </article>
    </section>






        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a> on Wed Feb 03 2016 22:56:27 GMT+0300 (RTZ 2 ())
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>
